<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vendor Invoice #<%= @vendor_invoice.invoice_number %></title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #f8f9fa;
      color: #333;
    }

    .invoice-container {
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      margin: 20px auto;
      max-width: 800px;
      overflow: hidden;
    }

    .invoice-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .invoice-body {
      padding: 30px;
    }

    .company-info {
      text-align: center;
      margin-bottom: 30px;
    }

    .company-name {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .invoice-details {
      border: 2px solid #e9ecef;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
      background: #f8f9fa;
    }

    .table th {
      background: #667eea;
      color: white;
      border: none;
      font-weight: 600;
      padding: 15px;
    }

    .table td {
      padding: 15px;
      border-color: #e9ecef;
    }

    .total-section {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
    }

    .total-amount {
      font-size: 24px;
      font-weight: 700;
      color: #667eea;
    }

    .action-buttons {
      text-align: center;
      margin-top: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
    }

    @media (max-width: 768px) {
      .invoice-container {
        margin: 10px;
        border-radius: 0;
      }

      .invoice-body {
        padding: 20px;
      }

      .table-responsive {
        font-size: 14px;
      }
    }

    @media print {
      body {
        background: white !important;
      }

      .invoice-container {
        box-shadow: none !important;
        border: 1px solid #ddd !important;
        margin: 0 !important;
        border-radius: 0 !important;
      }

      .action-buttons {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <div class="invoice-container">
    <!-- Header -->
    <div class="invoice-header">
      <h1 class="mb-0">
        <i class="fas fa-receipt me-2"></i>
        Vendor Purchase Invoice
      </h1>
      <p class="mb-0 mt-2 opacity-75">Invoice #<%= @vendor_invoice.invoice_number %></p>
    </div>

    <!-- Body -->
    <div class="invoice-body">
      <!-- Company Info -->
      <div class="company-info">
        <div class="company-name">Ecommerce Store</div>
        <p class="text-muted">Vendor Purchase Management</p>
      </div>

      <!-- Invoice Details -->
      <div class="invoice-details">
        <div class="row">
          <div class="col-md-6">
            <h5><i class="fas fa-building me-2 text-primary"></i>Vendor Information</h5>
            <p class="mb-1"><strong><%= @vendor.name %></strong></p>
            <% if @vendor.email.present? %>
              <p class="mb-1"><i class="fas fa-envelope me-2"></i><%= @vendor.email %></p>
            <% end %>
            <% if @vendor.phone.present? %>
              <p class="mb-1"><i class="fas fa-phone me-2"></i><%= @vendor.phone %></p>
            <% end %>
            <% if @vendor.address.present? %>
              <p class="mb-0"><i class="fas fa-map-marker-alt me-2"></i><%= @vendor.address %></p>
            <% end %>
          </div>
          <div class="col-md-6">
            <h5><i class="fas fa-info-circle me-2 text-primary"></i>Invoice Details</h5>
            <p class="mb-1"><strong>Invoice Number:</strong> <%= @vendor_invoice.invoice_number %></p>
            <p class="mb-1"><strong>Purchase Number:</strong> <%= @vendor_purchase.purchase_number %></p>
            <p class="mb-1"><strong>Invoice Date:</strong> <%= @vendor_invoice.invoice_date.strftime('%B %d, %Y') %></p>
            <p class="mb-1"><strong>Purchase Date:</strong> <%= @vendor_purchase.purchase_date.strftime('%B %d, %Y') %></p>
            <p class="mb-0">
              <strong>Status:</strong>
              <span class="badge <%= @vendor_invoice.status_badge_class %> ms-1">
                <%= @vendor_invoice.status.titleize %>
              </span>
            </p>
          </div>
        </div>
      </div>

      <!-- Items Table -->
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Product</th>
              <th class="text-center">Quantity</th>
              <th class="text-end">Purchase Price</th>
              <th class="text-end">Selling Price</th>
              <th class="text-end">Total</th>
            </tr>
          </thead>
          <tbody>
            <% @purchase_items.each do |item| %>
              <tr>
                <td>
                  <strong><%= item.product.name %></strong>
                  <% if item.product.description.present? %>
                    <br><small class="text-muted"><%= truncate(item.product.description, length: 100) %></small>
                  <% end %>
                </td>
                <td class="text-center">
                  <span class="badge bg-secondary"><%= number_with_delimiter(item.quantity) %></span>
                </td>
                <td class="text-end">₹<%= number_with_delimiter(item.purchase_price.to_i) %></td>
                <td class="text-end">₹<%= number_with_delimiter(item.selling_price.to_i) %></td>
                <td class="text-end">
                  <strong>₹<%= number_with_delimiter((item.quantity * item.purchase_price).to_i) %></strong>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <!-- Total Section -->
      <div class="total-section">
        <div class="row align-items-center">
          <div class="col-md-8">
            <% if @vendor_invoice.notes.present? %>
              <h6><i class="fas fa-sticky-note me-2"></i>Notes</h6>
              <p class="mb-0 text-muted"><%= @vendor_invoice.notes %></p>
            <% end %>
          </div>
          <div class="col-md-4 text-end">
            <h5 class="mb-1">Total Amount</h5>
            <div class="total-amount">₹<%= number_with_delimiter(@vendor_invoice.total_amount.to_i) %></div>
            <% if @vendor_purchase.paid_amount > 0 %>
              <p class="mt-2 mb-0">
                <small class="text-muted">
                  Paid: ₹<%= number_with_delimiter(@vendor_purchase.paid_amount.to_i) %><br>
                  Outstanding: ₹<%= number_with_delimiter(@vendor_purchase.outstanding_amount.to_i) %>
                </small>
              </p>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button onclick="window.print()" class="btn btn-primary me-3">
          <i class="fas fa-print me-2"></i>Print Invoice
        </button>
        <button onclick="shareOnWhatsApp()" class="btn btn-success">
          <i class="fab fa-whatsapp me-2"></i>Share on WhatsApp
        </button>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    function shareOnWhatsApp() {
      const invoiceUrl = window.location.href;
      const message = `Invoice for Purchase #<%= @vendor_purchase.purchase_number %> - Amount: ₹<%= number_with_delimiter(@vendor_invoice.total_amount.to_i) %>\n\nView invoice: ${invoiceUrl}`;
      const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');
    }

    // Auto-print if print parameter is present
    if (new URLSearchParams(window.location.search).has('print')) {
      window.onload = function() {
        setTimeout(function() {
          window.print();
        }, 1000);
      };
    }
  </script>
</body>
</html>
