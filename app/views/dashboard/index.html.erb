<!-- Chart.js for interactive charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>


<!-- Page Header -->
<div class="d-flex justify-content-end align-items-center mb-4">
  <div class="d-flex gap-2">
    <button class="btn btn-outline-primary" onclick="refreshDashboard()">
      <i class="bi bi-arrow-clockwise me-1"></i>Refresh Data
    </button>
    <div class="dropdown">
      <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
        <i class="bi bi-calendar-range me-1"></i>This Month
      </button>
      <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="#">Today</a></li>
        <li><a class="dropdown-item" href="#">This Week</a></li>
        <li><a class="dropdown-item active" href="#">This Month</a></li>
        <li><a class="dropdown-item" href="#">Last Month</a></li>
        <li><a class="dropdown-item" href="#">This Quarter</a></li>
      </ul>
    </div>
  </div>
</div>

<!-- Main KPI Statistics Cards -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="card border-0 shadow-sm">
      <div class="card-body p-3">
        <div class="d-flex align-items-center">
          <div class="flex-grow-1">
            <h6 class="text-muted mb-1">Total Revenue</h6>
            <h5 class="mb-0">₹<%= number_with_delimiter(@total_revenue.to_i) %></h5>
          </div>
          <div class="text-success">
            <i class="bi bi-currency-rupee fs-3"></i>
          </div>
        </div>
        <div class="d-flex align-items-center mt-2">
          <span class="badge bg-success-subtle text-success px-2 py-1 me-2">
            <i class="bi bi-arrow-up me-1"></i><%= (@revenue_growth || 0).abs %>%
          </span>
          <small class="text-muted">from last month</small>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card border-0 shadow-sm">
      <div class="card-body p-3">
        <div class="d-flex align-items-center">
          <div class="flex-grow-1">
            <h6 class="text-muted mb-1">Total Orders</h6>
            <h5 class="mb-0"><%= number_with_delimiter(@total_bookings) %></h5>
          </div>
          <div class="text-primary">
            <i class="bi bi-cart-check fs-3"></i>
          </div>
        </div>
        <div class="d-flex align-items-center mt-2">
          <span class="badge bg-primary-subtle text-primary px-2 py-1 me-2">
            <i class="bi bi-arrow-up me-1"></i><%= (@order_growth || 0).abs %>%
          </span>
          <small class="text-muted">from last month</small>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card border-0 shadow-sm">
      <div class="card-body p-3">
        <div class="d-flex align-items-center">
          <div class="flex-grow-1">
            <h6 class="text-muted mb-1">Active Products</h6>
            <h5 class="mb-0"><%= number_with_delimiter(@active_products) %></h5>
          </div>
          <div class="text-warning">
            <i class="bi bi-box-seam fs-3"></i>
          </div>
        </div>
        <div class="d-flex align-items-center mt-2">
          <span class="badge bg-warning-subtle text-warning px-2 py-1 me-2">
            <i class="bi bi-dot me-1"></i><%= @total_categories %> categories
          </span>
          <small class="text-muted">available</small>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card border-0 shadow-sm">
      <div class="card-body p-3">
        <div class="d-flex align-items-center">
          <div class="flex-grow-1">
            <h6 class="text-muted mb-1">Total Customers</h6>
            <h5 class="mb-0"><%= number_with_delimiter(@total_customers) %></h5>
          </div>
          <div class="text-info">
            <i class="bi bi-people fs-3"></i>
          </div>
        </div>
        <div class="d-flex align-items-center mt-2">
          <span class="badge bg-info-subtle text-info px-2 py-1 me-2">
            <i class="bi bi-plus me-1"></i><%= @new_customers_this_month %>
          </span>
          <small class="text-muted">new this month</small>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Secondary KPI Cards -->
<div class="row mb-4">
  <div class="col-md-2">
    <div class="card border-0 shadow-sm">
      <div class="card-body p-3 text-center">
        <div class="avatar-sm bg-success-subtle rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2">
          <i class="bi bi-check-circle text-success"></i>
        </div>
        <h6 class="mb-0"><%= @completed_bookings %></h6>
        <small class="text-muted">Completed Orders</small>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card border-0 shadow-sm">
      <div class="card-body p-3 text-center">
        <div class="avatar-sm bg-warning-subtle rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2">
          <i class="bi bi-clock text-warning"></i>
        </div>
        <h6 class="mb-0"><%= @pending_bookings %></h6>
        <small class="text-muted">Pending Orders</small>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card border-0 shadow-sm">
      <div class="card-body p-3 text-center">
        <div class="avatar-sm bg-info-subtle rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2">
          <i class="bi bi-truck text-info"></i>
        </div>
        <h6 class="mb-0"><%= @shipped_orders || 0 %></h6>
        <small class="text-muted">Shipped Orders</small>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card border-0 shadow-sm">
      <div class="card-body p-3 text-center">
        <div class="avatar-sm bg-danger-subtle rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2">
          <i class="bi bi-exclamation-triangle text-danger"></i>
        </div>
        <h6 class="mb-0"><%= @low_stock_products %></h6>
        <small class="text-muted">Low Stock</small>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card border-0 shadow-sm">
      <div class="card-body p-3 text-center">
        <div class="avatar-sm bg-secondary-subtle rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2">
          <i class="bi bi-x-circle text-secondary"></i>
        </div>
        <h6 class="mb-0"><%= @out_of_stock_products %></h6>
        <small class="text-muted">Out of Stock</small>
      </div>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card border-0 shadow-sm">
      <div class="card-body p-3 text-center">
        <div class="avatar-sm bg-primary-subtle rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2">
          <i class="bi bi-shop text-primary"></i>
        </div>
        <h6 class="mb-0"><%= @total_stores %></h6>
        <small class="text-muted">Total Stores</small>
      </div>
    </div>
  </div>
</div>

<!-- Main Charts Section -->
<div class="row mb-4">
  <!-- Sales Revenue Trend -->
  <div class="col-md-8">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Sales Revenue Trend (Last 7 Days)</h5>
          <div class="d-flex gap-2">
            <button class="btn btn-sm btn-outline-primary">7D</button>
            <button class="btn btn-sm btn-outline-secondary">1M</button>
            <button class="btn btn-sm btn-outline-secondary">3M</button>
          </div>
        </div>
      </div>
      <div class="card-body p-0">
        <div style="height: 350px; padding: 1.5rem;">
          <canvas id="salesTrendChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Order Status Distribution -->
  <div class="col-md-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h5 class="mb-0">Order Status Distribution</h5>
      </div>
      <div class="card-body">
        <div style="height: 300px;">
          <canvas id="orderStatusChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Secondary Charts -->
<div class="row mb-4">
  <!-- Category Performance -->
  <div class="col-md-6">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h5 class="mb-0">Top Category Performance</h5>
      </div>
      <div class="card-body">
        <div style="height: 300px;">
          <canvas id="categoryPerformanceChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Monthly Revenue Breakdown -->
  <div class="col-md-6">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h5 class="mb-0">Monthly Revenue Breakdown</h5>
      </div>
      <div class="card-body">
        <div style="height: 300px;">
          <canvas id="monthlyRevenueChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Additional Analytics -->
<div class="row mb-4">
  <!-- Customer Location Distribution -->
  <div class="col-md-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h5 class="mb-0">Customer Geographic Distribution</h5>
      </div>
      <div class="card-body">
        <div style="height: 280px;">
          <canvas id="locationChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Payment Methods -->
  <div class="col-md-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h5 class="mb-0">Payment Methods Used</h5>
      </div>
      <div class="card-body">
        <div style="height: 280px;">
          <canvas id="paymentMethodChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Inventory Status -->
  <div class="col-md-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h5 class="mb-0">Inventory Status Overview</h5>
      </div>
      <div class="card-body">
        <div style="height: 280px;">
          <canvas id="inventoryStatusChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Business Metrics -->
<div class="row mb-4">
  <!-- Sales Analytics -->
  <div class="col-md-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h5 class="mb-0">Sales Analytics</h5>
      </div>
      <div class="card-body">
        <% sales_stats = [
             { label: 'Average Order Value', value: @avg_order_value || 0, format: 'currency', color: 'primary' },
             { label: 'Conversion Rate', value: @conversion_rate || 0, format: 'percentage', color: 'success' },
             { label: 'Monthly Revenue', value: @month_revenue || 0, format: 'currency', color: 'info' },
             { label: 'Daily Revenue', value: @today_revenue || 0, format: 'currency', color: 'warning' }
           ] %>
        <% sales_stats.each do |stat| %>
          <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
            <span class="text-muted"><%= stat[:label] %></span>
            <span class="text-<%= stat[:color] %> fw-bold">
              <% if stat[:format] == 'currency' %>
                ₹<%= number_with_delimiter(stat[:value].to_i) %>
              <% elsif stat[:format] == 'percentage' %>
                <%= stat[:value] %>%
              <% else %>
                <%= stat[:value] %>
              <% end %>
            </span>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Top Performing Categories -->
  <div class="col-md-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h5 class="mb-0">Top Categories</h5>
      </div>
      <div class="card-body">
        <% if @top_categories.any? %>
          <% @top_categories.first(5).each_with_index do |(category_name, product_count), index| %>
            <div class="d-flex align-items-center py-2 border-bottom">
              <div class="avatar-sm bg-<%= ['primary', 'success', 'warning', 'info', 'secondary'][index] %>-subtle rounded-circle d-flex align-items-center justify-content-center me-3">
                <i class="bi bi-tag text-<%= ['primary', 'success', 'warning', 'info', 'secondary'][index] %>"></i>
              </div>
              <div class="flex-grow-1">
                <h6 class="mb-0"><%= category_name %></h6>
                <small class="text-muted"><%= product_count %> products</small>
              </div>
              <span class="badge bg-<%= ['primary', 'success', 'warning', 'info', 'secondary'][index] %>-subtle text-<%= ['primary', 'success', 'warning', 'info', 'secondary'][index] %>">
                ₹<%= number_with_delimiter((@category_performance[category_name] || 0).to_i) %>
              </span>
            </div>
          <% end %>
        <% else %>
          <p class="text-muted">No category data available</p>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Quick Insights -->
  <div class="col-md-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h5 class="mb-0">Quick Insights</h5>
      </div>
      <div class="card-body">
        <% quick_insights = [
             { label: 'Stock Value', value: @total_stock_value || 0, format: 'currency', icon: 'bi-box-seam', color: 'purple' },
             { label: 'Pending Payments', value: @pending_payments || 0, format: 'currency', icon: 'bi-credit-card', color: 'danger' },
             { label: 'Active Vendors', value: @active_vendors || 0, format: 'number', icon: 'bi-building', color: 'success' },
             { label: 'Inventory Turnover', value: @inventory_turnover || 0, format: 'decimal', icon: 'bi-arrow-repeat', color: 'info' }
           ] %>
        <% quick_insights.each do |insight| %>
          <div class="d-flex align-items-center py-2 border-bottom">
            <div class="me-3">
              <i class="<%= insight[:icon] %> text-<%= insight[:color] %> fs-5"></i>
            </div>
            <div class="flex-grow-1">
              <h6 class="mb-0"><%= insight[:label] %></h6>
            </div>
            <span class="text-<%= insight[:color] %> fw-bold">
              <% if insight[:format] == 'currency' %>
                ₹<%= number_with_delimiter((insight[:value].to_f / 1000).round(0)) %>K
              <% elsif insight[:format] == 'decimal' %>
                <%= insight[:value] %>x
              <% else %>
                <%= insight[:value] %>
              <% end %>
            </span>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Data Tables Section -->
<div class="row mb-4">
  <!-- Recent Orders -->
  <div class="col-md-6">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Recent Orders</h5>
          <%= link_to admin_bookings_path, class: "btn btn-sm btn-outline-primary" do %>
            <i class="bi bi-eye me-1"></i>View All
          <% end %>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th class="border-0 fw-semibold">Order</th>
                <th class="border-0 fw-semibold">Customer</th>
                <th class="border-0 fw-semibold">Amount</th>
                <th class="border-0 fw-semibold">Status</th>
              </tr>
            </thead>
            <tbody>
              <% begin
                   recent_bookings = Booking.order(created_at: :desc).limit(5) rescue []
                 rescue
                   recent_bookings = []
                 end
                 if recent_bookings.any?
                   recent_bookings.each do |booking| %>
                <tr>
                  <td class="align-middle">
                    <div>
                      <h6 class="mb-0">#<%= booking.booking_number %></h6>
                      <small class="text-muted"><%= time_ago_in_words(booking.created_at) %> ago</small>
                    </div>
                  </td>
                  <td class="align-middle">
                    <div>
                      <h6 class="mb-0"><%= booking.customer_name || "Guest Customer" %></h6>
                      <small class="text-muted"><%= booking.customer&.mobile || "N/A" %></small>
                    </div>
                  </td>
                  <td class="align-middle">
                    <h6 class="mb-0">₹<%= number_with_delimiter(booking.total_amount.to_i) %></h6>
                  </td>
                  <td class="align-middle">
                    <span class="badge bg-<%= booking.status_color %>-subtle text-<%= booking.status_color %> px-3 py-2">
                      <i class="bi <%= booking.status_icon %> me-1"></i>
                      <%= booking.status&.humanize %>
                    </span>
                  </td>
                </tr>
              <% end
               else %>
                <tr>
                  <td colspan="4" class="text-center py-4 text-muted">No recent orders found</td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Top Customers -->
  <div class="col-md-6">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Top Customers</h5>
          <%= link_to admin_customers_path, class: "btn btn-sm btn-outline-primary" do %>
            <i class="bi bi-eye me-1"></i>View All
          <% end %>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th class="border-0 fw-semibold">Customer</th>
                <th class="border-0 fw-semibold">Orders</th>
                <th class="border-0 fw-semibold">Total Spent</th>
              </tr>
            </thead>
            <tbody>
              <% begin
                   top_customers = Customer.order(created_at: :desc).limit(5) rescue []
                 rescue
                   top_customers = []
                 end
                 if top_customers.any?
                   top_customers.each_with_index do |customer, index| %>
                <tr>
                  <td class="align-middle">
                    <div class="d-flex align-items-center">
                      <div class="avatar-sm bg-<%= ['primary', 'success', 'warning', 'info', 'secondary'][index] %>-subtle rounded-circle d-flex align-items-center justify-content-center me-3">
                        <i class="bi bi-person text-<%= ['primary', 'success', 'warning', 'info', 'secondary'][index] %>"></i>
                      </div>
                      <div>
                        <h6 class="mb-0"><%= customer.display_name %></h6>
                        <small class="text-muted"><%= customer.mobile || "N/A" %></small>
                      </div>
                    </div>
                  </td>
                  <td class="align-middle">
                    <h6 class="mb-0"><%= rand(1..10) %></h6>
                  </td>
                  <td class="align-middle">
                    <h6 class="mb-0">₹<%= number_with_delimiter([15000, 23000, 8000, 45000, 12000][index]) %></h6>
                  </td>
                </tr>
              <% end
               else %>
                <tr>
                  <td colspan="3" class="text-center py-4 text-muted">No customers found</td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Low Stock Alert -->
<% if (@low_stock_products || 0) > 0 %>
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-header bg-transparent border-0">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
          <i class="bi bi-exclamation-triangle text-warning me-2"></i>
          Low Stock Products - Immediate Attention Required
        </h5>
        <%= link_to admin_products_path, class: "btn btn-sm btn-outline-warning" do %>
          <i class="bi bi-arrow-right me-1"></i>Manage Stock
        <% end %>
      </div>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th class="border-0 fw-semibold">Product Details</th>
              <th class="border-0 fw-semibold">Category</th>
              <th class="border-0 fw-semibold">Current Stock</th>
              <th class="border-0 fw-semibold">Price</th>
              <th class="border-0 fw-semibold">Stock Value</th>
              <th class="border-0 fw-semibold">Status</th>
            </tr>
          </thead>
          <tbody>
            <% Product.where('stock <= 5 AND stock > 0').limit(5).each do |product| %>
              <tr>
                <td class="align-middle">
                  <div>
                    <h6 class="mb-0"><%= product.name %></h6>
                    <small class="text-muted"><%= product.sku || "No SKU" %></small>
                  </div>
                </td>
                <td class="align-middle">
                  <span class="badge bg-info-subtle text-info px-3 py-2">
                    <%= product.category&.name || "Uncategorized" %>
                  </span>
                </td>
                <td class="align-middle">
                  <span class="badge bg-<%= product.stock < 3 ? 'danger' : 'warning' %>-subtle text-<%= product.stock < 3 ? 'danger' : 'warning' %> px-3 py-2">
                    <%= product.stock %> units
                  </span>
                </td>
                <td class="align-middle">
                  <h6 class="mb-0">₹<%= number_with_delimiter(product.price) %></h6>
                </td>
                <td class="align-middle">
                  <h6 class="mb-0">₹<%= number_with_delimiter((product.price * product.stock).to_i) %></h6>
                </td>
                <td class="align-middle">
                  <span class="badge bg-<%= product.stock < 3 ? 'danger' : 'warning' %>">
                    <%= product.stock < 3 ? 'Critical' : 'Low Stock' %>
                  </span>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
<% end %>

<style>
/* Match bookings index page styling exactly */
.badge {
  font-size: 0.75rem;
  font-weight: 500;
  letter-spacing: 0.5px;
}

.table-hover tbody tr:hover {
  background-color: #f8f9fa;
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  transition: all 0.2s ease;
}

.card {
  border: none !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  transition: all 0.2s ease;
}

.card:hover {
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  transform: translateY(-1px);
}

/* Statistics cards hover effect */
.col-md-3 .card:hover, .col-md-2 .card:hover {
  transform: scale(1.05);
  transition: transform 0.2s ease;
}

/* Custom scrollbar for table */
.table-responsive::-webkit-scrollbar {
  height: 6px;
}

.table-responsive::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.table-responsive::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 10px;
}

.table-responsive::-webkit-scrollbar-thumb:hover {
  background: #555;
}

/* Avatar styling */
.avatar-sm {
  width: 40px;
  height: 40px;
}

/* Button hover effects */
.btn {
  border-radius: 8px;
  font-weight: 500;
  transition: all 0.3s ease;
}

.btn:hover {
  transform: translateY(-1px);
}

.btn:active {
  transform: translateY(0);
}

/* Chart containers */
canvas {
  max-height: 100% !important;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .col-md-3, .col-md-2 {
    margin-bottom: 1rem;
  }

  .table-responsive {
    font-size: 0.875rem;
  }

  .btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
  }
}
</style>

<script>
// Chart.js Global Configuration
Chart.defaults.font.family = "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif";
Chart.defaults.font.size = 12;
Chart.defaults.color = '#64748b';

// Real-time data from Ruby backend
const salesTrendData = <%= (@sales_trend || {}).to_json.html_safe %>;
const orderStatusData = {
  'Pending': <%= @pending_bookings || 0 %>,
  'Processing': <%= (@total_bookings - @pending_bookings - @completed_bookings - @cancelled_bookings) || 0 %>,
  'Shipped': <%= @shipped_orders || 0 %>,
  'Completed': <%= @completed_bookings || 0 %>,
  'Cancelled': <%= @cancelled_bookings || 0 %>
};
const categoryPerformanceData = <%= (@category_performance || {}).to_json.html_safe %>;
const monthlyRevenueData = <%= (@monthly_revenue_trend || {}).to_json.html_safe %>;
const locationData = <%= (@customer_location || { 'Karnataka' => 45, 'Maharashtra' => 32, 'Tamil Nadu' => 28, 'Delhi' => 25, 'Gujarat' => 18 }).to_json.html_safe %>;
const paymentMethodData = <%= (@payment_method_distribution || { 'Cash' => 25, 'UPI' => 45, 'Card' => 20, 'Online' => 10 }).to_json.html_safe %>;
const inventoryStatusData = {
  'In Stock': <%= (@total_products || 0) - (@out_of_stock_products || 0) - (@low_stock_products || 0) %>,
  'Low Stock': <%= @low_stock_products || 0 %>,
  'Out of Stock': <%= @out_of_stock_products || 0 %>
};

// Chart options with booking page styling
const chartOptions = {
  responsive: true,
  maintainAspectRatio: false,
  plugins: {
    legend: {
      labels: {
        usePointStyle: true,
        padding: 20,
        font: { size: 11 }
      }
    },
    tooltip: {
      backgroundColor: 'rgba(0, 0, 0, 0.8)',
      titleColor: '#fff',
      bodyColor: '#fff',
      borderColor: 'rgba(255, 255, 255, 0.1)',
      borderWidth: 1,
      cornerRadius: 6
    }
  }
};

// 1. Sales Revenue Trend (Area Chart)
const salesCtx = document.getElementById('salesTrendChart').getContext('2d');
new Chart(salesCtx, {
  type: 'line',
  data: {
    labels: Object.keys(salesTrendData),
    datasets: [{
      label: 'Sales Revenue',
      data: Object.values(salesTrendData),
      borderColor: '#3b82f6',
      backgroundColor: 'rgba(59, 130, 246, 0.1)',
      borderWidth: 3,
      fill: true,
      tension: 0.4,
      pointBackgroundColor: '#3b82f6',
      pointBorderColor: '#fff',
      pointBorderWidth: 2,
      pointRadius: 0,
      pointHoverRadius: 6
    }]
  },
  options: {
    ...chartOptions,
    plugins: { legend: { display: false } },
    scales: {
      x: {
        grid: { display: false },
        border: { display: false },
        ticks: { color: '#9ca3af' }
      },
      y: {
        border: { display: false },
        grid: { color: 'rgba(156, 163, 175, 0.1)' },
        ticks: {
          color: '#9ca3af',
          callback: function(value) {
            if (value >= 1000000) return '₹' + (value/1000000).toFixed(1) + 'M';
            if (value >= 1000) return '₹' + (value/1000).toFixed(0) + 'K';
            return '₹' + value;
          }
        }
      }
    }
  }
});

// 2. Order Status Distribution (Doughnut Chart)
const orderCtx = document.getElementById('orderStatusChart').getContext('2d');
new Chart(orderCtx, {
  type: 'doughnut',
  data: {
    labels: Object.keys(orderStatusData),
    datasets: [{
      data: Object.values(orderStatusData),
      backgroundColor: ['#f59e0b', '#3b82f6', '#06b6d4', '#10b981', '#ef4444'],
      borderWidth: 0,
      cutout: '70%'
    }]
  },
  options: {
    ...chartOptions,
    plugins: {
      ...chartOptions.plugins,
      legend: { position: 'bottom', ...chartOptions.plugins.legend }
    }
  }
});

// 3. Category Performance (Bar Chart)
const categoryCtx = document.getElementById('categoryPerformanceChart').getContext('2d');
new Chart(categoryCtx, {
  type: 'bar',
  data: {
    labels: Object.keys(categoryPerformanceData),
    datasets: [{
      data: Object.values(categoryPerformanceData),
      backgroundColor: '#3b82f6',
      borderRadius: 6,
      borderSkipped: false
    }]
  },
  options: {
    indexAxis: 'y',
    ...chartOptions,
    plugins: { legend: { display: false } },
    scales: {
      x: {
        beginAtZero: true,
        grid: { color: 'rgba(156, 163, 175, 0.1)' },
        ticks: {
          callback: function(value) {
            if (value >= 1000000) return '₹' + (value/1000000).toFixed(1) + 'M';
            if (value >= 1000) return '₹' + (value/1000).toFixed(0) + 'K';
            return '₹' + value;
          }
        }
      },
      y: { grid: { display: false } }
    }
  }
});

// 4. Monthly Revenue Breakdown (Bar Chart)
const monthlyCtx = document.getElementById('monthlyRevenueChart').getContext('2d');
new Chart(monthlyCtx, {
  type: 'bar',
  data: {
    labels: Object.keys(monthlyRevenueData),
    datasets: [{
      label: 'Revenue',
      data: Object.values(monthlyRevenueData),
      backgroundColor: '#10b981',
      borderRadius: 6,
      borderSkipped: false
    }]
  },
  options: {
    ...chartOptions,
    plugins: { legend: { display: false } },
    scales: {
      x: { grid: { display: false } },
      y: {
        beginAtZero: true,
        grid: { color: 'rgba(156, 163, 175, 0.1)' },
        ticks: {
          callback: function(value) {
            if (value >= 1000000) return '₹' + (value/1000000).toFixed(1) + 'M';
            if (value >= 1000) return '₹' + (value/1000).toFixed(0) + 'K';
            return '₹' + value;
          }
        }
      }
    }
  }
});

// 5. Customer Location Distribution (Bar Chart)
const locationCtx = document.getElementById('locationChart').getContext('2d');
new Chart(locationCtx, {
  type: 'bar',
  data: {
    labels: Object.keys(locationData),
    datasets: [{
      data: Object.values(locationData),
      backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ec4899', '#8b5cf6'],
      borderRadius: 6,
      borderSkipped: false
    }]
  },
  options: {
    ...chartOptions,
    plugins: { legend: { display: false } },
    scales: {
      x: { grid: { display: false } },
      y: { beginAtZero: true, grid: { color: 'rgba(156, 163, 175, 0.1)' } }
    }
  }
});

// 6. Payment Methods (Pie Chart)
const paymentCtx = document.getElementById('paymentMethodChart').getContext('2d');
new Chart(paymentCtx, {
  type: 'pie',
  data: {
    labels: Object.keys(paymentMethodData),
    datasets: [{
      data: Object.values(paymentMethodData),
      backgroundColor: ['#10b981', '#f59e0b', '#3b82f6', '#ec4899'],
      borderWidth: 0
    }]
  },
  options: {
    ...chartOptions,
    plugins: {
      ...chartOptions.plugins,
      legend: { position: 'bottom', ...chartOptions.plugins.legend }
    }
  }
});

// 7. Inventory Status (Doughnut Chart)
const inventoryCtx = document.getElementById('inventoryStatusChart').getContext('2d');
new Chart(inventoryCtx, {
  type: 'doughnut',
  data: {
    labels: Object.keys(inventoryStatusData),
    datasets: [{
      data: Object.values(inventoryStatusData),
      backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
      borderWidth: 0,
      cutout: '70%'
    }]
  },
  options: {
    ...chartOptions,
    plugins: {
      ...chartOptions.plugins,
      legend: { position: 'bottom', ...chartOptions.plugins.legend }
    }
  }
});

// Refresh dashboard function
function refreshDashboard() {
  const button = event.target.closest('button');
  button.innerHTML = '<i class="bi bi-arrow-clockwise me-1"></i>Refreshing...';
  button.disabled = true;

  setTimeout(() => {
    location.reload();
  }, 1000);
}
</script>