<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-1">Edit Invoice</h2>
    <p class="text-muted mb-0">Update invoice details for <%= @invoice.customer.display_name %></p>
  </div>
  <div>
    <%= link_to admin_invoices_path, class: "btn btn-outline-secondary me-2" do %>
      <i class="bi bi-arrow-left me-1"></i>Back to Invoices
    <% end %>
    <%= link_to admin_invoice_path(@invoice), class: "btn btn-outline-primary" do %>
      <i class="bi bi-eye me-1"></i>View Invoice
    <% end %>
  </div>
</div>

<div class="row">
  <div class="col-lg-8">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white border-0 py-3">
        <h6 class="mb-0 text-dark">Invoice Details</h6>
      </div>
      <div class="card-body">
        <%= form_with model: [:admin, @invoice], local: true, class: "row g-3" do |f| %>
          <% if @invoice.errors.any? %>
            <div class="col-12">
              <div class="alert alert-danger" role="alert">
                <h6 class="alert-heading">Please correct the following errors:</h6>
                <ul class="mb-0">
                  <% @invoice.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            </div>
          <% end %>

          <div class="col-md-6">
            <%= f.label :invoice_date, class: "form-label" %>
            <%= f.date_field :invoice_date, class: "form-control" %>
          </div>

          <div class="col-md-6">
            <%= f.label :due_date, class: "form-label" %>
            <%= f.date_field :due_date, class: "form-control" %>
          </div>

          <div class="col-md-6">
            <%= f.label :status, class: "form-label" %>
            <%= f.select :status, options_for_select([
                  ['Draft', 'draft'],
                  ['Sent', 'sent'],
                  ['Paid', 'paid'],
                  ['Cancelled', 'cancelled']
                ], @invoice.status), {}, { class: "form-select" } %>
          </div>

          <div class="col-md-6">
            <%= f.label :payment_status, class: "form-label" %>
            <%= f.select :payment_status, options_for_select([
                  ['Unpaid', 'unpaid'],
                  ['Partially Paid', 'partially_paid'],
                  ['Fully Paid', 'fully_paid']
                ], @invoice.payment_status), {}, { class: "form-select" } %>
          </div>

          <div class="col-md-6">
            <%= f.label :total_amount, class: "form-label" %>
            <div class="input-group">
              <span class="input-group-text">₹</span>
              <%= f.number_field :total_amount, step: 0.01, class: "form-control" %>
            </div>
          </div>

          <div class="col-12">
            <%= f.label :notes, class: "form-label" %>
            <%= f.text_area :notes, rows: 4, class: "form-control", placeholder: "Add any notes or comments..." %>
          </div>

          <div class="col-12">
            <div class="d-flex gap-2">
              <%= f.submit "Update Invoice", class: "btn btn-primary" %>
              <%= link_to "Cancel", admin_invoice_path(@invoice), class: "btn btn-outline-secondary" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white border-0 py-3">
        <h6 class="mb-0 text-dark">Invoice Summary</h6>
      </div>
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <span class="text-muted">Invoice Number</span>
          <span class="fw-medium"><%= @invoice.invoice_number %></span>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-3">
          <span class="text-muted">Customer</span>
          <span class="fw-medium"><%= @invoice.customer.display_name %></span>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-3">
          <span class="text-muted">Current Status</span>
          <% case @invoice.payment_status %>
          <% when 'fully_paid' %>
            <span class="badge bg-success">Paid</span>
          <% when 'partially_paid' %>
            <span class="badge bg-warning">Partial</span>
          <% else %>
            <span class="badge bg-secondary">Unpaid</span>
          <% end %>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-3">
          <span class="text-muted">Total Amount</span>
          <span class="fw-bold text-primary">₹<%= number_with_delimiter(@invoice.total_amount.to_i) %></span>
        </div>

        <hr>

        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="text-muted">Created</span>
          <span class="small"><%= @invoice.created_at.strftime("%d %b %Y") %></span>
        </div>

        <div class="d-flex justify-content-between align-items-center">
          <span class="text-muted">Last Updated</span>
          <span class="small"><%= @invoice.updated_at.strftime("%d %b %Y") %></span>
        </div>
      </div>
    </div>

    <% if @invoice_items.any? %>
      <div class="card border-0 shadow-sm mt-4">
        <div class="card-header bg-white border-0 py-3">
          <h6 class="mb-0 text-dark">Invoice Items</h6>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-sm mb-0">
              <thead class="table-light">
                <tr>
                  <th class="border-0">Item</th>
                  <th class="border-0 text-center">Qty</th>
                  <th class="border-0 text-end">Amount</th>
                </tr>
              </thead>
              <tbody>
                <% @invoice_items.each do |item| %>
                  <tr>
                    <td class="border-0">
                      <div class="small fw-medium"><%= item.description || item.product&.name %></div>
                    </td>
                    <td class="border-0 text-center small"><%= item.quantity %></td>
                    <td class="border-0 text-end small">₹<%= number_with_delimiter(item.total_amount.to_i) %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>