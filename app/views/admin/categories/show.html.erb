<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-1">Category Details</h2>
    <p class="text-muted mb-0">View and manage category information</p>
  </div>
  <div>
    <%= link_to admin_categories_path, class: "btn btn-secondary me-2" do %>
      <i class="bi bi-arrow-left me-1"></i>
      Back to Categories
    <% end %>
    <%= link_to edit_admin_category_path(@category), class: "btn btn-primary" do %>
      <i class="bi bi-pencil me-1"></i>
      Edit Category
    <% end %>
  </div>
</div>

<!-- Category Info Card -->
<div class="row">
  <div class="col-xl-9">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <div class="d-flex align-items-center">
          <% if @category.image.attached? %>
            <%= image_tag @category.image, class: "avatar-lg rounded me-3", style: "width: 60px; height: 60px; object-fit: cover;",
                onerror: "this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';" %>
            <div class="avatar-lg bg-primary-subtle rounded-circle align-items-center justify-content-center me-3 d-none">
              <i class="bi bi-tag text-primary fs-1"></i>
            </div>
          <% else %>
            <div class="avatar-lg bg-primary-subtle rounded-circle d-flex align-items-center justify-content-center me-3">
              <i class="bi bi-tag text-primary fs-1"></i>
            </div>
          <% end %>
          <div>
            <h5 class="mb-1"><%= @category.name %></h5>
            <p class="text-muted mb-0">
              Category
              <% if @category.status %>
                <span class="badge bg-success-subtle text-success ms-2">
                  <i class="bi bi-check-circle me-1"></i>
                  Active
                </span>
              <% else %>
                <span class="badge bg-danger-subtle text-danger ms-2">
                  <i class="bi bi-x-circle me-1"></i>
                  Inactive
                </span>
              <% end %>
            </p>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-sm-6">
            <h6 class="text-muted mb-1">Description</h6>
            <p class="mb-0"><%= @category.description.present? ? @category.description : '-' %></p>
          </div>
          <div class="col-sm-6">
            <h6 class="text-muted mb-1">Display Order</h6>
            <p class="mb-0"><%= @category.display_order %></p>
          </div>
          <div class="col-sm-6">
            <h6 class="text-muted mb-1">Total Products</h6>
            <p class="mb-0"><%= @category.products_count %></p>
          </div>
          <div class="col-sm-6">
            <h6 class="text-muted mb-1">Created Date</h6>
            <p class="mb-0"><%= @category.created_at.in_time_zone("Asia/Kolkata").strftime("%d %b %Y at %I:%M %p IST") %></p>
          </div>
        </div>
      </div>
    </div>


    <!-- Recent Products -->
    <% if @products.any? %>
      <div class="card border-0 shadow-sm mt-4">
        <div class="card-header bg-transparent border-0">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Recent Products (<%= @category.products_count %>)</h5>
            <% if @category.products_count > 10 %>
              <%= link_to admin_products_path(category_id: @category.id), class: "btn btn-sm btn-outline-primary" do %>
                View All <i class="bi bi-arrow-right"></i>
              <% end %>
            <% end %>
          </div>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th class="border-0 fw-semibold">Product</th>
                  <th class="border-0 fw-semibold">SKU</th>
                  <th class="border-0 fw-semibold">Price</th>
                  <th class="border-0 fw-semibold">Stock</th>
                  <th class="border-0 fw-semibold">Status</th>
                </tr>
              </thead>
              <tbody>
                <% @products.each do |product| %>
                  <tr>
                    <td class="align-middle">
                      <div class="d-flex align-items-center">
                        <% if product.main_image %>
                          <%= image_tag product.main_image, class: "avatar-xs rounded me-2", style: "width: 30px; height: 30px; object-fit: cover;" %>
                        <% else %>
                          <div class="avatar-xs bg-primary-subtle rounded me-2 d-flex align-items-center justify-content-center">
                            <i class="bi bi-image text-primary"></i>
                          </div>
                        <% end %>
                        <%= link_to product.name, admin_product_path(product), class: "text-decoration-none fw-medium" %>
                      </div>
                    </td>
                    <td class="align-middle"><%= product.sku %></td>
                    <td class="align-middle"><%= product.formatted_selling_price %></td>
                    <td class="align-middle">
                      <span class="<%= product.stock_status_class %>">
                        <%= product.stock %>
                      </span>
                    </td>
                    <td class="align-middle">
                      <% if product.active? %>
                        <span class="badge bg-success-subtle text-success">
                          <%= product.status&.humanize || 'Active' %>
                        </span>
                      <% else %>
                        <span class="badge bg-danger-subtle text-danger">
                          <%= product.status&.humanize || 'Inactive' %>
                        </span>
                      <% end %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    <% end %>
    </div>

  <div class="col-xl-3">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h5 class="mb-0">Quick Actions</h5>
      </div>
      <div class="card-body">
        <div class="d-grid gap-2">
          <%= link_to edit_admin_category_path(@category), class: "btn btn-primary" do %>
            <i class="bi bi-pencil me-1"></i> Edit Category
          <% end %>

          <%= link_to new_admin_product_path(category_id: @category.id), class: "btn btn-outline-primary" do %>
            <i class="bi bi-bag-plus me-1"></i> Add Product
          <% end %>

          <hr>

          <%= link_to admin_category_path(@category),
              class: "btn btn-outline-danger",
              data: {
                method: :delete,
                confirm: "Are you sure you want to delete this category? This action cannot be undone.",
                turbo_method: :delete
              } do %>
            <i class="bi bi-trash me-1"></i> Delete Category
          <% end %>
        </div>
      </div>
    </div>

    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h5 class="mb-0">Statistics</h5>
      </div>
      <div class="card-body">
        <div class="row g-2">
          <div class="col-6">
            <div class="text-center">
              <h4 class="mb-1 text-primary"><%= @category.products_count %></h4>
              <p class="text-muted mb-0">Products</p>
            </div>
          </div>
          <div class="col-6">
            <div class="text-center">
              <h4 class="mb-1 text-info"><%= @category.status ? 'Active' : 'Inactive' %></h4>
              <p class="text-muted mb-0">Status</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>