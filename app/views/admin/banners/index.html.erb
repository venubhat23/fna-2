<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-1">Banner Management</h2>
    <p class="text-muted mb-0">Manage promotional and informational banners Dr WISE the platform</p>
  </div>
  <div class="d-flex gap-2">
    <%= link_to new_admin_banner_path, class: "btn btn-primary" do %>
      <i class="bi bi-plus-lg me-1"></i>
      Add New Banner
    <% end %>
  </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
  <div class="col-xl-3 col-md-6 mb-3">
    <div class="card h-100 border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <h6 class="text-muted mb-2">Total Banners</h6>
            <h3 class="mb-0 text-primary"><%= number_with_delimiter(@stats[:total_banners]) %></h3>
          </div>
          <div class="bg-primary bg-opacity-10 rounded p-3">
            <i class="bi bi-image text-primary fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-3">
    <div class="card h-100 border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <h6 class="text-muted mb-2">Active Banners</h6>
            <h3 class="mb-0 text-success"><%= number_with_delimiter(@stats[:active_banners]) %></h3>
          </div>
          <div class="bg-success bg-opacity-10 rounded p-3">
            <i class="bi bi-check-circle text-success fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-3">
    <div class="card h-100 border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <h6 class="text-muted mb-2">Currently Displayed</h6>
            <h3 class="mb-0 text-info"><%= number_with_delimiter(@stats[:current_banners]) %></h3>
          </div>
          <div class="bg-info bg-opacity-10 rounded p-3">
            <i class="bi bi-display text-info fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-3">
    <div class="card h-100 border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <h6 class="text-muted mb-2">Expired Banners</h6>
            <h3 class="mb-0 text-warning"><%= number_with_delimiter(@stats[:expired_banners]) %></h3>
          </div>
          <div class="bg-warning bg-opacity-10 rounded p-3">
            <i class="bi bi-clock-history text-warning fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Filters with onChange -->
<div class="card border-0 shadow-sm mb-4">
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-3">
        <select id="status_filter" class="form-select" onchange="applyFilters()">
          <option value="">All Status</option>
          <option value="active" <%= 'selected' if params[:status] == 'active' %>>Active</option>
          <option value="inactive" <%= 'selected' if params[:status] == 'inactive' %>>Inactive</option>
          <option value="current" <%= 'selected' if params[:status] == 'current' %>>Currently Displayed</option>
        </select>
      </div>
      <div class="col-md-3">
        <select id="location_filter" class="form-select" onchange="applyFilters()">
          <option value="">All Locations</option>
          <option value="dashboard" <%= 'selected' if params[:location] == 'dashboard' %>>Dashboard</option>
          <option value="login" <%= 'selected' if params[:location] == 'login' %>>Login Page</option>
          <option value="home" <%= 'selected' if params[:location] == 'home' %>>Home Page</option>
          <option value="sidebar" <%= 'selected' if params[:location] == 'sidebar' %>>Sidebar Ad</option>
        </select>
      </div>
      <div class="col-md-3">
        <%= link_to "Clear", admin_banners_path, class: "btn btn-outline-secondary" %>
      </div>
    </div>
  </div>
</div>

<script>
function applyFilters() {
  const statusFilter = document.getElementById('status_filter').value;
  const locationFilter = document.getElementById('location_filter').value;

  const url = new URL(window.location.href);
  url.searchParams.delete('status');
  url.searchParams.delete('location');

  if (statusFilter) {
    url.searchParams.set('status', statusFilter);
  }

  if (locationFilter) {
    url.searchParams.set('location', locationFilter);
  }

  window.location.href = url.toString();
}
</script>

<!-- Banners List -->
<div class="card border-0 shadow-sm">
  <div class="card-header bg-transparent border-0">
    <h5 class="mb-0">Banner List</h5>
  </div>
  <div class="card-body p-0">
    <% if @banners.any? %>
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="bg-light">
            <tr>
              <th class="border-0">Preview</th>
              <th class="border-0">Title</th>
              <th class="border-0">Location</th>
              <th class="border-0">Display Period</th>
              <th class="border-0">Order</th>
              <th class="border-0">Status</th>
              <th class="border-0">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @banners.each do |banner| %>
              <tr>
                <td>
                  <% if banner.has_image? %>
                    <%= image_tag banner.main_image_url, class: "rounded", style: "width: 60px; height: 40px; object-fit: cover;" %>
                  <% else %>
                    <div class="bg-light rounded d-flex align-items-center justify-content-center" style="width: 60px; height: 40px;">
                      <i class="bi bi-image text-muted"></i>
                    </div>
                  <% end %>
                </td>
                <td>
                  <div>
                    <h6 class="mb-1"><%= banner.title %></h6>
                    <small class="text-muted"><%= truncate(banner.description, length: 50) %></small>
                  </div>
                </td>
                <td>
                  <span class="badge bg-secondary"><%= banner.display_location_humanized %></span>
                </td>
                <td>
                  <div>
                    <small class="d-block">
                      <strong>Start:</strong> <%= banner.display_start_date.strftime('%d/%m/%Y') %>
                    </small>
                    <small class="d-block">
                      <strong>End:</strong> <%= banner.display_end_date.strftime('%d/%m/%Y') %>
                    </small>
                    <% if banner.current? %>
                      <small class="text-success"><i class="bi bi-circle-fill me-1"></i>Current</small>
                    <% elsif banner.expired? %>
                      <small class="text-danger"><i class="bi bi-circle-fill me-1"></i>Expired</small>
                    <% else %>
                      <small class="text-warning"><i class="bi bi-circle-fill me-1"></i>Upcoming</small>
                    <% end %>
                  </div>
                </td>
                <td>
                  <span class="badge bg-info"><%= banner.display_order %></span>
                </td>
                <td>
                  <span class="badge bg-<%= banner.status? ? 'success' : 'secondary' %>">
                    <%= banner.status? ? 'Active' : 'Inactive' %>
                  </span>
                </td>
                <td>
                  <div class="d-flex gap-1">
                    <%= link_to admin_banner_path(banner), class: "btn btn-sm btn-outline-primary", title: "View" do %>
                      <i class="bi bi-eye"></i>
                    <% end %>
                    <%= link_to edit_admin_banner_path(banner), class: "btn btn-sm btn-outline-warning", title: "Edit" do %>
                      <i class="bi bi-pencil"></i>
                    <% end %>
                    <%= link_to toggle_status_admin_banner_path(banner),
                        method: :patch,
                        class: "btn btn-sm btn-outline-#{banner.status? ? 'secondary' : 'success'}",
                        title: banner.status? ? 'Deactivate' : 'Activate',
                        data: {
                          confirm: "Are you sure you want to #{banner.status? ? 'deactivate' : 'activate'} this banner?",
                          turbo_method: :patch
                        } do %>
                      <i class="bi bi-#{banner.status? ? 'pause-circle' : 'play-circle'}"></i>
                    <% end %>
                    <%= button_to admin_banner_path(banner),
                        method: :delete,
                        class: "btn btn-sm btn-outline-danger",
                        title: "Delete",
                        data: {
                          confirm: "Are you sure you want to delete this banner?"
                        },
                        form: { style: "display: inline;" } do %>
                      <i class="bi bi-trash"></i>
                    <% end %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <% if @banners.respond_to?(:total_pages) %>
        <div class="card-footer bg-transparent border-0">
          <%= paginate @banners %>
        </div>
      <% end %>
    <% else %>
      <div class="text-center py-5">
        <i class="bi bi-image fs-1 text-muted d-block mb-3"></i>
        <h5 class="text-muted">No banners found</h5>
        <p class="text-muted mb-3">
          <% if params[:status].present? || params[:location].present? %>
            Try adjusting your filters or
            <%= link_to "view all banners", admin_banners_path, class: "text-decoration-none" %>.
          <% else %>
            Start by creating your first banner for the platform.
          <% end %>
        </p>
        <%= link_to new_admin_banner_path, class: "btn btn-primary" do %>
          <i class="bi bi-plus-lg me-1"></i>
          Create First Banner
        <% end %>
      </div>
    <% end %>
  </div>
</div>