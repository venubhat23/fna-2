<% content_for :title, "Customer Format Details" %>

<div class="container-fluid">
  <!-- Page Header -->
  <div class="d-sm-flex align-items-center justify-content-between mb-4">
    <div>
      <h1 class="h3 mb-0 text-gray-800">
        <i class="bi bi-clipboard-data text-primary"></i>
        Customer Format Details
      </h1>
      <nav aria-label="breadcrumb" class="mt-2">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <%= link_to "Dashboard", admin_dashboard_path, class: "text-decoration-none" %>
          </li>
          <li class="breadcrumb-item">
            <%= link_to "Customer Formats", admin_customer_formats_path, class: "text-decoration-none" %>
          </li>
          <li class="breadcrumb-item active" aria-current="page">Format #<%= @customer_format.id %></li>
        </ol>
      </nav>
    </div>
    <div class="btn-group">
      <%= link_to edit_admin_customer_format_path(@customer_format), class: "btn btn-warning" do %>
        <i class="bi bi-pencil-square"></i> Edit Format
      <% end %>
      <%= link_to admin_customer_formats_path, class: "btn btn-secondary" do %>
        <i class="bi bi-arrow-left"></i> Back to List
      <% end %>
    </div>
  </div>

  <div class="row">
    <!-- Main Details Card -->
    <div class="col-lg-8 mb-4">
      <div class="card shadow">
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
          <h6 class="m-0 font-weight-bold text-primary">
            <i class="bi bi-info-circle"></i> Format Information
          </h6>
          <div class="dropdown no-arrow">
            <% if @customer_format.status == 'active' %>
              <span class="badge badge-success">Active</span>
            <% else %>
              <span class="badge badge-warning">Inactive</span>
            <% end %>
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label class="text-xs font-weight-bold text-gray-800 text-uppercase mb-1">Customer</label>
                <p class="h5 mb-0">
                  <i class="bi bi-person text-primary"></i>
                  <%= "#{@customer_format.customer.first_name} #{@customer_format.customer.last_name}".strip %>
                </p>
                <% if @customer_format.customer.mobile.present? %>
                  <small class="text-muted">
                    <i class="bi bi-telephone"></i> <%= @customer_format.customer.mobile %>
                  </small>
                <% end %>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="text-xs font-weight-bold text-gray-800 text-uppercase mb-1">Product</label>
                <p class="h5 mb-0">
                  <i class="bi bi-box text-success"></i>
                  <%= @customer_format.product.name %>
                </p>
                <% if @customer_format.product.price.present? %>
                  <small class="text-muted">
                    Price: â‚¹<%= number_with_delimiter(@customer_format.product.price) %>
                  </small>
                <% end %>
              </div>
            </div>
          </div>

          <hr>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label class="text-xs font-weight-bold text-gray-800 text-uppercase mb-1">Delivery Person</label>
                <p class="h5 mb-0">
                  <i class="bi bi-truck text-warning"></i>
                  <%= "#{@customer_format.delivery_person.first_name} #{@customer_format.delivery_person.last_name}".strip %>
                </p>
                <% if @customer_format.delivery_person.mobile.present? %>
                  <small class="text-muted">
                    <i class="bi bi-telephone"></i> <%= @customer_format.delivery_person.mobile %>
                  </small>
                <% end %>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="text-xs font-weight-bold text-gray-800 text-uppercase mb-1">Quantity</label>
                <p class="h5 mb-0">
                  <i class="bi bi-speedometer text-info"></i>
                  <%= @customer_format.quantity %>
                  <small class="text-muted">units</small>
                </p>
              </div>
            </div>
          </div>

          <hr>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label class="text-xs font-weight-bold text-gray-800 text-uppercase mb-1">Delivery Pattern</label>
                <p class="h5 mb-0">
                  <i class="bi bi-calendar-event text-primary"></i>
                  <span class="badge badge-primary badge-lg">
                    <%= @customer_format.pattern.humanize %>
                  </span>
                </p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label class="text-xs font-weight-bold text-gray-800 text-uppercase mb-1">Status</label>
                <p class="h5 mb-0">
                  <% if @customer_format.status == 'active' %>
                    <span class="badge badge-success badge-lg">
                      <i class="bi bi-check-circle"></i> Active
                    </span>
                  <% else %>
                    <span class="badge badge-warning badge-lg">
                      <i class="bi bi-pause-circle"></i> Inactive
                    </span>
                  <% end %>
                </p>
              </div>
            </div>
          </div>

          <!-- Special Days Display for Random Pattern -->
          <% if @customer_format.pattern == 'random' && @customer_format.selected_days.any? %>
            <hr>
            <div class="form-group">
              <label class="text-xs font-weight-bold text-gray-800 text-uppercase mb-1">Selected Days (Random Pattern)</label>
              <div class="mt-2">
                <% @customer_format.selected_days.each do |day| %>
                  <span class="badge badge-info mr-1 mb-1">
                    Day <%= day %>
                  </span>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Sidebar Information -->
    <div class="col-lg-4 mb-4">
      <!-- Timestamps Card -->
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">
            <i class="bi bi-clock-history"></i> Timeline
          </h6>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label class="text-xs font-weight-bold text-gray-800 text-uppercase mb-1">Created</label>
            <p class="mb-2">
              <i class="bi bi-calendar-plus text-success"></i>
              <%= @customer_format.created_at.strftime("%B %d, %Y at %I:%M %p") %>
            </p>
          </div>
          <div class="form-group mb-0">
            <label class="text-xs font-weight-bold text-gray-800 text-uppercase mb-1">Last Updated</label>
            <p class="mb-0">
              <i class="bi bi-calendar-check text-warning"></i>
              <%= @customer_format.updated_at.strftime("%B %d, %Y at %I:%M %p") %>
            </p>
          </div>
        </div>
      </div>

      <!-- Actions Card -->
      <div class="card shadow">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">
            <i class="bi bi-gear"></i> Quick Actions
          </h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <%= link_to edit_admin_customer_format_path(@customer_format),
                class: "btn btn-warning btn-sm" do %>
              <i class="bi bi-pencil-square"></i> Edit Format
            <% end %>

            <%= link_to admin_customer_format_path(@customer_format),
                method: :patch,
                data: { confirm: "Are you sure you want to #{@customer_format.status == 'active' ? 'deactivate' : 'activate'} this format?" },
                class: "btn #{ @customer_format.status == 'active' ? 'btn-outline-warning' : 'btn-outline-success' } btn-sm" do %>
              <% if @customer_format.status == 'active' %>
                <i class="bi bi-pause-circle"></i> Deactivate Format
              <% else %>
                <i class="bi bi-play-circle"></i> Activate Format
              <% end %>
            <% end %>

            <%= link_to admin_customer_format_path(@customer_format),
                method: :delete,
                data: { confirm: "Are you sure you want to delete this customer format? This action cannot be undone." },
                class: "btn btn-danger btn-sm" do %>
              <i class="bi bi-trash"></i> Delete Format
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pattern Description Card -->
  <div class="row">
    <div class="col-12">
      <div class="card shadow">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">
            <i class="bi bi-info-circle"></i> Delivery Pattern Description
          </h6>
        </div>
        <div class="card-body">
          <div class="alert alert-info mb-0" role="alert">
            <% case @customer_format.pattern %>
            <% when 'every_day' %>
              <strong>Every Day:</strong> Product will be delivered daily to the customer.
            <% when 'alternative_day' %>
              <strong>Alternative Day:</strong> Product will be delivered every other day (odd days of the period).
            <% when 'weekly_once' %>
              <strong>Weekly Once:</strong> Product will be delivered once per week.
            <% when 'weekly_twice' %>
              <strong>Weekly Twice:</strong> Product will be delivered twice per week.
            <% when 'weekly_thrice' %>
              <strong>Weekly Thrice:</strong> Product will be delivered three times per week.
            <% when 'weekly_four' %>
              <strong>Weekly Four:</strong> Product will be delivered four times per week.
            <% when 'weekly_five' %>
              <strong>Weekly Five:</strong> Product will be delivered five times per week.
            <% when 'weekly_six' %>
              <strong>Weekly Six:</strong> Product will be delivered six times per week.
            <% when 'random' %>
              <strong>Random Pattern:</strong> Product will be delivered on specific days of the month as configured
              <% if @customer_format.selected_days.any? %>
                (Days: <%= @customer_format.selected_days.join(', ') %>).
              <% else %>
                (No specific days configured).
              <% end %>
            <% else %>
              <strong>Custom Pattern:</strong> This format uses a custom delivery pattern.
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .badge-lg {
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
  }

  .card {
    border: none;
    border-radius: 0.5rem;
  }

  .card-header {
    background-color: #f8f9fc;
    border-bottom: 1px solid #e3e6f0;
    border-radius: 0.5rem 0.5rem 0 0 !important;
  }

  .text-xs {
    font-size: 0.7rem;
  }

  .border-left-primary {
    border-left: 0.25rem solid #4e73df !important;
  }
</style>