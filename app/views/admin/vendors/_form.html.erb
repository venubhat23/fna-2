<%= form_with model: [:admin, @vendor], local: true, class: "row g-3" do |f| %>
  <% if @vendor.errors.any? %>
    <div class="col-12">
      <div class="alert alert-danger">
        <h6>Please fix the following errors:</h6>
        <ul class="mb-0">
          <% @vendor.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <div class="col-md-6">
    <%= f.label :name, class: "form-label" %>
    <span class="text-danger">*</span>
    <%= f.text_field :name, class: "form-control", placeholder: "Enter vendor name", required: true %>
  </div>

  <div class="col-md-6">
    <%= f.label :phone, "Phone Number", class: "form-label" %>
    <%= f.telephone_field :phone, class: "form-control", placeholder: "Enter phone number" %>
  </div>

  <div class="col-md-6">
    <%= f.label :email, "Email Address", class: "form-label" %>
    <%= f.email_field :email, class: "form-control", placeholder: "Enter email address" %>
  </div>

  <div class="col-md-6">
    <%= f.label :payment_type, class: "form-label" %>
    <span class="text-danger">*</span>
    <%= f.select :payment_type,
        options_for_select([
          ['Cash', 'Cash'],
          ['Credit', 'Credit']
        ], @vendor.payment_type),
        { prompt: 'Select Payment Type' },
        { class: "form-select", required: true } %>
  </div>

  <div class="col-12">
    <%= f.label :address, class: "form-label" %>
    <%= f.text_area :address, class: "form-control", rows: 3, placeholder: "Enter vendor address" %>
  </div>

  <div class="col-md-6">
    <%= f.label :opening_balance, "Opening Balance (â‚¹)", class: "form-label" %>
    <%= f.number_field :opening_balance,
        class: "form-control",
        placeholder: "0.00",
        step: 0.01,
        min: 0 %>
    <div class="form-text">Any outstanding amount at the time of adding this vendor</div>
  </div>

  <div class="col-md-6">
    <%= f.label :status, class: "form-label" %>
    <div class="form-check form-switch mt-2">
      <%= f.check_box :status, class: "form-check-input", checked: @vendor.status.nil? ? true : @vendor.status %>
      <%= f.label :status, "Active", class: "form-check-label" %>
    </div>
    <div class="form-text">Inactive vendors cannot be used for new purchases</div>
  </div>

  <div class="col-12">
    <hr class="my-4">
    <div class="d-flex gap-2">
      <%= f.submit @vendor.new_record? ? "Create Vendor" : "Update Vendor",
          class: "btn btn-primary" %>
      <%= link_to "Cancel", admin_vendors_path, class: "btn btn-outline-secondary" %>

      <% unless @vendor.new_record? %>
        <%= link_to "View Vendor", admin_vendor_path(@vendor), class: "btn btn-outline-info" %>
      <% end %>
    </div>
  </div>
<% end %>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Auto-format phone number
  const phoneInput = document.querySelector('input[name="vendor[phone]"]');
  if (phoneInput) {
    phoneInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length <= 10) {
        if (value.length > 5) {
          value = value.replace(/(\d{5})(\d{0,5})/, '$1-$2');
        }
        e.target.value = value;
      }
    });
  }

  // Highlight required fields
  const requiredFields = document.querySelectorAll('input[required], select[required]');
  requiredFields.forEach(field => {
    field.addEventListener('blur', function() {
      if (!this.value.trim()) {
        this.classList.add('is-invalid');
      } else {
        this.classList.remove('is-invalid');
        this.classList.add('is-valid');
      }
    });
  });
});
</script>