<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-1">Add New Franchise</h2>
    <p class="text-muted mb-0">Create a new franchise partner</p>
  </div>
  <div>
    <%= link_to admin_franchises_path, class: "btn btn-secondary" do %>
      <i class="bi bi-arrow-left me-1"></i>
      Back to Franchises
    <% end %>
  </div>
</div>

<div class="row">
  <div class="col-lg-8">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h5 class="mb-0">Franchise Information</h5>
      </div>
      <div class="card-body">
        <%= form_with(model: [:admin, @franchise], local: true, class: "needs-validation", novalidate: true) do |form| %>
          <% if @franchise.errors.any? %>
            <div class="alert alert-danger">
              <h6>Please fix the following errors:</h6>
              <ul class="mb-0">
                <% @franchise.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <!-- Basic Information -->
          <div class="row mb-4">
            <div class="col-12">
              <h6 class="text-primary border-bottom pb-2 mb-3">
                <i class="bi bi-shop me-2"></i>Basic Information
              </h6>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :name, class: "form-label fw-semibold" do %>
                  Franchise Name <span class="text-danger">*</span>
                <% end %>
                <%= form.text_field :name, class: "form-control", placeholder: "Enter franchise name", required: true %>
                <div class="invalid-feedback">Please provide a franchise name.</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :contact_person_name, class: "form-label fw-semibold" do %>
                  Contact Person <span class="text-danger">*</span>
                <% end %>
                <%= form.text_field :contact_person_name, class: "form-control", placeholder: "Enter contact person name", required: true %>
                <div class="invalid-feedback">Please provide a contact person name.</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :email, class: "form-label fw-semibold" do %>
                  Email Address <span class="text-danger">*</span>
                <% end %>
                <%= form.email_field :email, class: "form-control", placeholder: "Enter email address", required: true %>
                <div class="invalid-feedback">Please provide a valid email address.</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :mobile, class: "form-label fw-semibold" do %>
                  Mobile Number <span class="text-danger">*</span>
                <% end %>
                <%= form.text_field :mobile, class: "form-control", placeholder: "Enter mobile number", required: true %>
                <div class="invalid-feedback">Please provide a mobile number.</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :whatsapp_number, class: "form-label fw-semibold" %>
                <%= form.text_field :whatsapp_number, class: "form-control", placeholder: "Enter WhatsApp number" %>
                <div class="form-text">Optional - Leave blank to use mobile number</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :business_type, class: "form-label fw-semibold" do %>
                  Business Type <span class="text-danger">*</span>
                <% end %>
                <%= form.select :business_type,
                    options_for_select([
                      ['Retail Store', 'retail_store'],
                      ['Online Store', 'online_store'],
                      ['Service Center', 'service_center'],
                      ['Distribution Hub', 'distribution_hub'],
                      ['Hybrid Model', 'hybrid_model'],
                      ['Other', 'other']
                    ], @franchise.business_type),
                    { prompt: "Select Business Type" },
                    { class: "form-select", required: true } %>
                <div class="invalid-feedback">Please select a business type.</div>
              </div>
            </div>
          </div>

          <!-- Address Information -->
          <div class="row mb-4">
            <div class="col-12">
              <h6 class="text-primary border-bottom pb-2 mb-3">
                <i class="bi bi-geo-alt me-2"></i>Address Information
              </h6>
            </div>
            <div class="col-12">
              <div class="mb-3">
                <%= form.label :address, class: "form-label fw-semibold" do %>
                  Full Address <span class="text-danger">*</span>
                <% end %>
                <%= form.text_area :address, class: "form-control", rows: 3, placeholder: "Enter complete address", required: true %>
                <div class="invalid-feedback">Please provide an address.</div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <%= form.label :city, class: "form-label fw-semibold" do %>
                  City <span class="text-danger">*</span>
                <% end %>
                <%= form.text_field :city, class: "form-control", placeholder: "Enter city", required: true %>
                <div class="invalid-feedback">Please provide a city.</div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <%= form.label :state, class: "form-label fw-semibold" do %>
                  State <span class="text-danger">*</span>
                <% end %>
                <%= form.text_field :state, class: "form-control", placeholder: "Enter state", required: true %>
                <div class="invalid-feedback">Please provide a state.</div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <%= form.label :pincode, class: "form-label fw-semibold" do %>
                  Pincode <span class="text-danger">*</span>
                <% end %>
                <%= form.text_field :pincode, class: "form-control", placeholder: "Enter pincode", required: true %>
                <div class="invalid-feedback">Please provide a pincode.</div>
              </div>
            </div>
          </div>

          <!-- Business Details -->
          <div class="row mb-4">
            <div class="col-12">
              <h6 class="text-primary border-bottom pb-2 mb-3">
                <i class="bi bi-building me-2"></i>Business Details
              </h6>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :pan_no, class: "form-label fw-semibold" %>
                <%= form.text_field :pan_no, class: "form-control", placeholder: "Enter PAN number" %>
                <div class="form-text">Format: ABCDE1234F</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :gst_no, class: "form-label fw-semibold" %>
                <%= form.text_field :gst_no, class: "form-control", placeholder: "Enter GST number" %>
                <div class="form-text">Optional - For registered businesses</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :license_no, class: "form-label fw-semibold" %>
                <%= form.text_field :license_no, class: "form-control", placeholder: "Enter license number" %>
                <div class="form-text">Business license or trade license number</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :establishment_date, class: "form-label fw-semibold" %>
                <%= form.date_field :establishment_date, class: "form-control" %>
                <div class="form-text">Date when business was established</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :territory, class: "form-label fw-semibold" %>
                <%= form.text_field :territory, class: "form-control", placeholder: "Enter territory/area" %>
                <div class="form-text">Operational territory or service area</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :franchise_fee, class: "form-label fw-semibold" %>
                <div class="input-group">
                  <span class="input-group-text">â‚¹</span>
                  <%= form.number_field :franchise_fee, class: "form-control", placeholder: "Enter franchise fee", step: 0.01 %>
                </div>
                <div class="form-text">One-time franchise fee (optional)</div>
              </div>
            </div>
          </div>

          <!-- Commission & Status -->
          <div class="row mb-4">
            <div class="col-12">
              <h6 class="text-primary border-bottom pb-2 mb-3">
                <i class="bi bi-percent me-2"></i>Commission & Status
              </h6>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :commission_percentage, class: "form-label fw-semibold" do %>
                  Commission Percentage <span class="text-danger">*</span>
                <% end %>
                <div class="input-group">
                  <%= form.number_field :commission_percentage, class: "form-control", placeholder: "Enter commission", step: 0.01, required: true %>
                  <span class="input-group-text">%</span>
                </div>
                <div class="invalid-feedback">Please provide a commission percentage.</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <%= form.label :status, class: "form-label fw-semibold" %>
                <div class="form-check form-switch mt-2">
                  <%= form.check_box :status, class: "form-check-input", checked: @franchise.status %>
                  <%= form.label :status, "Active", class: "form-check-label" %>
                </div>
                <div class="form-text">Enable or disable franchise operations</div>
              </div>
            </div>
          </div>

          <!-- Login Credentials -->
          <div class="row mb-4">
            <div class="col-12">
              <h6 class="text-primary border-bottom pb-2 mb-3">
                <i class="bi bi-key me-2"></i>Login Credentials
              </h6>
            </div>
            <div class="col-12">
              <div class="mb-3">
                <div class="form-check">
                  <%= check_box_tag "franchise[auto_generate_password]", "1", true, class: "form-check-input", id: "autoGeneratePassword" %>
                  <%= label_tag "autoGeneratePassword", "Auto-generate password", class: "form-check-label fw-semibold" %>
                </div>
                <div class="form-text text-info">
                  <i class="bi bi-info-circle me-1"></i>
                  Recommended: System will generate a secure password that will be displayed after creation
                </div>
              </div>
            </div>
            <div id="passwordFields" style="display: none;">
              <div class="col-md-6">
                <div class="mb-3">
                  <%= label_tag "franchise[password]", "Password", class: "form-label fw-semibold" %>
                  <%= password_field_tag "franchise[password]", "", class: "form-control", placeholder: "Enter password" %>
                  <div class="form-text">Minimum 6 characters required</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <%= label_tag "franchise[password_confirmation]", "Confirm Password", class: "form-label fw-semibold" %>
                  <%= password_field_tag "franchise[password_confirmation]", "", class: "form-control", placeholder: "Confirm password" %>
                </div>
              </div>
            </div>
          </div>

          <!-- Notes -->
          <div class="row mb-4">
            <div class="col-12">
              <h6 class="text-primary border-bottom pb-2 mb-3">
                <i class="bi bi-chat-text me-2"></i>Additional Information
              </h6>
            </div>
            <div class="col-12">
              <div class="mb-3">
                <%= form.label :notes, class: "form-label fw-semibold" %>
                <%= form.text_area :notes, class: "form-control", rows: 4, placeholder: "Enter any additional notes or comments" %>
                <div class="form-text">Any additional information about the franchise</div>
              </div>
            </div>
          </div>

          <!-- Submit Buttons -->
          <div class="d-flex gap-2">
            <%= form.submit "Create Franchise", class: "btn btn-primary" %>
            <%= link_to "Cancel", admin_franchises_path, class: "btn btn-secondary" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Help Sidebar -->
  <div class="col-lg-4">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0"><i class="bi bi-info-circle me-2"></i>Quick Help</h6>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <h6 class="text-primary">Required Fields</h6>
          <ul class="list-unstyled small">
            <li><i class="bi bi-check-circle text-success me-2"></i>Franchise Name</li>
            <li><i class="bi bi-check-circle text-success me-2"></i>Contact Person</li>
            <li><i class="bi bi-check-circle text-success me-2"></i>Email & Mobile</li>
            <li><i class="bi bi-check-circle text-success me-2"></i>Address Details</li>
            <li><i class="bi bi-check-circle text-success me-2"></i>Business Type</li>
            <li><i class="bi bi-check-circle text-success me-2"></i>Commission %</li>
          </ul>
        </div>
        <div class="mb-3">
          <h6 class="text-primary">Tips</h6>
          <ul class="list-unstyled small">
            <li><i class="bi bi-lightbulb text-warning me-2"></i>Use auto-generated password for better security</li>
            <li><i class="bi bi-lightbulb text-warning me-2"></i>Commission percentage can be decimal (e.g., 12.5%)</li>
            <li><i class="bi bi-lightbulb text-warning me-2"></i>Territory helps in operational planning</li>
            <li><i class="bi bi-lightbulb text-warning me-2"></i>All documents can be uploaded later</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Toggle password fields based on auto-generate checkbox
  const autoGenerateCheckbox = document.getElementById('autoGeneratePassword');
  const passwordFields = document.getElementById('passwordFields');

  autoGenerateCheckbox?.addEventListener('change', function() {
    if (this.checked) {
      passwordFields.style.display = 'none';
      passwordFields.querySelectorAll('input').forEach(input => {
        input.removeAttribute('required');
        input.value = '';
      });
    } else {
      passwordFields.style.display = 'block';
      passwordFields.querySelectorAll('input').forEach(input => {
        input.setAttribute('required', 'required');
      });
    }
  });

  // Form validation
  const forms = document.querySelectorAll('.needs-validation');
  Array.prototype.slice.call(forms).forEach(function (form) {
    form.addEventListener('submit', function (event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });
});
</script>