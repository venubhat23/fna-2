<% content_for :page_title, "Health Insurance Policy Details" %>
<% content_for :page_subtitle, "Policy ##{@health_insurance.policy_number}" %>

<!-- Action Buttons -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <%= link_to admin_health_insurances_path, class: "btn btn-outline-secondary" do %>
      <i class="bi bi-arrow-left me-2"></i>
      Back to Policies
    <% end %>
  </div>

  <div class="btn-toolbar">
    <button class="btn btn-outline-primary me-2">
      <i class="bi bi-download me-2"></i>
      Download PDF
    </button>
    <%= link_to edit_admin_health_insurance_path(@health_insurance), class: "btn btn-primary" do %>
      <i class="bi bi-pencil me-2"></i>
      Edit Policy
    <% end %>
  </div>
</div>

<!-- Main Policy Card -->
<div class="row">
  <div class="col-lg-8">
    <div class="card mb-4">
      <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">
            <i class="bi bi-hospital me-2 text-success"></i>
            Policy Information
          </h5>
          <span class="premium-badge">Health Insurance</span>
        </div>
      </div>

      <div class="card-body">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label text-muted">Policy Number</label>
            <h6 class="fw-bold"><%= @health_insurance.policy_number %></h6>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label text-muted">Policy Type</label>
            <h6><%= @health_insurance.policy_type&.humanize || 'Standard Health' %></h6>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label text-muted">Sum Insured</label>
            <h5 class="text-warning mb-0">₹<%= number_with_delimiter(@health_insurance.sum_insured.to_i) %></h5>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label text-muted">Total Premium</label>
            <h5 class="text-success mb-0">₹<%= number_with_delimiter(@health_insurance.total_premium.to_i) %></h5>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label text-muted">Premium Frequency</label>
            <h6><%= @health_insurance.payment_mode&.humanize || 'Annual' %></h6>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label text-muted">Status</label>
            <div>
              <% if @health_insurance.active? %>
                <span class="badge bg-success fs-6">
                  <i class="bi bi-check-circle me-1"></i>
                  Active
                </span>
              <% elsif @health_insurance.expired? %>
                <span class="badge bg-danger fs-6">
                  <i class="bi bi-x-circle me-1"></i>
                  Expired
                </span>
              <% elsif @health_insurance.expiring_soon? %>
                <span class="badge bg-warning fs-6">
                  <i class="bi bi-clock me-1"></i>
                  Expiring Soon
                </span>
              <% else %>
                <span class="badge bg-secondary fs-6">
                  <i class="bi bi-question-circle me-1"></i>
                  Unknown
                </span>
              <% end %>
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label text-muted">Policy Start Date</label>
            <h6><%= @health_insurance.policy_start_date.strftime("%B %d, %Y") if @health_insurance.policy_start_date %></h6>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label text-muted">Policy End Date</label>
            <h6 class="<%= 'text-danger' if @health_insurance.policy_end_date && @health_insurance.policy_end_date < 30.days.from_now %>">
              <%= @health_insurance.policy_end_date.strftime("%B %d, %Y") if @health_insurance.policy_end_date %>
              <% if @health_insurance.policy_end_date && @health_insurance.policy_end_date < 30.days.from_now %>
                <br><small class="text-danger">
                  <i class="bi bi-exclamation-triangle me-1"></i>
                  Expires soon
                </small>
              <% end %>
            </h6>
          </div>
        </div>

        <% if @health_insurance.claim_process.present? %>
          <div class="luxury-divider"></div>
          <div class="mt-3">
            <label class="form-label text-muted">Claim Process</label>
            <div class="bg-light p-3 rounded">
              <%= simple_format(@health_insurance.claim_process) %>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Reference Information -->
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="bi bi-person-check me-2 text-info"></i>
          Reference Information
        </h5>
      </div>

      <div class="card-body">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label text-muted">Reference By</label>
            <h6><%= @health_insurance.reference_by_name.presence || 'Self' %></h6>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label text-muted">Insurance Type</label>
            <h6><%= @health_insurance.insurance_type&.humanize || 'Not specified' %></h6>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <!-- Customer Information -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="bi bi-person me-2 text-primary"></i>
          Customer Details
        </h5>
      </div>

      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <div class="stats-icon primary me-3" style="width: 50px; height: 50px; font-size: 1.2rem;">
            <i class="bi bi-person"></i>
          </div>
          <div>
            <h6 class="mb-1"><%= @health_insurance.customer&.display_name || 'Unknown Customer' %></h6>
            <small class="text-muted">
              <%= @health_insurance.customer&.customer_type&.humanize || 'Individual' %>
            </small>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label text-muted small">Email</label>
          <div><%= @health_insurance.customer&.email || 'N/A' %></div>
        </div>

        <div class="mb-3">
          <label class="form-label text-muted small">Mobile</label>
          <div><%= @health_insurance.customer&.mobile || 'N/A' %></div>
        </div>

        <div class="mb-3">
          <label class="form-label text-muted small">Address</label>
          <div>
            <%= @health_insurance.customer.address.present? ? @health_insurance.customer.address : 'Not provided' %><br>
            <%= @health_insurance.customer.city %>, <%= @health_insurance.customer.state %>
            <% if @health_insurance.customer.pincode.present? %>
              - <%= @health_insurance.customer.pincode %>
            <% end %>
          </div>
        </div>

        <%= link_to admin_customer_path(@health_insurance.customer), class: "btn btn-outline-primary btn-sm w-100" do %>
          <i class="bi bi-eye me-2"></i>
          View Customer Profile
        <% end %>
      </div>
    </div>

    <!-- Insurance Company -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="bi bi-building me-2 text-warning"></i>
          Insurance Company
        </h5>
      </div>

      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <div class="stats-icon warning me-3" style="width: 50px; height: 50px; font-size: 1.2rem;">
            <i class="bi bi-building"></i>
          </div>
          <div>
            <h6 class="mb-1"><%= @health_insurance.insurance_company_name %></h6>
            <small class="text-muted">Health Insurance Provider</small>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label text-muted small">Plan Name</label>
          <div><%= @health_insurance.plan_name.presence || 'Standard Plan' %></div>
        </div>

        <div class="mb-3">
          <label class="form-label text-muted small">Policy Type</label>
          <div><%= @health_insurance.policy_type&.humanize || 'Health Insurance' %></div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">
          <i class="bi bi-lightning me-2 text-success"></i>
          Quick Actions
        </h5>
      </div>

      <div class="card-body">
        <div class="d-grid gap-2">
          <%= link_to edit_admin_health_insurance_path(@health_insurance), class: "btn btn-primary" do %>
            <i class="bi bi-pencil me-2"></i>
            Edit Policy
          <% end %>

          <button class="btn btn-outline-success">
            <i class="bi bi-arrow-clockwise me-2"></i>
            Renew Policy
          </button>

          <button class="btn btn-outline-info">
            <i class="bi bi-envelope me-2"></i>
            Send to Customer
          </button>

          <%= link_to admin_health_insurance_path(@health_insurance),
              method: :delete,
              class: "btn btn-outline-danger",
              confirm: "Are you sure you want to delete this policy?",
              data: { turbo_method: :delete } do %>
            <i class="bi bi-trash me-2"></i>
            Delete Policy
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Trust Seal -->
<div class="luxury-divider"></div>
<div class="text-center">
  <div class="trust-seal">
    <i class="bi bi-shield-check seal-icon"></i>
    <span>Secure Healthcare Coverage - Policy Protected</span>
  </div>
</div>