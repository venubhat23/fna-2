<%# Floating Toggle Buttons %>
<div class="position-fixed" style="top: 90px; right: 20px; z-index: 1050;">
  <div class="d-flex gap-2">
    <button type="button" class="btn btn-outline-primary btn-sm shadow-lg" id="checkoutViewBtn" onclick="showCheckoutView()" title="Checkout">
      <i class="bi bi-cart-check"></i>
    </button>
  </div>
</div>

<%# Large Toggle Buttons %>
<div class="mb-3">
  <div class="btn-group-lg d-flex gap-3" role="group">
    <button type="button" class="btn btn-outline-primary px-3 py-2 rounded-3 shadow-sm" id="checkoutViewBtnLarge" onclick="showCheckoutView()">
      <i class="bi bi-cart-check me-2"></i>
      <span class="fw-medium">Checkout</span>
    </button>
  </div>
</div>

<%# Search and Filters %>
<div class="card border-0 shadow-sm mb-3" id="searchSection">
  <div class="card-body py-2">
    <div class="row g-2 align-items-center">
      <div class="col-md-5">
        <input type="text" class="form-control form-control-sm" placeholder="Search products by name, SKU, or category..." id="productSearch">
      </div>
      <div class="col-md-3">
        <select class="form-select form-select-sm" id="categoryFilter">
          <option value="">All Categories</option>
          <% Category.where(status: true).each do |category| %>
            <option value="<%= category.id %>"><%= category.name %></option>
          <% end %>
        </select>
      </div>
      <div class="col-md-4">
        <div class="d-flex gap-2 align-items-center">
          <small class="text-muted">Filter:</small>
          <div class="btn-group btn-group-sm" role="group">
            <button type="button" class="btn btn-outline-primary btn-sm active" id="allProductsBtn" onclick="filterProducts('all')">All</button>
            <button type="button" class="btn btn-outline-primary btn-sm" id="inStockBtn" onclick="filterProducts('instock')">In Stock</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%# Products View %>
<div id="productsView">
  <div class="card border-0 shadow-sm">
    <div class="card-body pt-3">
      <% if @products&.any? %>
        <div class="row g-3" id="productGrid">
          <% @products.each do |product| %>
            <% current_stock = product.cached_total_batch_stock %>
            <div class="col-md-4 col-lg-3 product-grid-item" data-product-id="<%= product.id %>" data-category="<%= product.category_id %>" data-stock="<%= current_stock %>">
              <div class="card h-100 border-0 shadow-sm hover-lift">
                <%# Product Image %>
                <div class="position-relative">
                  <% if product.images.attached? && product.images.any? %>
                    <%= image_tag product.images.first, class: "card-img-top", style: "height: 200px; object-fit: cover;" %>
                  <% else %>
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                      <i class="bi bi-box-seam fs-1 text-muted"></i>
                    </div>
                  <% end %>

                  <%# Enhanced Stock Badge %>
                  <% if product.out_of_stock? %>
                    <span class="position-absolute top-0 end-0 badge bg-danger m-2">
                      <i class="bi bi-x-circle me-1"></i>Out of Stock
                    </span>
                  <% elsif product.low_stock? %>
                    <span class="position-absolute top-0 end-0 badge bg-warning text-dark m-2">
                      <i class="bi bi-exclamation-triangle me-1"></i>Low Stock (<%= current_stock.to_i %> left)
                    </span>
                  <% else %>
                    <span class="position-absolute top-0 end-0 badge bg-success m-2">
                      <i class="bi bi-check-circle me-1"></i><%= current_stock.to_i %> in stock
                    </span>
                  <% end %>

                  <%# Discount Badge %>
                  <% if product.respond_to?(:discount_price) && product.discount_price.present? && product.discount_price != product.price %>
                    <% discount_percent = ((product.price - product.discount_price) * 100 / product.price).round %>
                    <span class="position-absolute top-0 start-0 badge bg-success m-2"><%= discount_percent %>% OFF</span>
                  <% end %>
                </div>

                <%# Product Details %>
                <div class="card-body d-flex flex-column">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <small class="text-muted"><%= product.category&.name || 'No Category' %></small>
                    <small class="text-muted">SKU: <%= product.sku %></small>
                  </div>

                  <h6 class="card-title mb-2" style="min-height: 48px;"><%= product.name %></h6>

                  <%# Price %>
                  <div class="mb-3">
                    <% if product.respond_to?(:discount_price) && product.discount_price.present? && product.discount_price != product.price %>
                      <div class="d-flex align-items-center gap-2">
                        <span class="h6 text-success mb-0">â‚¹<%= number_with_delimiter(product.discount_price) %></span>
                        <small class="text-muted text-decoration-line-through">â‚¹<%= number_with_delimiter(product.price) %></small>
                      </div>
                    <% else %>
                      <span class="h6 text-primary mb-0">â‚¹<%= number_with_delimiter(product.price) %></span>
                    <% end %>
                  </div>

                  <%# Enhanced Stock Movement Display %>
                  <div class="mb-3">
                    <% if current_stock > 0 %>
                      <div class="d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                          <small class="text-success">
                            <i class="bi bi-check-circle-fill"></i>
                            In Stock
                          </small>
                          <span class="badge bg-primary">
                            <i class="bi bi-box-seam"></i>
                            <%= current_stock.to_i %> <%= product.unit_type %>
                          </span>
                        </div>

                        <% if product.low_stock? %>
                          <div class="alert alert-warning py-1 px-2 mb-2">
                            <small>
                              <i class="bi bi-exclamation-triangle"></i>
                              <strong>Low Stock Alert!</strong> Only <%= current_stock.to_i %> units remaining
                              (Minimum: <%= product.minimum_stock_threshold %>)
                            </small>
                          </div>
                        <% end %>

                        <%# Progress bar showing stock utilization %>
                      </div>
                    <% else %>
                      <div class="alert alert-danger py-1 px-2 mb-2">
                        <small class="d-block">
                          <i class="bi bi-x-circle-fill"></i>
                          <strong>OUT OF STOCK</strong>
                        </small>
                      </div>
                    <% end %>
                  </div>

                  <%# Quantity and Add to Cart %>
                  <div class="mt-3">
                    <% if current_stock > 0 %>
                      <!-- Quantity Selector -->
                      <div class="mb-3">
                        <label class="form-label fw-bold small">
                          Quantity
                          <span class="badge bg-info-subtle text-info ms-1">
                            Max: <%= current_stock.to_i %>
                          </span>
                        </label>
                        <div class="input-group">
                          <button class="btn btn-outline-primary" type="button" onclick="decreaseQuantity(<%= product.id %>)" style="width: 45px; height: 45px; border-radius: 8px 0 0 8px;">
                            <i class="bi bi-dash fw-bold"></i>
                          </button>
                          <input type="number" id="qty-<%= product.id %>" value="1" min="1" max="<%= current_stock %>" class="form-control text-center fw-bold" style="height: 45px; font-size: 1.1rem;" onchange="validateQuantity(<%= product.id %>, <%= current_stock %>)">
                          <button class="btn btn-outline-primary" type="button" onclick="increaseQuantity(<%= product.id %>)" style="width: 45px; height: 45px; border-radius: 0 8px 8px 0;">
                            <i class="bi bi-plus fw-bold"></i>
                          </button>
                        </div>

                        <%# Enhanced Stock Warning Messages %>
                        <% if product.out_of_stock? %>
                          <small class="text-danger d-block mt-1">
                            <i class="bi bi-x-circle-fill"></i>
                            <strong>OUT OF STOCK</strong> - Cannot add to cart
                          </small>
                        <% elsif product.low_stock? %>
                          <small class="text-warning d-block mt-1">
                            <i class="bi bi-exclamation-triangle-fill"></i>
                            <strong>Low Stock Alert!</strong> Only <%= current_stock.to_i %> <%= product.unit_type %> remaining
                          </small>
                        <% elsif current_stock <= 10 %>
                          <small class="text-info d-block mt-1">
                            <i class="bi bi-info-circle-fill"></i>
                            <%= current_stock.to_i %> <%= product.unit_type %> available
                          </small>
                        <% end %>
                      </div>

                      <!-- Add to Cart Button -->
                      <button class="btn btn-primary w-100"
                              onclick="addToCart(<%= product.id %>, '<%= j(product.name) %>', <%= product.respond_to?(:discount_price) && product.discount_price.present? ? product.discount_price : product.price %>, <%= current_stock %>)"
                              <%= 'disabled' if product.out_of_stock? %>>
                        <% if product.out_of_stock? %>
                          <i class="bi bi-x-circle me-2"></i>Out of Stock
                        <% else %>
                          <i class="bi bi-cart-plus me-2"></i>Add to Cart
                        <% end %>
                      </button>
                    <% else %>
                      <div class="text-center">
                        <button class="btn btn-danger w-100" disabled>
                          <i class="bi bi-x-circle me-2"></i>SOLD OUT
                        </button>
                        <small class="text-muted mt-1 d-block">Product is currently out of stock</small>
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-5">
          <i class="bi bi-box-seam fs-1 text-muted mb-3"></i>
          <h5 class="text-muted">No Products Available</h5>
          <p class="text-muted">Add products to start creating bookings.</p>
          <a href="<%= new_admin_product_path %>" class="btn btn-primary">
            <i class="bi bi-plus-circle me-1"></i>Add Product
          </a>
        </div>
      <% end %>
    </div>
  </div>
</div>

<%# Checkout View %>
<div id="checkoutView" style="display: none;">
  <div class="row">
    <%# Checkout Form %>
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-transparent border-0">
          <h5 class="mb-0">Booking Details</h5>
        </div>
        <div class="card-body">
          <%= form_with model: [:admin, @booking], local: true, html: { id: 'bookingForm' } do |f| %>
            <% if @booking.errors.any? %>
              <div class="alert alert-danger">
                <h6><i class="bi bi-exclamation-triangle me-2"></i>Please fix the following errors:</h6>
                <ul class="mb-0">
                  <% @booking.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            <% end %>

            <%# Customer Information %>
            <div class="mb-4">
              <h6 class="mb-3"><i class="bi bi-person me-2"></i>Customer Information</h6>

              <div class="row g-3">
                <div class="col-md-4">
                  <label class="form-label">
                    <i class="bi bi-person-search me-1"></i>Search & Select Customer
                  </label>
                  <div class="position-relative">
                    <!-- Hidden input for form submission -->
                    <%= f.hidden_field :customer_id, id: 'selected_customer_id' %>

                    <!-- Search input -->
                    <input type="text"
                           class="form-control customer-search-input"
                           id="customerSearchInput"
                           placeholder="ðŸ” Search by name, phone, or email..."
                           autocomplete="off">

                    <!-- Search results dropdown -->
                    <div class="customer-search-dropdown" id="customerSearchDropdown">
                      <div class="customer-search-results" id="customerSearchResults">
                        <!-- Results will be populated here -->
                      </div>
                      <div class="customer-search-footer">
                        <button type="button" class="btn btn-sm btn-outline-primary w-100" onclick="showAllCustomers()">
                          <i class="bi bi-people me-1"></i>Show All Customers
                        </button>
                      </div>
                    </div>

                    <!-- Selected customer display -->
                    <div class="selected-customer-display" id="selectedCustomerDisplay" style="display: none;">
                      <div class="d-flex align-items-center justify-content-between">
                        <div class="customer-info">
                          <div class="customer-name fw-medium"></div>
                          <div class="customer-details text-muted small"></div>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="clearSelectedCustomer()">
                          <i class="bi bi-x"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <label class="form-label">Store (Optional)</label>
                  <%= f.select :store_id,
                      options_for_select([['Select Store (Optional)', '']] + Store.active.map { |s| [s.display_name, s.id] }),
                      {},
                      { class: 'form-select', id: 'store_select', onchange: 'handleStoreSelection(this)' } %>
                  <div class="form-text">
                    <small><i class="bi bi-shop me-1"></i>Tag this sale to a store (auto-sets status to completed)</small>
                  </div>
                </div>

                <div class="col-md-4">
                  <label class="form-label">
                    <i class="bi bi-flag me-1"></i>Status/Stage <span class="text-danger">*</span>
                  </label>
                  <%= f.select :status,
                      options_for_select([['Select Status', '']] + Booking.statuses.map { |key, value| [key.humanize, key] }),
                      {},
                      { class: 'form-select', required: true, id: 'booking_status' } %>
                  <div class="form-text">
                    <small><i class="bi bi-info-circle me-1"></i>Current booking status for tracking</small>
                  </div>

                  <!-- Status Preview -->
                  <div id="statusPreview" class="mt-2" style="display: none;">
                    <span class="badge" id="statusBadge">
                      <i id="statusIcon" class="me-1"></i>
                      <span id="statusName">Selected Status</span>
                    </span>
                  </div>
                </div>

                <div class="col-md-6">
                  <label class="form-label">Customer Name <span class="text-danger">*</span></label>
                  <%= f.text_field :customer_name, class: 'form-control', placeholder: 'Enter customer name', required: true %>
                </div>

                <div class="col-md-6">
                  <label class="form-label">Mobile Number <span class="text-danger">*</span></label>
                  <%= f.text_field :customer_phone, class: 'form-control', placeholder: 'Enter mobile number', required: true %>
                </div>

                <div class="col-12">
                  <label class="form-label">Email Address</label>
                  <%= f.email_field :customer_email, class: 'form-control', placeholder: 'Enter email address' %>
                </div>

                <div class="col-12">
                  <label class="form-label">Delivery Address <span class="text-danger">*</span></label>
                  <%= f.text_area :delivery_address, class: 'form-control', rows: 3, placeholder: 'Enter complete delivery address', required: true %>
                </div>
              </div>
            </div>

            <%# Payment Information %>
            <div class="mb-4">
              <h6 class="mb-3"><i class="bi bi-credit-card me-2"></i>Payment Method</h6>

              <div class="row g-3">
                <div class="col-md-3">
                  <div class="form-check">
                    <%= f.radio_button :payment_method, 'cash', checked: true, class: 'form-check-input', id: 'payment_cash', onchange: 'selectPaymentMethod("cash")' %>
                    <label class="form-check-label" for="payment_cash">
                      <i class="bi bi-cash-stack me-1"></i>Cash Payment
                    </label>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="form-check">
                    <%= f.radio_button :payment_method, 'card', class: 'form-check-input', id: 'payment_card', onchange: 'selectPaymentMethod("card")' %>
                    <label class="form-check-label" for="payment_card">
                      <i class="bi bi-credit-card me-1"></i>Card Payment
                    </label>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="form-check">
                    <%= f.radio_button :payment_method, 'upi', class: 'form-check-input', id: 'payment_upi', onchange: 'selectPaymentMethod("upi")' %>
                    <label class="form-check-label" for="payment_upi">
                      <i class="bi bi-phone me-1"></i>UPI Payment
                    </label>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="form-check">
                    <%= f.radio_button :payment_method, 'online', class: 'form-check-input', id: 'payment_online', onchange: 'selectPaymentMethod("online")' %>
                    <label class="form-check-label" for="payment_online">
                      <i class="bi bi-globe me-1"></i>Online Payment
                    </label>
                  </div>
                </div>
              </div>

              <%# Cash Payment Details %>
              <div id="cashSection" class="mt-3">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">Cash Received</label>
                    <%= f.number_field :cash_received, class: 'form-control', placeholder: '0.00', step: '0.01', onkeyup: 'calculateChange()' %>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Change to Return</label>
                    <%= f.number_field :change_amount, class: 'form-control', readonly: true, placeholder: '0.00' %>
                  </div>
                </div>
              </div>
            </div>

            <%# Additional Notes %>
            <div class="mb-4">
              <h6 class="mb-3"><i class="bi bi-chat-square-text me-2"></i>Additional Notes</h6>
              <%= f.text_area :notes, class: 'form-control', rows: 3, placeholder: 'Add any special instructions or notes for this booking...' %>
            </div>

            <%# Hidden Fields for Cart Items %>
            <div id="checkoutItemsFields"></div>

            <%# Action Buttons %>
            <div class="d-flex gap-2 justify-content-end">
              <button type="button" class="btn btn-outline-secondary" onclick="showProductsView()">
                <i class="bi bi-arrow-left me-1"></i>Back to Products
              </button>

              <button type="submit" name="create_order" value="1" class="btn btn-success" id="completeBookingBtn">
                <span class="btn-text">
                  <i class="bi bi-check-circle me-1"></i>Complete Booking
                </span>
                <span class="btn-loading d-none">
                  <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                  Processing booking...
                </span>
              </button>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <%# Order Summary %>
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-transparent border-0">
          <h5 class="mb-0"><i class="bi bi-receipt me-2"></i>Order Summary</h5>
        </div>
        <div class="card-body">
          <div id="checkoutOrderSummary">
            <p class="text-muted text-center">No items in cart</p>
          </div>

          <div id="orderTotals" style="display: none;" class="border-top pt-3 mt-3">
            <div class="d-flex justify-content-between mb-2">
              <span>Subtotal</span>
              <span>â‚¹<span id="checkoutSubtotal">0</span></span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>GST (18%)</span>
              <span>â‚¹<span id="checkoutTax">0</span></span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Discount</span>
              <span>
                â‚¹<input type="number" id="checkoutDiscount" name="booking[discount_amount]" value="0" min="0" class="form-control form-control-sm d-inline-block w-auto" onchange="updateCheckoutTotals()">
              </span>
            </div>
            <div class="d-flex justify-content-between border-top pt-2 mb-0">
              <span class="fw-bold">Total Amount</span>
              <span class="fw-bold text-success fs-5">â‚¹<span id="checkoutTotal">0</span></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%# Floating Cart %>
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1000;">
  <div class="card border-0 shadow" id="floatingCart" style="min-width: 300px; display: none;">
    <div class="card-header bg-primary text-white">
      <h6 class="mb-0">
        <i class="bi bi-cart3 me-2"></i>Shopping Cart
        <span class="badge bg-light text-primary ms-2" id="cartCount">0</span>
      </h6>
    </div>
    <div class="card-body">
      <div id="cartItems" style="max-height: 200px; overflow-y: auto;">
        <p class="text-muted text-center mb-0">Your cart is empty</p>
      </div>
      <div class="border-top pt-2 mt-2">
        <div class="d-flex justify-content-between fw-bold">
          <span>Total</span>
          <span>â‚¹<span id="cartTotal">0</span></span>
        </div>
      </div>
      <button class="btn btn-success w-100 mt-2" onclick="showCheckoutView()">
        <i class="bi bi-arrow-right me-1"></i>Proceed to Checkout
      </button>
    </div>
  </div>
</div>

<%# JavaScript %>
<script>
// Shopping Cart System
let cart = {};
let currentView = 'products';

// Initialize cart
function initializeCart() {
  updateCartDisplay();
}

// Add item to cart
function addToCart(productId, productName, price, stock) {
  const quantity = parseInt(document.getElementById(`qty-${productId}`).value) || 1;

  if (quantity > stock) {
    alert(`Only ${stock} items available in stock!`);
    return;
  }

  if (cart[productId]) {
    if (cart[productId].quantity + quantity > stock) {
      alert(`Cannot add more items. Maximum stock: ${stock}`);
      return;
    }
    cart[productId].quantity += quantity;
  } else {
    cart[productId] = {
      name: productName,
      price: price,
      quantity: quantity,
      stock: stock
    };
  }

  // Reset quantity input
  document.getElementById(`qty-${productId}`).value = 1;

  updateCartDisplay();
  showNotification(`${productName} added to cart!`, 'success');
}

// Update cart display
function updateCartDisplay() {
  const cartCount = Object.keys(cart).length;
  const floatingCart = document.getElementById('floatingCart');
  const cartCountEl = document.getElementById('cartCount');
  const cartItemsEl = document.getElementById('cartItems');
  const cartTotalEl = document.getElementById('cartTotal');

  cartCountEl.textContent = cartCount;

  if (cartCount === 0) {
    floatingCart.style.display = 'none';
    cartItemsEl.innerHTML = '<p class="text-muted text-center mb-0">Your cart is empty</p>';
    cartTotalEl.textContent = '0';
    return;
  }

  floatingCart.style.display = 'block';

  let itemsHtml = '';
  let total = 0;

  for (const [productId, item] of Object.entries(cart)) {
    const itemTotal = item.price * item.quantity;
    total += itemTotal;

    itemsHtml += `
      <div class="cart-item mb-3 p-2 border rounded">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <div class="flex-grow-1">
            <div class="fw-medium">${item.name}</div>
            <small class="text-muted">â‚¹${item.price} each</small>
          </div>
          <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeFromCart(${productId})" title="Remove item">
            <i class="bi bi-trash"></i>
          </button>
        </div>
        <div class="d-flex justify-content-between align-items-center">
          <div class="input-group input-group-sm" style="width: 120px;">
            <button class="btn btn-outline-secondary" type="button" onclick="decreaseCartQuantity(${productId})" ${item.quantity <= 1 ? 'disabled' : ''}>
              <i class="bi bi-dash"></i>
            </button>
            <input type="text" class="form-control text-center fw-bold" value="${item.quantity}" readonly>
            <button class="btn btn-outline-secondary" type="button" onclick="increaseCartQuantity(${productId})" ${item.quantity >= item.stock ? 'disabled' : ''}>
              <i class="bi bi-plus"></i>
            </button>
          </div>
          <div class="text-end">
            <div class="fw-bold text-success">â‚¹${itemTotal.toFixed(2)}</div>
            <small class="text-muted">${item.quantity} Ã— â‚¹${item.price}</small>
          </div>
        </div>
      </div>
    `;
  }

  cartItemsEl.innerHTML = itemsHtml;
  cartTotalEl.textContent = total.toFixed(2);
}

// Remove item from cart
function removeFromCart(productId) {
  const item = cart[productId];
  if (item) {
    showNotification(`${item.name} removed from cart`, 'info');
  }
  delete cart[productId];
  updateCartDisplay();
  updateCheckoutDisplay();
}

// Increase cart item quantity
function increaseCartQuantity(productId) {
  if (cart[productId]) {
    if (cart[productId].quantity < cart[productId].stock) {
      cart[productId].quantity += 1;
      updateCartDisplay();
      updateCheckoutDisplay();
      showNotification(`Quantity increased for ${cart[productId].name}`, 'success');
    } else {
      showNotification(`Maximum stock reached for ${cart[productId].name}`, 'warning');
    }
  }
}

// Decrease cart item quantity
function decreaseCartQuantity(productId) {
  if (cart[productId]) {
    if (cart[productId].quantity > 1) {
      cart[productId].quantity -= 1;
      updateCartDisplay();
      updateCheckoutDisplay();
      showNotification(`Quantity decreased for ${cart[productId].name}`, 'success');
    } else {
      // If quantity would be 0, remove the item
      removeFromCart(productId);
    }
  }
}

// Show Products View
function showProductsView() {
  currentView = 'products';
  document.getElementById('productsView').style.display = 'block';
  document.getElementById('checkoutView').style.display = 'none';

  // Show search and filters section when in products view
  document.getElementById('searchSection').style.display = 'block';

  // Update buttons
  document.getElementById('productsViewBtn').className = 'btn btn-primary btn-sm shadow-lg';
  document.getElementById('checkoutViewBtn').className = 'btn btn-outline-primary btn-sm shadow-lg';
  document.getElementById('productsViewBtnLarge').className = 'btn btn-primary px-3 py-2 rounded-3 shadow-sm';
  document.getElementById('checkoutViewBtnLarge').className = 'btn btn-outline-primary px-3 py-2 rounded-3 shadow-sm';
}

// Show Checkout View
function showCheckoutView() {
  if (Object.keys(cart).length === 0) {
    alert('Please add items to cart before checkout');
    return;
  }

  currentView = 'checkout';
  document.getElementById('productsView').style.display = 'none';
  document.getElementById('checkoutView').style.display = 'block';

  // Hide search and filters section when in checkout view
  document.getElementById('searchSection').style.display = 'none';

  // Update buttons
  document.getElementById('productsViewBtn').className = 'btn btn-outline-primary btn-sm shadow-lg';
  document.getElementById('checkoutViewBtn').className = 'btn btn-primary btn-sm shadow-lg';
  document.getElementById('productsViewBtnLarge').className = 'btn btn-outline-primary px-3 py-2 rounded-3 shadow-sm';
  document.getElementById('checkoutViewBtnLarge').className = 'btn btn-primary px-3 py-2 rounded-3 shadow-sm';

  updateCheckoutDisplay();
}

// Update checkout display
function updateCheckoutDisplay() {
  const orderSummaryEl = document.getElementById('checkoutOrderSummary');
  const orderTotalsEl = document.getElementById('orderTotals');
  const fieldsContainer = document.getElementById('checkoutItemsFields');

  const itemCount = Object.keys(cart).length;

  if (itemCount === 0) {
    orderSummaryEl.innerHTML = '<p class="text-muted text-center">No items in cart</p>';
    orderTotalsEl.style.display = 'none';
    fieldsContainer.innerHTML = '';
    return;
  }

  orderTotalsEl.style.display = 'block';

  let summaryHtml = '';
  let fieldsHtml = '';
  let subtotal = 0;
  let fieldIndex = 0;

  for (const [productId, item] of Object.entries(cart)) {
    const itemTotal = item.price * item.quantity;
    subtotal += itemTotal;

    summaryHtml += `
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div>
          <div class="fw-medium">${item.name}</div>
          <small class="text-muted">â‚¹${item.price} Ã— ${item.quantity}</small>
        </div>
        <span class="fw-medium">â‚¹${itemTotal.toFixed(2)}</span>
      </div>
    `;

    fieldsHtml += `
      <input type="hidden" name="booking[booking_items_attributes][${fieldIndex}][product_id]" value="${productId}">
      <input type="hidden" name="booking[booking_items_attributes][${fieldIndex}][quantity]" value="${item.quantity}">
      <input type="hidden" name="booking[booking_items_attributes][${fieldIndex}][price]" value="${item.price}">
    `;
    fieldIndex++;
  }

  orderSummaryEl.innerHTML = summaryHtml;
  fieldsContainer.innerHTML = fieldsHtml;

  updateCheckoutTotals();
}

// Update checkout totals
function updateCheckoutTotals() {
  let grossTotal = 0;
  for (const [productId, item] of Object.entries(cart)) {
    grossTotal += item.price * item.quantity;
  }

  // Calculate GST-exclusive subtotal (reverse calculation)
  const tax = grossTotal * 0.18 / 1.18; // GST amount
  const subtotal = grossTotal - tax; // Subtotal without GST
  const discount = parseFloat(document.getElementById('checkoutDiscount')?.value || 0);
  const total = grossTotal - discount; // Final total after discount

  document.getElementById('checkoutSubtotal').textContent = subtotal.toFixed(2);
  document.getElementById('checkoutTax').textContent = tax.toFixed(2);
  document.getElementById('checkoutTotal').textContent = total.toFixed(2);
}

// Payment method selection
function selectPaymentMethod(method) {
  const cashSection = document.getElementById('cashSection');
  if (method === 'cash') {
    cashSection.style.display = 'block';
  } else {
    cashSection.style.display = 'none';
  }
}

// Calculate change for cash payment
function calculateChange() {
  const total = parseFloat(document.getElementById('checkoutTotal').textContent) || 0;
  const received = parseFloat(document.getElementById('booking_cash_received').value) || 0;
  const change = Math.max(0, received - total);
  document.getElementById('booking_change_amount').value = change.toFixed(2);
}

// Customer Search System
let customers = <%= raw @customers.map { |c| {
  id: c.id,
  name: c.respond_to?(:display_name) ? c.display_name : "#{c.first_name} #{c.last_name}".strip,
  first_name: c.first_name,
  last_name: c.last_name,
  mobile: c.mobile,
  email: c.email,
  address: c.respond_to?(:address) ? c.address : ''
}}.to_json %>;

let searchTimeout;
let currentSearchQuery = '';
let selectedCustomerIndex = -1;

// Initialize customer search
function initializeCustomerSearch() {
  const searchInput = document.getElementById('customerSearchInput');
  const dropdown = document.getElementById('customerSearchDropdown');

  if (!searchInput || !dropdown) return;

  // Show dropdown on focus
  searchInput.addEventListener('focus', function() {
    if (this.value.length >= 1 || customers.length <= 20) {
      showCustomerDropdown();
      if (this.value.length >= 1) {
        performCustomerSearch(this.value);
      } else {
        showAllCustomers();
      }
    }
  });

  // Hide dropdown when clicking outside
  document.addEventListener('click', function(e) {
    if (!e.target.closest('.position-relative')) {
      hideCustomerDropdown();
    }
  });

  // Search as user types
  searchInput.addEventListener('input', function() {
    const query = this.value.trim();
    currentSearchQuery = query;
    selectedCustomerIndex = -1;

    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      if (query.length >= 1) {
        showCustomerDropdown();
        performCustomerSearch(query);
      } else if (query.length === 0) {
        if (customers.length <= 20) {
          showAllCustomers();
        } else {
          hideCustomerDropdown();
        }
      }
    }, 300);
  });

  // Handle keyboard navigation
  searchInput.addEventListener('keydown', function(e) {
    const items = document.querySelectorAll('.customer-search-item');

    if (e.key === 'ArrowDown') {
      e.preventDefault();
      selectedCustomerIndex = Math.min(selectedCustomerIndex + 1, items.length - 1);
      updateHighlightedItem(items);
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      selectedCustomerIndex = Math.max(selectedCustomerIndex - 1, -1);
      updateHighlightedItem(items);
    } else if (e.key === 'Enter') {
      e.preventDefault();
      if (selectedCustomerIndex >= 0 && items[selectedCustomerIndex]) {
        items[selectedCustomerIndex].click();
      }
    } else if (e.key === 'Escape') {
      hideCustomerDropdown();
      this.blur();
    }
  });
}

function performCustomerSearch(query) {
  const results = document.getElementById('customerSearchResults');
  if (!results) return;

  // Show loading
  results.innerHTML = '<div class="customer-search-loading"><div class="customer-search-spinner"></div>Searching customers...</div>';

  // Simulate network delay for better UX
  setTimeout(() => {
    const filteredCustomers = customers.filter(customer =>
      customer.name.toLowerCase().includes(query.toLowerCase()) ||
      customer.mobile.includes(query) ||
      (customer.email && customer.email.toLowerCase().includes(query.toLowerCase()))
    ).slice(0, 10); // Limit to 10 results

    displayCustomerResults(filteredCustomers, query);
  }, 200);
}

function displayCustomerResults(customerList, searchQuery = '') {
  const results = document.getElementById('customerSearchResults');
  if (!results) return;

  if (customerList.length === 0) {
    results.innerHTML = '<div class="customer-search-empty"><i class="bi bi-person-x fs-4 mb-2 d-block text-muted"></i><div class="fw-medium">No customers found</div><small class="text-muted">Try searching with a different name, phone, or email</small></div>';
    return;
  }

  let html = '';
  customerList.forEach((customer, index) => {
    const highlightedName = highlightSearchTerm(customer.name, searchQuery);
    const highlightedMobile = highlightSearchTerm(customer.mobile, searchQuery);
    const highlightedEmail = customer.email ? highlightSearchTerm(customer.email, searchQuery) : '';

    html += '<div class="customer-search-item" onclick="selectCustomer(' + customer.id + ', \'' + escapeHtml(customer.name) + '\', \'' + customer.mobile + '\', \'' + escapeHtml(customer.email) + '\', \'' + escapeHtml(customer.address) + '\')" data-index="' + index + '">';
    html += '<div class="customer-search-name">' + highlightedName + '</div>';
    html += '<div class="customer-search-details">';
    html += '<span class="customer-search-badge"><i class="bi bi-telephone"></i>' + highlightedMobile + '</span>';
    if (customer.email) {
      html += '<span class="customer-search-badge"><i class="bi bi-envelope"></i>' + highlightedEmail + '</span>';
    }
    html += '<span class="customer-search-badge"><i class="bi bi-person"></i>ID: ' + customer.id + '</span>';
    html += '</div></div>';
  });

  results.innerHTML = html;
}

function highlightSearchTerm(text, searchTerm) {
  if (!searchTerm || !text) return text;
  const regex = new RegExp('(' + escapeRegex(searchTerm) + ')', 'gi');
  return text.replace(regex, '<mark style="background-color: #fff3cd; padding: 1px 2px; border-radius: 3px;">$1</mark>');
}

function escapeHtml(text) {
  if (!text) return '';
  return text.replace(/'/g, "\\\\'").replace(/"/g, '&quot;');
}

function escapeRegex(string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, '\\\\$&');
}

function updateHighlightedItem(items) {
  items.forEach((item, index) => {
    item.classList.toggle('active', index === selectedCustomerIndex);
  });

  if (selectedCustomerIndex >= 0 && items[selectedCustomerIndex]) {
    items[selectedCustomerIndex].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
  }
}

function selectCustomer(customerId, customerName, customerMobile, customerEmail, customerAddress) {
  document.getElementById('selected_customer_id').value = customerId;
  document.getElementById('customerSearchInput').style.display = 'none';

  const selectedDisplay = document.getElementById('selectedCustomerDisplay');
  selectedDisplay.style.display = 'block';
  selectedDisplay.querySelector('.customer-name').textContent = customerName;
  selectedDisplay.querySelector('.customer-details').innerHTML = '<div class="d-flex align-items-center gap-2 flex-wrap"><span class="badge bg-primary-subtle text-primary"><i class="bi bi-telephone me-1"></i>' + customerMobile + '</span>' + (customerEmail ? '<span class="badge bg-success-subtle text-success"><i class="bi bi-envelope me-1"></i>' + customerEmail + '</span>' : '') + '<span class="badge bg-info-subtle text-info"><i class="bi bi-person me-1"></i>ID: ' + customerId + '</span></div>';

  document.getElementById('booking_customer_name').value = customerName;
  document.getElementById('booking_customer_phone').value = customerMobile;
  document.getElementById('booking_customer_email').value = customerEmail || '';
  if (customerAddress) {
    document.getElementById('booking_delivery_address').value = customerAddress;
  }

  hideCustomerDropdown();
  showNotification('Selected customer: ' + customerName, 'success');
}

function clearSelectedCustomer() {
  document.getElementById('selected_customer_id').value = '';
  document.getElementById('customerSearchInput').style.display = 'block';
  document.getElementById('customerSearchInput').value = '';
  document.getElementById('selectedCustomerDisplay').style.display = 'none';

  document.getElementById('booking_customer_name').value = '';
  document.getElementById('booking_customer_phone').value = '';
  document.getElementById('booking_customer_email').value = '';
  document.getElementById('booking_delivery_address').value = '';

  document.getElementById('customerSearchInput').focus();
}

function showAllCustomers() {
  displayCustomerResults(customers.slice(0, 10));
}

function showCustomerDropdown() {
  const dropdown = document.getElementById('customerSearchDropdown');
  if (dropdown) {
    dropdown.classList.add('show');
  }
}

function hideCustomerDropdown() {
  const dropdown = document.getElementById('customerSearchDropdown');
  if (dropdown) {
    dropdown.classList.remove('show');
  }
  selectedCustomerIndex = -1;
}

// Quantity controls
function increaseQuantity(productId) {
  const input = document.getElementById(`qty-${productId}`);
  const max = parseInt(input.max);
  const current = parseInt(input.value) || 1;
  if (current < max) {
    input.value = current + 1;
  }
}

function decreaseQuantity(productId) {
  const input = document.getElementById(`qty-${productId}`);
  const current = parseInt(input.value) || 1;
  if (current > 1) {
    input.value = current - 1;
  }
}

// Validate quantity doesn't exceed available stock
function validateQuantity(productId, maxStock) {
  const input = document.getElementById(`qty-${productId}`);
  const value = parseInt(input.value) || 1;

  if (value > maxStock) {
    input.value = maxStock;
    showNotification(`Maximum ${maxStock} items available for this product`, 'warning');
  } else if (value < 1) {
    input.value = 1;
  }
}

// Notification system
function showNotification(message, type = 'success') {
  const colors = {
    success: 'alert-success',
    warning: 'alert-warning',
    danger: 'alert-danger',
    info: 'alert-info'
  };

  const icons = {
    success: 'bi-check-circle-fill',
    warning: 'bi-exclamation-triangle-fill',
    danger: 'bi-x-circle-fill',
    info: 'bi-info-circle-fill'
  };

  const notification = document.createElement('div');
  notification.className = `alert ${colors[type]} alert-dismissible fade show position-fixed bottom-0 start-50 translate-middle-x mb-3`;
  notification.style.cssText = 'z-index: 9999; min-width: 350px; max-width: 500px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.15);';
  notification.innerHTML = `
    <div class="d-flex align-items-center">
      <i class="bi ${icons[type]} me-2 fs-5"></i>
      <div class="flex-grow-1">${message}</div>
      <button type="button" class="btn-close ms-2" onclick="this.parentElement.parentElement.remove()"></button>
    </div>
  `;
  document.body.appendChild(notification);

  // Slide in animation
  setTimeout(() => {
    notification.style.transform = 'translateX(-50%) translateY(-10px)';
  }, 10);

  setTimeout(() => {
    notification.style.opacity = '0';
    notification.style.transform = 'translateX(-50%) translateY(20px)';
    setTimeout(() => notification.remove(), 300);
  }, 4000);
}

// Search functionality
function setupSearch() {
  const searchInput = document.getElementById('productSearch');
  if (searchInput) {
    searchInput.addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      document.querySelectorAll('.product-grid-item').forEach(card => {
        const name = card.querySelector('h6')?.textContent?.toLowerCase() || '';
        const categoryElement = card.querySelector('small');
        const category = categoryElement?.textContent?.toLowerCase() || '';

        // Get the SKU from the second small element (SKU: xxx format)
        const skuElement = card.querySelectorAll('small')[1];
        const sku = skuElement?.textContent?.toLowerCase() || '';

        if (name.includes(searchTerm) ||
            category.includes(searchTerm) ||
            sku.includes(searchTerm)) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    });
  }
}

// Filter functionality
function filterProducts(type) {
  const products = document.querySelectorAll('.product-grid-item');
  const allBtn = document.getElementById('allProductsBtn');
  const inStockBtn = document.getElementById('inStockBtn');

  // Update button states
  allBtn.classList.remove('active');
  inStockBtn.classList.remove('active');

  if (type === 'all') {
    allBtn.classList.add('active');
    products.forEach(product => {
      product.style.display = 'block';
    });
  } else if (type === 'instock') {
    inStockBtn.classList.add('active');
    products.forEach(product => {
      const stock = parseInt(product.dataset.stock) || 0;
      product.style.display = stock > 0 ? 'block' : 'none';
    });
  }
}

// Apply category filter
function applyCategoryFilter() {
  const categoryFilter = document.getElementById('categoryFilter').value;
  const products = document.querySelectorAll('.product-grid-item');

  products.forEach(product => {
    if (!categoryFilter || product.dataset.category === categoryFilter) {
      product.style.display = 'block';
    } else {
      product.style.display = 'none';
    }
  });
}

// Handle store selection - automatically set status to completed if store is selected
function handleStoreSelection(select) {
  const statusSelect = document.getElementById('booking_status');

  if (select.value && select.value !== '') {
    // Store is selected - set status to completed
    if (statusSelect) {
      statusSelect.value = 'completed';
      updateStatusPreview();

      // Show notification
      showNotification('Status automatically set to "Completed" as store is selected', 'info');

      // Add visual feedback
      statusSelect.style.backgroundColor = '#d4edda';
      setTimeout(() => {
        statusSelect.style.backgroundColor = '';
      }, 2000);
    }
  } else {
    // Store is deselected - optionally reset status to draft
    if (statusSelect && statusSelect.value === 'completed') {
      statusSelect.value = 'draft';
      updateStatusPreview();
      showNotification('Status reset to "Draft" as store was deselected', 'warning');
    }
  }
}

// Status management
function updateStatusPreview() {
  const statusSelect = document.getElementById('booking_status');
  const statusPreview = document.getElementById('statusPreview');
  const statusBadge = document.getElementById('statusBadge');
  const statusIcon = document.getElementById('statusIcon');
  const statusName = document.getElementById('statusName');

  if (!statusSelect || !statusPreview) return;

  const selectedValue = statusSelect.value;
  const selectedText = statusSelect.options[statusSelect.selectedIndex].text;

  if (selectedValue === '') {
    statusPreview.style.display = 'none';
    return;
  }

  // Status configurations from booking model
  const statusConfigs = {
    'draft': { color: 'bg-secondary', icon: 'bi-pencil' },
    'ordered_and_delivery_pending': { color: 'bg-secondary', icon: 'bi-clock' },
    'confirmed': { color: 'bg-info', icon: 'bi-check-circle' },
    'processing': { color: 'bg-warning', icon: 'bi-gear' },
    'packed': { color: 'bg-warning', icon: 'bi-box' },
    'shipped': { color: 'bg-primary', icon: 'bi-truck' },
    'out_for_delivery': { color: 'bg-primary', icon: 'bi-geo-alt' },
    'delivered': { color: 'bg-success', icon: 'bi-house-check' },
    'completed': { color: 'bg-success', icon: 'bi-check-all' },
    'cancelled': { color: 'bg-danger', icon: 'bi-x-circle' },
    'returned': { color: 'bg-danger', icon: 'bi-arrow-return-left' }
  };

  const config = statusConfigs[selectedValue] || { color: 'bg-secondary', icon: 'bi-question-circle' };

  statusBadge.className = `badge ${config.color}`;
  statusIcon.className = `${config.icon} me-1`;
  statusName.textContent = selectedText;
  statusPreview.style.display = 'block';
}

// Booking loader functionality
function showBookingLoader() {
  const submitBtn = document.getElementById('completeBookingBtn');
  const btnText = submitBtn.querySelector('.btn-text');
  const btnLoading = submitBtn.querySelector('.btn-loading');

  if (submitBtn && btnText && btnLoading) {
    // Hide normal text and show loading
    btnText.classList.add('d-none');
    btnLoading.classList.remove('d-none');

    // Disable the button to prevent double submission
    submitBtn.disabled = true;
    submitBtn.classList.add('btn-loading-state');

    // Disable the back button during processing
    const backBtn = document.querySelector('button[onclick="showProductsView()"]');
    if (backBtn) {
      backBtn.disabled = true;
      backBtn.classList.add('opacity-50');
    }

    // Show overlay message
    showProcessingOverlay();
  }
}

function showProcessingOverlay() {
  // Create an overlay to prevent user interaction
  const overlay = document.createElement('div');
  overlay.id = 'bookingProcessingOverlay';
  overlay.className = 'position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center';
  overlay.style.cssText = `
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    z-index: 9999;
  `;

  overlay.innerHTML = `
    <div class="text-center text-white">
      <div class="spinner-border spinner-border-lg mb-3" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <h5 class="mb-2">Processing Your Booking</h5>
      <p class="mb-0 opacity-75">Please wait while we save your booking details...</p>
      <div class="mt-3">
        <small class="opacity-50">âš ï¸ Please do not close this window or navigate away</small>
      </div>
    </div>
  `;

  document.body.appendChild(overlay);
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
  initializeCart();
  setupSearch();
  initializeCustomerSearch();

  // Set default payment method
  selectPaymentMethod('cash');

  // Update checkout totals when discount changes
  const discountInput = document.getElementById('checkoutDiscount');
  if (discountInput) {
    discountInput.addEventListener('change', updateCheckoutTotals);
  }

  // Add category filter listener
  const categoryFilter = document.getElementById('categoryFilter');
  if (categoryFilter) {
    categoryFilter.addEventListener('change', applyCategoryFilter);
  }

  // Add status change listener
  const statusSelect = document.getElementById('booking_status');
  if (statusSelect) {
    statusSelect.addEventListener('change', updateStatusPreview);
  }

  // Prevent form submission with empty cart
  const bookingForm = document.getElementById('bookingForm');
  if (bookingForm) {
    bookingForm.addEventListener('submit', function(e) {
      if (Object.keys(cart).length === 0) {
        e.preventDefault();
        alert('Please add items to cart before submitting');
        return false;
      }

      // Check if status is selected
      const statusSelect = document.getElementById('booking_status');
      if (statusSelect && statusSelect.value === '') {
        e.preventDefault();
        alert('Please select a status for this booking');
        statusSelect.focus();
        return false;
      }

      // Show loading state
      showBookingLoader();
    });
  }
});
</script>

<style>
/* Hover effects */
.hover-lift {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.hover-lift:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
}

/* Product grid responsive */
@media (max-width: 768px) {
  .products-grid {
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  }

  .position-fixed {
    position: relative !important;
  }
}

/* Customer Search Dropdown Styles */
.customer-search-input {
  position: relative;
  z-index: 1;
}

.customer-search-input:focus {
  border-color: #0d6efd;
  box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

.customer-search-dropdown {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid #dee2e6;
  border-top: none;
  border-radius: 0 0 8px 8px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  z-index: 1000;
  max-height: 400px;
  overflow: hidden;
  display: none;
}

.customer-search-dropdown.show {
  display: block;
  animation: slideDown 0.2s ease-out;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.customer-search-results {
  max-height: 320px;
  overflow-y: auto;
}

.customer-search-item {
  padding: 12px 16px;
  border-bottom: 1px solid #f1f3f4;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.customer-search-item:hover {
  background-color: #f8f9fa;
}

.customer-search-item:last-child {
  border-bottom: none;
}

.customer-search-item.active {
  background-color: #e3f2fd;
  border-color: #2196f3;
}

.customer-search-name {
  font-weight: 600;
  color: #212529;
  margin-bottom: 4px;
}

.customer-search-details {
  font-size: 0.875rem;
  color: #6c757d;
  display: flex;
  align-items-center;
  gap: 12px;
}

.customer-search-badge {
  display: inline-flex;
  align-items-center;
  gap: 4px;
  font-size: 0.75rem;
  padding: 2px 6px;
  border-radius: 12px;
  background-color: #e9ecef;
  color: #495057;
}

.customer-search-footer {
  padding: 12px 16px;
  border-top: 1px solid #e9ecef;
  background-color: #f8f9fa;
}

.selected-customer-display {
  padding: 12px 16px;
  background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
  border: 1px solid #2196f3;
  border-radius: 8px;
  margin-top: 8px;
}

.customer-search-empty {
  padding: 24px 16px;
  text-align: center;
  color: #6c757d;
}

.customer-search-loading {
  padding: 16px;
  text-align: center;
  color: #6c757d;
}

.customer-search-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 2px solid #f3f3f3;
  border-top: 2px solid #0d6efd;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-right: 8px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Booking Loading Button Styles */
.btn-loading-state {
  position: relative;
  pointer-events: none;
}

.btn-loading-state:hover {
  background-color: #198754 !important;
  border-color: #198754 !important;
}

.btn-loading .spinner-border-sm {
  width: 1rem;
  height: 1rem;
}

#bookingProcessingOverlay {
  animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.spinner-border-lg {
  width: 3rem;
  height: 3rem;
}
</style>