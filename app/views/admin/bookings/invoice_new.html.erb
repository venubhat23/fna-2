<!-- Invoice Container -->
<div class="atmanirbhar-invoice">
  <!-- Header Section -->
  <div class="invoice-header-section">
    <div class="text-center mb-2">
      <h1 class="business-title">ATMA NIRBHAR FARM</h1>
      <p class="business-subtitle">100% Pure Organic Retail and Wholesale Supply</p>
    </div>

    <div class="header-details">
      <div class="row">
        <div class="col-8">
          <p class="mb-1"><strong>Address:</strong> D 213, Mantri Woodlands, Arekere Gate, Bannerghatta Road, Bengaluru-560076</p>
          <p class="mb-1"><strong>Email:</strong> info.atmanirbharfarm@gmail.com</p>
          <p class="mb-1"><strong>Ph:</strong> +91 99014 46878</p>
        </div>
        <div class="col-4 text-end">
          <p class="mb-1"><strong>GSTIN:</strong> 29JCFPS0817P1ZK</p>
          <p class="mb-1"><strong>State:</strong> Karnataka</p>
          <p class="mb-1"><strong>State Code:</strong> 29</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Tax Invoice Title -->
  <div class="text-center invoice-type-header">
    <h2>TAX INVOICE</h2>
  </div>

  <!-- Invoice Details and Bill To Section -->
  <div class="invoice-info-section">
    <div class="row">
      <div class="col-6">
        <div class="bill-to-box">
          <h5 class="section-title">Details of Receiver (Billed to)</h5>
          <p class="mb-1"><strong>Name:</strong> <%= @booking.customer_name || @booking.customer&.display_name || 'Customer Name' %></p>
          <p class="mb-1"><strong>Address:</strong> <%= @booking.delivery_address || 'Customer Address' %></p>
          <p class="mb-1"><strong>Ph:</strong> <%= @booking.customer_phone || @booking.customer&.mobile || '+91 XXXXXXXXXX' %></p>
        </div>
      </div>
      <div class="col-6">
        <div class="invoice-details-box">
          <table class="invoice-meta-details">
            <tr>
              <td><strong>Invoice No:</strong></td>
              <td><%= @booking.invoice_number || "INV#{Date.current.strftime('%Y%m')}#{@booking.id.to_s.rjust(4, '0')}" %></td>
            </tr>
            <tr>
              <td><strong>Invoice Date:</strong></td>
              <td><%= Date.current.strftime("%d/%m/%Y") %></td>
            </tr>
            <tr>
              <td><strong>Delivery Date:</strong></td>
              <td><%= (Date.current + 2.days).strftime("%d/%m/%Y") %></td>
            </tr>
            <tr>
              <td><strong>Vehicle No:</strong></td>
              <td>-</td>
            </tr>
            <tr>
              <td><strong>Time of Supply:</strong></td>
              <td><%= Time.current.strftime("%I:%M %p") %></td>
            </tr>
            <tr>
              <td><strong>Place of Supply:</strong></td>
              <td>Karnataka</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Items Table -->
  <div class="items-table-container">
    <table class="atmanirbhar-items-table">
      <thead>
        <tr>
          <th width="5%">Sl No</th>
          <th width="30%">Item Description</th>
          <th width="8%">HSN Code</th>
          <th width="8%">Qty</th>
          <th width="8%">Unit</th>
          <th width="10%">Rate</th>
          <th width="10%">Taxable Value</th>
          <th width="7%">CGST%</th>
          <th width="7%">SGST%</th>
          <th width="7%">Amount</th>
        </tr>
      </thead>
      <tbody>
        <%
          subtotal = 0
          total_cgst = 0
          total_sgst = 0
          gst_rate = 0 # 0% GST for food items
        %>
        <% @booking.booking_items.each_with_index do |item, index| %>
          <%
            item_total = (item.quantity * item.price.to_f)
            item_cgst = (item_total * gst_rate / 200).round(2)
            item_sgst = (item_total * gst_rate / 200).round(2)
            final_amount = item_total + item_cgst + item_sgst
            subtotal += item_total
            total_cgst += item_cgst
            total_sgst += item_sgst
          %>
          <tr>
            <td class="text-center"><%= index + 1 %></td>
            <td><%= item.product&.name || 'Product' %></td>
            <td class="text-center"><%= item.product.respond_to?(:hsn_code) ? (item.product&.hsn_code || '0401') : '0401' %></td>
            <td class="text-center"><%= item.quantity %></td>
            <td class="text-center">Ltr</td>
            <td class="text-end"><%= number_with_precision(item.price.to_f, precision: 2) %></td>
            <td class="text-end"><%= number_with_precision(item_total, precision: 2) %></td>
            <td class="text-center"><%= gst_rate / 2 %></td>
            <td class="text-center"><%= gst_rate / 2 %></td>
            <td class="text-end"><%= number_with_precision(final_amount, precision: 2) %></td>
          </tr>
        <% end %>

        <!-- Add empty rows if needed to maintain layout -->
        <% (10 - @booking.booking_items.count).times do %>
          <tr>
            <td>&nbsp;</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        <% end %>
      </tbody>
      <tfoot>
        <tr class="total-row">
          <td colspan="6" class="text-end"><strong>Total</strong></td>
          <td class="text-end"><strong><%= number_with_precision(subtotal, precision: 2) %></strong></td>
          <td class="text-center"><strong><%= number_with_precision(total_cgst, precision: 2) %></strong></td>
          <td class="text-center"><strong><%= number_with_precision(total_sgst, precision: 2) %></strong></td>
          <td class="text-end"><strong><%= number_with_precision(subtotal + total_cgst + total_sgst, precision: 2) %></strong></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- Amount Summary Section -->
  <div class="amount-summary">
    <div class="row">
      <div class="col-8">
        <div class="amount-words-box">
          <p class="mb-0"><strong>Total Amount (in words):</strong></p>
          <p class="amount-words"><%= amount_in_words(subtotal + total_cgst + total_sgst) %> Only</p>
        </div>
      </div>
      <div class="col-4">
        <table class="summary-table">
          <tr>
            <td>Total Amount Before Tax:</td>
            <td class="text-end">₹ <%= number_with_precision(subtotal, precision: 2) %></td>
          </tr>
          <tr>
            <td>Add: CGST:</td>
            <td class="text-end">₹ <%= number_with_precision(total_cgst, precision: 2) %></td>
          </tr>
          <tr>
            <td>Add: SGST:</td>
            <td class="text-end">₹ <%= number_with_precision(total_sgst, precision: 2) %></td>
          </tr>
          <tr class="grand-total-row">
            <td><strong>Total Amount After Tax:</strong></td>
            <td class="text-end"><strong>₹ <%= number_with_precision(subtotal + total_cgst + total_sgst, precision: 2) %></strong></td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <!-- GST Summary -->
  <div class="gst-summary">
    <h5 class="section-title">GST Summary</h5>
    <table class="gst-summary-table">
      <thead>
        <tr>
          <th>HSN Code</th>
          <th>Taxable Value</th>
          <th>CGST Rate</th>
          <th>CGST Amount</th>
          <th>SGST Rate</th>
          <th>SGST Amount</th>
          <th>Total Tax</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="text-center">0401</td>
          <td class="text-end"><%= number_with_precision(subtotal, precision: 2) %></td>
          <td class="text-center"><%= gst_rate / 2 %>%</td>
          <td class="text-end"><%= number_with_precision(total_cgst, precision: 2) %></td>
          <td class="text-center"><%= gst_rate / 2 %>%</td>
          <td class="text-end"><%= number_with_precision(total_sgst, precision: 2) %></td>
          <td class="text-end"><%= number_with_precision(total_cgst + total_sgst, precision: 2) %></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Bank Details and Terms -->
  <div class="footer-info">
    <div class="row">
      <div class="col-6">
        <div class="bank-details-box">
          <h5 class="section-title">Bank Details</h5>
          <p class="mb-1"><strong>Bank Name:</strong> ICICI Bank</p>
          <p class="mb-1"><strong>Account No:</strong> 352405500541</p>
          <p class="mb-1"><strong>IFSC Code:</strong> ICIC0003524</p>
          <p class="mb-1"><strong>Branch:</strong> Jayanagar 9th Block</p>
        </div>

        <div class="terms-box mt-3">
          <h5 class="section-title">Terms & Conditions</h5>
          <ol class="terms-list">
            <li>Goods once sold will not be taken back or exchanged</li>
            <li>All disputes are subject to Karnataka Jurisdiction only</li>
          </ol>
        </div>
      </div>
      <div class="col-6">
        <div class="signature-box text-center">
          <p class="mb-5">&nbsp;</p>
          <p class="mb-5">&nbsp;</p>
          <p class="signature-line">_____________________</p>
          <p class="mb-0"><strong>Authorised Signatory</strong></p>
          <p>For ATMA NIRBHAR FARM</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer Note -->
  <div class="invoice-footer text-center">
    <p class="mb-0"><small>This is a Computer Generated Invoice</small></p>
  </div>
</div>

<!-- Helper method for amount in words -->
<%
  def amount_in_words(amount)
    amount = amount.to_f.round
    return "Zero" if amount == 0

    ones = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine"]
    tens = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"]
    teens = ["Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eighteen", "Nineteen"]

    def convert_hundreds(num, ones, tens, teens)
      result = ""

      # Handle hundreds
      if num >= 100
        result += ones[num / 100] + " Hundred "
        num = num % 100
      end

      # Handle tens and ones
      if num >= 20
        result += tens[num / 10] + " "
        result += ones[num % 10] + " " if num % 10 > 0
      elsif num >= 10
        result += teens[num - 10] + " "
      elsif num > 0
        result += ones[num] + " "
      end

      result.strip
    end

    if amount < 1000
      "Rupees " + convert_hundreds(amount.to_i, ones, tens, teens)
    elsif amount < 100000
      thousands = amount.to_i / 1000
      remainder = amount.to_i % 1000
      result = "Rupees " + convert_hundreds(thousands, ones, tens, teens) + " Thousand"
      result += " " + convert_hundreds(remainder, ones, tens, teens) if remainder > 0
      result
    elsif amount < 10000000
      lakhs = amount.to_i / 100000
      remainder = amount.to_i % 100000
      result = "Rupees " + convert_hundreds(lakhs, ones, tens, teens) + " Lakh"
      if remainder > 0
        thousands = remainder / 1000
        hundreds = remainder % 1000
        result += " " + convert_hundreds(thousands, ones, tens, teens) + " Thousand" if thousands > 0
        result += " " + convert_hundreds(hundreds, ones, tens, teens) if hundreds > 0
      end
      result
    else
      "Rupees " + amount.to_i.to_s
    end
  end
%>

<style>
/* Dhanvantari NatuRALS Invoice Styles */
.atmanirbhar-invoice {
  font-family: Arial, sans-serif;
  font-size: 14px;
  color: #000;
  background: white;
  padding: 20px;
}

/* Header Styles */
.invoice-header-section {
  border-bottom: 2px solid #000;
  padding-bottom: 15px;
  margin-bottom: 10px;
}

.business-title {
  font-size: 28px;
  font-weight: bold;
  margin: 0;
  letter-spacing: 2px;
}

.business-subtitle {
  font-size: 14px;
  margin: 5px 0;
  font-style: italic;
}

.header-details {
  font-size: 12px;
  margin-top: 15px;
}

.header-details p {
  margin: 2px 0;
}

/* Invoice Type Header */
.invoice-type-header {
  background: #f0f0f0;
  padding: 8px;
  margin: 15px 0;
  border: 1px solid #000;
}

.invoice-type-header h2 {
  font-size: 20px;
  font-weight: bold;
  margin: 0;
}

/* Invoice Info Section */
.invoice-info-section {
  margin-bottom: 20px;
}

.bill-to-box,
.invoice-details-box {
  border: 1px solid #000;
  padding: 10px;
  min-height: 150px;
}

.section-title {
  font-size: 14px;
  font-weight: bold;
  margin-bottom: 10px;
  text-decoration: underline;
}

.bill-to-box p,
.invoice-details-box p {
  margin: 5px 0;
  font-size: 12px;
}

.invoice-meta-details {
  width: 100%;
  font-size: 12px;
}

.invoice-meta-details td {
  padding: 3px 5px;
}

.invoice-meta-details td:first-child {
  width: 45%;
}

/* Items Table */
.items-table-container {
  margin-bottom: 20px;
}

.atmanirbhar-items-table {
  width: 100%;
  border-collapse: collapse;
  border: 1px solid #000;
}

.atmanirbhar-items-table thead {
  background: #e0e0e0;
}

.atmanirbhar-items-table th,
.atmanirbhar-items-table td {
  border: 1px solid #000;
  padding: 5px;
  font-size: 12px;
}

.atmanirbhar-items-table th {
  font-weight: bold;
  text-align: center;
}

.atmanirbhar-items-table tbody td {
  height: 25px;
}

.atmanirbhar-items-table .total-row {
  background: #f0f0f0;
  font-weight: bold;
}

/* Amount Summary */
.amount-summary {
  margin-bottom: 20px;
}

.amount-words-box {
  border: 1px solid #000;
  padding: 10px;
  min-height: 60px;
}

.amount-words {
  font-size: 14px;
  font-weight: bold;
  text-transform: capitalize;
}

.summary-table {
  width: 100%;
  border: 1px solid #000;
}

.summary-table td {
  padding: 5px 10px;
  font-size: 12px;
  border: 1px solid #000;
}

.grand-total-row {
  background: #e0e0e0;
  font-weight: bold;
}

/* GST Summary */
.gst-summary {
  margin-bottom: 20px;
}

.gst-summary-table {
  width: 100%;
  border-collapse: collapse;
  border: 1px solid #000;
  font-size: 12px;
}

.gst-summary-table th,
.gst-summary-table td {
  border: 1px solid #000;
  padding: 5px;
  text-align: center;
}

.gst-summary-table thead {
  background: #e0e0e0;
  font-weight: bold;
}

/* Footer Info */
.footer-info {
  margin-bottom: 20px;
}

.bank-details-box,
.terms-box {
  border: 1px solid #000;
  padding: 10px;
}

.bank-details-box p {
  margin: 3px 0;
  font-size: 12px;
}

.terms-list {
  margin: 5px 0;
  padding-left: 20px;
  font-size: 12px;
}

.terms-list li {
  margin: 3px 0;
}

.signature-box {
  padding: 20px 10px;
}

.signature-line {
  margin-top: 50px;
  font-size: 12px;
}

/* Footer */
.invoice-footer {
  margin-top: 20px;
  padding-top: 10px;
  border-top: 1px solid #000;
  font-size: 11px;
}

/* Text alignment utilities */
.text-center {
  text-align: center !important;
}

.text-end {
  text-align: right !important;
}

/* Print Styles */
@media print {
  .atmanirbhar-invoice {
    padding: 0;
  }

  .action-buttons {
    display: none !important;
  }

  body {
    background: white !important;
  }

  .invoice-container {
    box-shadow: none !important;
  }
}
</style>