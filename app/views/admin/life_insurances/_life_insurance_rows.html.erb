<% life_insurances.each do |policy| %>
  <tr class="<%= 'table-warning bg-warning-subtle' if policy.non_drwise_policy? %>">
    <td>
      <div>
        <h6 class="mb-1"><%= policy.policy_number %></h6>
        <small class="text-muted"><%= policy.policy_type&.humanize %></small>
      </div>
    </td>
    <td>
      <div>
        <h6 class="mb-1"><%= policy.customer&.display_name %></h6>
        <small class="text-muted"><%= policy.customer&.email %></small>
      </div>
    </td>
    <td>
      <div>
        <h6 class="mb-1"><%= policy.insurance_company_name %></h6>
        <small class="text-muted">Life Insurance</small>
      </div>
    </td>
    <td>
      <div class="d-flex flex-column gap-1">
        <!-- Source Badge -->
        <div>
          <% if policy.is_customer_added? %>
            <span class="badge bg-info-subtle text-info">
              <i class="bi bi-person-check me-1"></i>Customer
            </span>
          <% elsif policy.is_agent_added? %>
            <span class="badge bg-success-subtle text-success">
              <i class="bi bi-person-badge me-1"></i>Agent
            </span>
          <% elsif policy.is_admin_added? %>
            <span class="badge bg-primary-subtle text-primary">
              <i class="bi bi-shield-check me-1"></i>Admin
            </span>
          <% else %>
            <span class="badge bg-secondary-subtle text-secondary">
              <i class="bi bi-question-circle me-1"></i>Unknown
            </span>
          <% end %>
        </div>
        <!-- Type Badge -->
        <div>
          <span class="badge <%= policy.policy_classification_badge_class %>">
            <% if policy.drwise_policy? %>
              <i class="bi bi-check-circle me-1"></i>
            <% elsif policy.non_drwise_policy? %>
              <i class="bi bi-x-circle me-1"></i>
            <% else %>
              <i class="bi bi-question-circle me-1"></i>
            <% end %>
            <%= policy.policy_classification %>
          </span>
        </div>
      </div>
    </td>
    <td>
      <div>
        <div class="fw-bold">₹<%= policy.sum_insured %></div>
        <small class="text-muted">Sum Assured</small>
      </div>
    </td>
    <td>
      <div>
        <div class="fw-bold">₹<%= policy.total_premium %></div>
        <small class="text-muted"><%= policy.payment_mode&.humanize %></small>
      </div>
    </td>
    <td>
      <% if policy.status == 'active' %>
        <span class="badge bg-success">Active</span>
      <% elsif policy.status == 'expired' %>
        <span class="badge bg-danger">Expired</span>
      <% else %>
        <span class="badge bg-warning"><%= policy.status&.humanize || 'Pending' %></span>
      <% end %>
    </td>
    <td>
      <div class="d-flex gap-1">
        <%= link_to admin_life_insurance_path(policy), class: "btn btn-sm btn-outline-primary", title: "View" do %>
          <i class="bi bi-eye"></i>
        <% end %>
        <%= link_to commission_details_admin_life_insurance_path(policy), class: "btn btn-sm btn-outline-info", title: "Commission Details" do %>
          <i class="bi bi-percent"></i>
        <% end %>
        <%= link_to edit_admin_life_insurance_path(policy), class: "btn btn-sm btn-outline-warning", title: "Edit" do %>
          <i class="bi bi-pencil"></i>
        <% end %>
        <%= link_to admin_life_insurance_path(policy), method: :delete,
            class: "btn btn-sm btn-outline-danger",
            title: "Delete",
            data: {
              confirm: "Are you sure you want to delete this life insurance policy?",
              turbo_method: :delete
            } do %>
          <i class="bi bi-trash"></i>
        <% end %>
      </div>
    </td>
  </tr>
<% end %>