<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-1">Comprehensive Product Portfolio</h2>
    <p class="text-muted mb-0"><strong><%= @customer.display_name %></strong> - Complete product coverage matrix and commission tracking</p>
  </div>
  <div class="d-flex gap-2">
    <%= link_to admin_customers_path, class: "btn btn-outline-secondary" do %>
      <i class="bi bi-arrow-left me-1"></i>
      Back to Customers
    <% end %>
    <%= link_to admin_customer_path(@customer), class: "btn btn-primary" do %>
      <i class="bi bi-eye me-1"></i>
      View Customer
    <% end %>
  </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
  <div class="col-xl-3 col-md-6 mb-3">
    <div class="card h-100 border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <h6 class="text-muted mb-2">Total Policies</h6>
            <h3 class="mb-0 text-primary"><%= @commission_summary[:total_policies] %></h3>
          </div>
          <div class="bg-primary bg-opacity-10 rounded p-3">
            <i class="bi bi-file-earmark-text text-primary fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-3">
    <div class="card h-100 border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <h6 class="text-muted mb-2">Coverage Score</h6>
            <h3 class="mb-0 text-success"><%= @commission_summary[:opted_count] %> / <%= @commission_summary[:total_products] %></h3>
          </div>
          <div class="bg-success bg-opacity-10 rounded p-3">
            <i class="bi bi-check-circle text-success fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-3">
    <div class="card h-100 border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <h6 class="text-muted mb-2">Total Premium</h6>
            <h3 class="mb-0 text-warning">₹<%= number_with_delimiter(@commission_summary[:total_premium]) %></h3>
          </div>
          <div class="bg-warning bg-opacity-10 rounded p-3">
            <i class="bi bi-currency-rupee text-warning fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6 mb-3">
    <div class="card h-100 border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <h6 class="text-muted mb-2">Commission Paid</h6>
            <h3 class="mb-0 text-info">₹<%= number_with_delimiter(@commission_payouts.where(status: 'paid').sum(:payout_amount)) %></h3>
          </div>
          <div class="bg-info bg-opacity-10 rounded p-3">
            <i class="bi bi-cash-coin text-info fs-4"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Policy Matrix Chart - Very Attractive -->
<div class="card border-0 shadow-sm mb-4">
  <div class="card-header bg-transparent border-0">
    <div class="d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Comprehensive Product Matrix</h5>
      <small class="text-muted">Complete portfolio overview Dr WISE all 17 product categories</small>
    </div>
  </div>
  <div class="card-body">
    <!-- Coverage Overview Chart -->
    <div class="row mb-5">
      <div class="col-md-6">
        <div class="coverage-chart-container">
          <canvas id="coverageChart" width="300" height="300"></canvas>
          <div class="chart-center-text">
            <div class="center-score">
              <span class="score-number"><%= @commission_summary[:opted_count] %></span>
              <span class="score-total">/<%= @commission_summary[:total_products] %></span>
            </div>
            <div class="score-label">Products</div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="coverage-details">
          <h6 class="mb-3">Coverage Analysis</h6>
          <div class="coverage-metrics">
            <div class="metric-item mb-3">
              <div class="d-flex justify-content-between align-items-center">
                <span class="metric-label">Coverage Percentage</span>
                <span class="metric-value text-primary"><%= @commission_summary[:coverage_percentage] %>%</span>
              </div>
              <div class="progress mt-2" style="height: 8px;">
                <div class="progress-bar bg-primary" style="width: <%= @commission_summary[:coverage_percentage] %>%"></div>
              </div>
            </div>

            <div class="metric-item mb-3">
              <div class="d-flex justify-content-between align-items-center">
                <span class="metric-label">Total Investment</span>
                <span class="metric-value text-success">₹<%= number_with_delimiter(@commission_summary[:total_premium]) %></span>
              </div>
            </div>

            <div class="metric-item">
              <div class="d-flex justify-content-between align-items-center">
                <span class="metric-label">Commission Status</span>
                <span class="badge bg-<%= @commission_payouts.where(status: 'paid').any? ? 'success' : 'warning' %>">
                  <%= @commission_payouts.where(status: 'paid').any? ? 'Payments Made' : 'Pending' %>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Comprehensive Product Matrix Table -->
    <div class="table-responsive product-matrix-container">
      <table class="table table-bordered mb-0 product-matrix-table">
        <thead>
          <tr class="table-header-row">
            <th colspan="5" class="product-category insurance-category">
              <i class="bi bi-shield-check me-2"></i>Insurance
            </th>
            <th colspan="4" class="product-category investments-category">
              <i class="bi bi-graph-up me-2"></i>Investments
            </th>
            <th colspan="3" class="product-category loans-category">
              <i class="bi bi-bank me-2"></i>Loans
            </th>
            <th class="product-category taxation-category">
              <i class="bi bi-calculator me-2"></i>Taxation
            </th>
            <th colspan="4" class="product-category travel-category">
              <i class="bi bi-airplane me-2"></i>Travel
            </th>
          </tr>
          <tr class="sub-header-row">
            <th class="product-subheader health">
              <i class="bi bi-heart-pulse me-1"></i>Life
            </th>
            <th class="product-subheader health">
              <i class="bi bi-activity me-1"></i>Health
            </th>
            <th class="product-subheader motor">
              <i class="bi bi-car-front me-1"></i>Motor
            </th>
            <th class="product-subheader general">
              <i class="bi bi-umbrella me-1"></i>General
            </th>
            <th class="product-subheader travel-ins">
              <i class="bi bi-airplane-engines me-1"></i>Travel
            </th>
            <th class="product-subheader mutual-fund">
              <i class="bi bi-pie-chart me-1"></i>Mutual Fund
            </th>
            <th class="product-subheader gold">
              <i class="bi bi-coin me-1"></i>Gold
            </th>
            <th class="product-subheader nps">
              <i class="bi bi-building me-1"></i>NPS
            </th>
            <th class="product-subheader bonds">
              <i class="bi bi-receipt me-1"></i>Bonds
            </th>
            <th class="product-subheader personal">
              <i class="bi bi-person me-1"></i>Personal
            </th>
            <th class="product-subheader home">
              <i class="bi bi-house me-1"></i>Home
            </th>
            <th class="product-subheader business">
              <i class="bi bi-briefcase me-1"></i>Business
            </th>
            <th class="product-subheader taxation">
              <i class="bi bi-file-earmark-text me-1"></i>ITR
            </th>
            <th class="product-subheader domestic">
              <i class="bi bi-geo me-1"></i>Domestic
            </th>
            <th class="product-subheader international">
              <i class="bi bi-globe me-1"></i>International
            </th>
            <th class="product-subheader additional-1">
              <i class="bi bi-plus-circle me-1"></i>Additional 1
            </th>
            <th class="product-subheader additional-2">
              <i class="bi bi-plus-circle me-1"></i>Additional 2
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="status-row">
            <% @product_status.each do |product_name, opted| %>
              <td class="product-status-cell">
                <div class="status-indicator-wrapper">
                  <div class="status-indicator <%= opted ? 'opted' : 'not-opted' %>">
                    <% if opted %>
                      <i class="bi bi-check-circle-fill status-icon opted-icon" title="<%= product_name %> - Active"></i>
                      <div class="status-text">Yes</div>
                    <% else %>
                      <i class="bi bi-x-circle status-icon not-opted-icon" title="<%= product_name %> - Not Active"></i>
                      <div class="status-text">No</div>
                    <% end %>
                  </div>
                  <% if opted && @policy_status["#{product_name} Insurance"] %>
                    <div class="product-details">
                      <small class="detail-count"><%= @policy_status["#{product_name} Insurance"][:count] %> policies</small>
                    </div>
                  <% end %>
                </div>
              </td>
            <% end %>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Policy Details Cards -->
<div class="row mb-4">
  <% @policy_status.each_with_index do |(policy_type, data), index| %>
    <div class="col-lg-4 mb-3">
      <div class="card h-100 border-0 shadow-sm">
        <div class="card-header bg-transparent border-0">
          <div class="d-flex justify-content-between align-items-center">
            <h6 class="mb-0 fw-bold">
              <i class="<%= data[:icon] %> text-<%= data[:color] %> me-2"></i>
              <%= policy_type %>
            </h6>
            <span class="badge bg-<%= data[:opted] ? 'success' : 'secondary' %>">
              <%= data[:opted] ? 'OPTED' : 'NOT OPTED' %>
            </span>
          </div>
        </div>
        <div class="card-body">
          <% if data[:opted] %>
            <div class="row g-3">
              <div class="col-6">
                <div class="stat-card">
                  <h4 class="text-primary mb-1"><%= data[:count] %></h4>
                  <small class="text-muted">Policies</small>
                </div>
              </div>
              <div class="col-6">
                <div class="stat-card">
                  <h4 class="text-success mb-1">₹<%= number_with_delimiter(data[:total_premium]) %></h4>
                  <small class="text-muted">Premium</small>
                </div>
              </div>
              <% if data[:latest_policy] %>
                <div class="col-12">
                  <div class="latest-policy bg-light rounded p-3">
                    <h6 class="text-muted mb-2">Latest Policy:</h6>
                    <div class="d-flex justify-content-between">
                      <span class="fw-bold"><%= data[:latest_policy].policy_number || "Policy ##{data[:latest_policy].id}" %></span>
                      <small class="text-muted"><%= data[:latest_policy].created_at.strftime('%b %d, %Y') %></small>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center py-4">
              <i class="bi bi-plus-circle text-muted" style="font-size: 3rem;"></i>
              <h6 class="text-muted mt-3">No policies found</h6>
              <small class="text-muted">Customer has not opted for this policy type</small>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<!-- Commission Payouts Table -->
<% if @commission_payouts.any? %>
  <div class="card border-0 shadow-sm">
    <div class="card-header bg-transparent border-0">
      <h5 class="mb-0">Commission Payouts</h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="bg-light">
            <tr>
              <th class="border-0">Policy</th>
              <th class="border-0">Type</th>
              <th class="border-0">Payout To</th>
              <th class="border-0">Amount</th>
              <th class="border-0">Status</th>
              <th class="border-0">Date</th>
            </tr>
          </thead>
          <tbody>
            <% @commission_payouts.each do |payout| %>
              <tr>
                <td>
                  <div class="fw-bold"><%= payout.policy_number || "Policy ##{payout.policy_id}" %></div>
                  <small class="text-muted"><%= payout.customer_name %></small>
                </td>
                <td>
                  <span class="badge bg-<%=
                    case payout.policy_type
                    when 'health' then 'success'
                    when 'life' then 'primary'
                    when 'motor' then 'warning'
                    else 'secondary'
                    end
                  %>">
                    <%= payout.policy_type.humanize %>
                  </span>
                </td>
                <td><%= payout.payout_to.humanize %></td>
                <td class="fw-bold text-success">₹<%= number_with_delimiter(payout.payout_amount) %></td>
                <td>
                  <span class="badge bg-<%=
                    case payout.status
                    when 'paid' then 'success'
                    when 'pending' then 'warning'
                    when 'processing' then 'info'
                    when 'cancelled' then 'danger'
                    else 'secondary'
                    end
                  %>">
                    <%= payout.status.humanize %>
                  </span>
                </td>
                <td><%= payout.payout_date&.strftime('%b %d, %Y') || 'Pending' %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
<% else %>
  <div class="card border-0 shadow-sm">
    <div class="card-body text-center py-5">
      <i class="bi bi-cash-coin text-muted fs-1 mb-3"></i>
      <h5 class="text-muted mb-2">No Commission Payouts</h5>
      <p class="text-muted">No commission payouts have been processed for this customer's policies yet.</p>
    </div>
  </div>
<% end %>

<style>
/* Chart Container Styling */
.coverage-chart-container {
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 20px 0;
}

.chart-center-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

.center-score {
  font-size: 2.5rem;
  font-weight: bold;
  color: #495057;
}

.score-total {
  font-size: 1.8rem;
  color: #6c757d;
}

.score-label {
  font-size: 1rem;
  color: #6c757d;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Coverage Details */
.coverage-details {
  padding: 20px;
}

.metric-item {
  margin-bottom: 1rem;
}

.metric-label {
  font-weight: 600;
  color: #495057;
}

.metric-value {
  font-weight: bold;
  font-size: 1.1rem;
}

/* Comprehensive Product Matrix Table */
.product-matrix-container {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-radius: 15px;
  padding: 20px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.product-matrix-table {
  font-size: 0.9rem;
  border: none;
  background: white;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
}

.product-matrix-table th,
.product-matrix-table td {
  border: 1px solid #e9ecef;
  vertical-align: middle;
  text-align: center;
}


/* Product Category Headers */
.product-category {
  font-weight: bold;
  font-size: 1rem;
  padding: 15px 10px;
  text-align: center;
  color: white;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  border: none;
}

.insurance-category {
  background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
}

.investments-category {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.loans-category {
  background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
}

.taxation-category {
  background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
}

.travel-category {
  background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
}

/* Product Subheaders */
.product-subheader {
  background: #f8f9fa;
  border: 1px solid #dee2e6;
  padding: 12px 8px;
  font-weight: 600;
  font-size: 0.85rem;
  color: #495057;
  min-width: 80px;
}

.product-subheader.health {
  background: linear-gradient(135deg, rgba(220, 53, 69, 0.1) 0%, rgba(220, 53, 69, 0.05) 100%);
  border-color: rgba(220, 53, 69, 0.2);
  color: #dc3545;
}

.product-subheader.motor {
  background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.05) 100%);
  border-color: rgba(255, 193, 7, 0.2);
  color: #ffc107;
}

.product-subheader.general {
  background: linear-gradient(135deg, rgba(13, 110, 253, 0.1) 0%, rgba(13, 110, 253, 0.05) 100%);
  border-color: rgba(13, 110, 253, 0.2);
  color: #0d6efd;
}

.product-subheader.travel-ins {
  background: linear-gradient(135deg, rgba(111, 66, 193, 0.1) 0%, rgba(111, 66, 193, 0.05) 100%);
  border-color: rgba(111, 66, 193, 0.2);
  color: #6f42c1;
}

.product-subheader.mutual-fund {
  background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(40, 167, 69, 0.05) 100%);
  border-color: rgba(40, 167, 69, 0.2);
  color: #28a745;
}

.product-subheader.gold {
  background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.05) 100%);
  border-color: rgba(255, 193, 7, 0.2);
  color: #ffc107;
}

.product-subheader.nps {
  background: linear-gradient(135deg, rgba(13, 202, 240, 0.1) 0%, rgba(13, 202, 240, 0.05) 100%);
  border-color: rgba(13, 202, 240, 0.2);
  color: #0dcaf0;
}

.product-subheader.bonds {
  background: linear-gradient(135deg, rgba(108, 117, 125, 0.1) 0%, rgba(108, 117, 125, 0.05) 100%);
  border-color: rgba(108, 117, 125, 0.2);
  color: #6c757d;
}

.product-subheader.personal {
  background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.05) 100%);
  border-color: rgba(255, 193, 7, 0.2);
  color: #ffc107;
}

.product-subheader.home {
  background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(40, 167, 69, 0.05) 100%);
  border-color: rgba(40, 167, 69, 0.2);
  color: #28a745;
}

.product-subheader.business {
  background: linear-gradient(135deg, rgba(13, 110, 253, 0.1) 0%, rgba(13, 110, 253, 0.05) 100%);
  border-color: rgba(13, 110, 253, 0.2);
  color: #0d6efd;
}

.product-subheader.taxation {
  background: linear-gradient(135deg, rgba(220, 53, 69, 0.1) 0%, rgba(220, 53, 69, 0.05) 100%);
  border-color: rgba(220, 53, 69, 0.2);
  color: #dc3545;
}

.product-subheader.domestic {
  background: linear-gradient(135deg, rgba(111, 66, 193, 0.1) 0%, rgba(111, 66, 193, 0.05) 100%);
  border-color: rgba(111, 66, 193, 0.2);
  color: #6f42c1;
}

.product-subheader.international {
  background: linear-gradient(135deg, rgba(220, 53, 69, 0.1) 0%, rgba(220, 53, 69, 0.05) 100%);
  border-color: rgba(220, 53, 69, 0.2);
  color: #dc3545;
}

/* Product Status Cells */
.product-status-cell {
  padding: 15px 10px;
  background: #ffffff;
  border: 1px solid #e9ecef;
  transition: all 0.3s ease;
}

.product-status-cell:hover {
  background: #f8f9fa;
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.status-indicator-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 60px;
}

.status-indicator {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5px;
}

.status-icon {
  font-size: 1.8rem;
  transition: all 0.3s ease;
}

.opted-icon {
  color: #28a745;
  animation: checkPulse 2s infinite;
}

.not-opted-icon {
  color: #6c757d;
}

.status-text {
  font-size: 0.8rem;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-indicator.opted .status-text {
  color: #28a745;
}

.status-indicator.not-opted .status-text {
  color: #6c757d;
}

.product-details {
  margin-top: 5px;
}

.detail-count {
  font-size: 0.7rem;
  color: #6c757d;
  font-weight: 500;
}

/* Animations */
@keyframes checkPulse {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
  }
}

/* Old Policy Matrix Table (Keep for backward compatibility) */
.policy-matrix-table {
  font-size: 1rem;
}

.policy-status-cell {
  padding: 2rem 1rem !important;
  vertical-align: middle;
}

.policy-status-indicator {
  text-align: center;
  padding: 1.5rem;
  border-radius: 15px;
  transition: all 0.3s ease;
  min-height: 200px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.policy-status-indicator.opted {
  background: linear-gradient(135deg, rgba(25, 135, 84, 0.1) 0%, rgba(25, 135, 84, 0.05) 100%);
  border: 2px solid rgba(25, 135, 84, 0.2);
}

.policy-status-indicator.not-opted {
  background: linear-gradient(135deg, rgba(108, 117, 125, 0.1) 0%, rgba(108, 117, 125, 0.05) 100%);
  border: 2px solid rgba(108, 117, 125, 0.2);
}

.policy-status-indicator:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.status-icon-large {
  margin-bottom: 1rem;
}

.policy-details {
  margin-top: 1rem;
}

.detail-item {
  margin-bottom: 0.5rem;
}

/* Policy Details Cards */
.stat-card {
  text-align: center;
  padding: 1rem;
}

.latest-policy {
  margin-top: 1rem;
}

/* Responsive Design */
@media (max-width: 768px) {
  .policy-status-cell {
    padding: 1rem 0.5rem !important;
  }

  .policy-status-indicator {
    padding: 1rem;
    min-height: 150px;
  }

  .center-score {
    font-size: 2rem;
  }

  .coverage-chart-container {
    margin: 10px 0;
  }

  /* Product Matrix Mobile Responsiveness */
  .product-matrix-container {
    padding: 10px;
    overflow-x: auto;
  }

  .product-matrix-table {
    min-width: 1200px;
    font-size: 0.8rem;
  }


  .product-category {
    font-size: 0.9rem;
    padding: 10px 8px;
  }

  .product-subheader {
    font-size: 0.75rem;
    padding: 10px 6px;
    min-width: 70px;
  }

  .product-status-cell {
    padding: 10px 8px;
  }

  .status-icon {
    font-size: 1.5rem;
  }

  .status-text {
    font-size: 0.7rem;
  }
}

@media (max-width: 576px) {
  .product-matrix-table {
    font-size: 0.7rem;
  }

}
</style>

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Create comprehensive coverage donut chart for all 17 products
  const ctx = document.getElementById('coverageChart');
  if (ctx) {
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Active Products', 'Available Products'],
        datasets: [{
          data: [
            <%= @commission_summary[:opted_count] %>,
            <%= @commission_summary[:total_products] - @commission_summary[:opted_count] %>
          ],
          backgroundColor: [
            'rgba(25, 135, 84, 0.8)',   // Green for Active Products
            'rgba(108, 117, 125, 0.3)'  // Gray for Available Products
          ],
          borderColor: [
            'rgba(25, 135, 84, 1)',
            'rgba(108, 117, 125, 0.5)'
          ],
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              padding: 20,
              usePointStyle: true,
              font: {
                size: 12
              }
            }
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            titleColor: 'white',
            bodyColor: 'white',
            borderColor: 'rgba(255, 255, 255, 0.2)',
            borderWidth: 1,
            callbacks: {
              label: function(context) {
                const label = context.label;
                const value = context.parsed;
                const percentage = ((value / <%= @commission_summary[:total_products] %>) * 100).toFixed(1);
                return `${label}: ${value} (${percentage}%)`;
              }
            }
          }
        },
        cutout: '60%',
        animation: {
          animateRotate: true,
          duration: 1500
        }
      }
    });
  }
});
</script>