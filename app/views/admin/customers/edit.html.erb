<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-1">Edit Customer</h2>
    <p class="text-muted mb-0">Update <%= @customer.display_name %> information</p>
  </div>
  <div class="d-flex gap-2">
    <%= link_to admin_customer_path(@customer), class: "btn btn-outline-info" do %>
      <i class="bi bi-eye me-1"></i>
      View Customer
    <% end %>
    <%= link_to admin_customers_path, class: "btn btn-outline-secondary" do %>
      <i class="bi bi-arrow-left me-1"></i>
      Back to Customers
    <% end %>
  </div>
</div>

<div class="row">
  <div class="col-lg-8">
    <%= form_with model: [:admin, @customer], local: true, multipart: true, class: "needs-validation", novalidate: true do |form| %>

      <!-- Personal Details -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-transparent border-0">
          <h5 class="mb-0">Personal Details</h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <%= form.label :first_name, class: "form-label" do %>
                First Name <span class="text-danger">*</span>
              <% end %>
              <%= form.text_field :first_name, class: "form-control", placeholder: "Enter first name", required: true %>
              <div class="invalid-feedback">Please provide a first name.</div>
            </div>
            <div class="col-md-6">
              <%= form.label :last_name, class: "form-label" do %>
                Last Name <span class="text-danger">*</span>
              <% end %>
              <%= form.text_field :last_name, class: "form-control", placeholder: "Enter last name", required: true %>
              <div class="invalid-feedback">Please provide a last name.</div>
            </div>
            <div class="col-md-6">
              <%= form.label :middle_name, class: "form-label" %>
              <%= form.text_field :middle_name, class: "form-control", placeholder: "Enter middle name" %>
            </div>
            <div class="col-md-6">
              <%= form.label :email, class: "form-label" do %>
                Email <span class="text-danger">*</span>
              <% end %>
              <%= form.email_field :email, class: "form-control", placeholder: "Enter email address", required: true %>
              <div class="invalid-feedback">Please provide a valid email.</div>
            </div>
            <div class="col-md-6">
              <%= form.label :mobile, class: "form-label" do %>
                Mobile Number <span class="text-danger">*</span>
              <% end %>
              <%= form.text_field :mobile, class: "form-control", placeholder: "Enter mobile number", type: "tel", required: true %>
              <div class="invalid-feedback">Please provide a mobile number.</div>
            </div>
            <div class="col-md-6">
              <%= form.label :whatsapp_number, class: "form-label" %>
              <%= form.text_field :whatsapp_number, class: "form-control", placeholder: "Enter WhatsApp number", type: "tel" %>
              <small class="form-text text-muted">Leave blank if same as mobile</small>
            </div>
          </div>
        </div>
      </div>




      <!-- Current Images -->
      <% if @customer.personal_image.attached? || @customer.house_image.attached? %>
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header bg-transparent border-0">
            <h5 class="mb-0">Current Images</h5>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <% if @customer.personal_image.attached? %>
                <div class="col-md-6">
                  <h6>Personal Image</h6>
                  <%= image_tag @customer.personal_image, class: "img-thumbnail", style: "max-height: 200px; width: 100%; object-fit: cover;" %>
                  <small class="d-block text-muted mt-1"><%= @customer.personal_image.filename %></small>
                </div>
              <% end %>
              <% if @customer.house_image.attached? %>
                <div class="col-md-6">
                  <h6>House Image</h6>
                  <%= image_tag @customer.house_image, class: "img-thumbnail", style: "max-height: 200px; width: 100%; object-fit: cover;" %>
                  <small class="d-block text-muted mt-1"><%= @customer.house_image.filename %></small>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Image Uploads -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-transparent border-0">
          <h5 class="mb-0">Upload Images</h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <%= form.label :personal_image, "Personal Image", class: "form-label" %>
              <%= form.file_field :personal_image, class: "form-control", accept: "image/*" %>
              <div class="form-text">Upload or replace personal image</div>
            </div>
            <div class="col-md-6">
              <%= form.label :house_image, "House Image", class: "form-label" %>
              <%= form.file_field :house_image, class: "form-control", accept: "image/*" %>
              <div class="form-text">Upload or replace house image</div>
            </div>
          </div>
        </div>
      </div>


      <!-- Form Actions -->
      <div class="d-flex gap-2">
        <%= form.submit "Update Customer", class: "btn btn-primary" %>
        <%= link_to "Cancel", admin_customer_path(@customer), class: "btn btn-outline-secondary" %>
      </div>
    <% end %>
  </div>

  <!-- Customer Summary -->
  <div class="col-lg-4">
    <div class="card border-0 shadow-sm mb-3">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0">Customer Summary</h6>
      </div>
      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <% if @customer.profile_image.attached? %>
            <%= image_tag @customer.profile_image, class: "rounded-circle me-3", style: "width: 50px; height: 50px; object-fit: cover;" %>
          <% else %>
            <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
              <i class="bi bi-person text-primary"></i>
            </div>
          <% end %>
          <div>
            <h6 class="mb-0"><%= @customer.display_name %></h6>
            <span class="badge bg-primary">
              Customer
            </span>
          </div>
        </div>

        <hr>

        <div class="row g-2 mb-2">
          <div class="col-5"><strong>ID:</strong></div>
          <div class="col-7">#<%= @customer.id %></div>
        </div>

        <div class="row g-2 mb-2">
          <div class="col-5"><strong>Mobile:</strong></div>
          <div class="col-7"><%= @customer.mobile %></div>
        </div>

        <div class="row g-2 mb-2">
          <div class="col-5"><strong>Email:</strong></div>
          <div class="col-7"><%= @customer.email %></div>
        </div>



        <div class="row g-2 mb-2">
          <div class="col-5"><strong>Status:</strong></div>
          <div class="col-7">
            <span class="badge bg-success">
              Active
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {

  // Form validation
  const forms = document.querySelectorAll('.needs-validation');
  Array.prototype.slice.call(forms).forEach(function(form) {
    form.addEventListener('submit', function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
        form.classList.add('was-validated');
      }
    }, false);
  });

  // Only show validation errors for empty fields, not filled ones
  const inputs = document.querySelectorAll('.needs-validation input[required]');
  inputs.forEach(function(input) {
    if (input.value && input.value.trim() !== '') {
      input.classList.add('is-valid');
      input.classList.remove('is-invalid');
    }
  });
});
</script>

<style>
</style>