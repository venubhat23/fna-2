<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-1">Edit Customer</h2>
    <p class="text-muted mb-0">Update <%= @customer.display_name %> information</p>
  </div>
  <div class="d-flex gap-2">
    <%= link_to admin_customer_path(@customer), class: "btn btn-outline-info" do %>
      <i class="bi bi-eye me-1"></i>
      View Customer
    <% end %>
    <%= link_to admin_customers_path, class: "btn btn-outline-secondary" do %>
      <i class="bi bi-arrow-left me-1"></i>
      Back to Customers
    <% end %>
  </div>
</div>

<div class="row">
  <div class="col-lg-8">
    <%= form_with model: [:admin, @customer], local: true, multipart: true, class: "needs-validation", novalidate: true do |form| %>
      <!-- Customer Type Selection -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-transparent border-0">
          <h5 class="mb-0">Customer Type</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <%= form.label :customer_type, class: "form-label" do %>
                Customer Type <span class="text-danger">*</span>
              <% end %>
              <%= form.select :customer_type,
                  options_for_select([
                    ['Individual', 'individual'],
                    ['Corporate', 'corporate']
                  ], @customer.customer_type),
                  { prompt: 'Select customer type' },
                  { class: "form-select", id: "customer_type", required: true } %>
              <div class="invalid-feedback">Please select a customer type.</div>
            </div>
            <div class="col-md-6">
              <%= form.label :added_by, class: "form-label" %>
              <%= form.select :added_by,
                  options_for_select([
                    ['Self', 'self'],
                    ['Affiliate', 'sub_agent']
                  ], @customer.added_by),
                  { prompt: 'Select added by' },
                  { class: "form-select" } %>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-md-6">
              <%= form.label :sub_agent_id, "Affiliate *", class: "form-label" %>
              <%= form.select :sub_agent_id,
                  options_for_select([['Self', nil]] + @sub_agents.map { |sa| ["#{sa.first_name} #{sa.last_name}", sa.id] }, @customer.sub_agent_id),
                  { prompt: 'Select Affiliate' },
                  { class: "form-control #{'is-invalid' if @customer.errors[:sub_agent_id].any?}", required: true } %>
              <% if @customer.errors[:sub_agent_id].any? %>
                <div class="invalid-feedback"><%= @customer.errors[:sub_agent_id].first %></div>
              <% end %>
              <small class="form-text text-muted">Select the affiliate for this customer</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Individual Customer Details -->
      <div id="individual_fields" class="card border-0 shadow-sm mb-4" style="display: <%= @customer.individual? ? 'block' : 'none' %>;">
        <div class="card-header bg-transparent border-0">
          <h5 class="mb-0">Personal Details</h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <%= form.label :first_name, class: "form-label" do %>
                First Name <span class="text-danger">*</span>
              <% end %>
              <%= form.text_field :first_name, class: "form-control", placeholder: "Enter first name" %>
              <div class="invalid-feedback">Please provide a first name.</div>
            </div>
            <div class="col-md-6">
              <%= form.label :middle_name, class: "form-label" %>
              <%= form.text_field :middle_name, class: "form-control", placeholder: "Enter middle name" %>
            </div>
            <div class="col-md-6">
              <%= form.label :last_name, class: "form-label" do %>
                Last Name <span class="text-danger">*</span>
              <% end %>
              <%= form.text_field :last_name, class: "form-control", placeholder: "Enter last name" %>
              <div class="invalid-feedback">Please provide a last name.</div>
            </div>
            <div class="col-md-6">
              <%= form.label :email, class: "form-label" %>
              <%= form.email_field :email, class: "form-control", placeholder: "Enter email address" %>
            </div>
            <div class="col-md-6">
              <%= form.label :mobile, class: "form-label" do %>
                Mobile Number <span class="text-danger">*</span>
              <% end %>
              <%= form.text_field :mobile, class: "form-control", placeholder: "Enter mobile number", type: "tel" %>
              <div class="invalid-feedback">Please provide a mobile number.</div>
            </div>
            <div class="col-md-6">
              <%= form.label :birth_date, class: "form-label" do %>
                Birth Date <span class="text-danger">*</span>
              <% end %>
              <%= form.date_field :birth_date, class: "form-control" %>
              <div class="invalid-feedback">Please provide a birth date.</div>
            </div>
            <div class="col-md-6">
              <%= form.label :gender, class: "form-label" do %>
                Gender <span class="text-danger">*</span>
              <% end %>
              <%= form.select :gender,
                  options_for_select([
                    ['Male', 'male'],
                    ['Female', 'female'],
                    ['Other', 'other']
                  ], @customer.gender),
                  { prompt: 'Select gender' },
                  { class: "form-select" } %>
              <div class="invalid-feedback">Please select a gender.</div>
            </div>
            <div class="col-md-6">
              <%= form.label :birth_place, class: "form-label" %>
              <%= form.text_field :birth_place, class: "form-control", placeholder: "Enter birth place" %>
            </div>
            <div class="col-md-6">
              <%= form.label :height_feet, "Height (Feet)", class: "form-label" %>
              <%= form.number_field :height_feet, class: "form-control", placeholder: "e.g., 5.8", step: 0.1, min: 3.5, max: 8.0 %>
              <small class="form-text text-muted">Range: 3.5 - 8.0 feet</small>
            </div>
            <div class="col-md-6">
              <%= form.label :weight_kg, "Weight (Kg)", class: "form-label" %>
              <%= form.number_field :weight_kg, class: "form-control", placeholder: "e.g., 70", step: 0.1 %>
              <small class="form-text text-muted">Enter weight in kg</small>
            </div>
            <div class="col-md-6">
              <%= form.label :education, class: "form-label" %>
              <%= form.text_field :education, class: "form-control", placeholder: "Enter education qualification" %>
            </div>
            <div class="col-md-6">
              <%= form.label :marital_status, class: "form-label" %>
              <%= form.select :marital_status,
                  options_for_select([
                    ['Single', 'single'],
                    ['Married', 'married'],
                    ['Divorced', 'divorced'],
                    ['Widowed', 'widowed']
                  ], @customer.marital_status),
                  { prompt: 'Select marital status' },
                  { class: "form-select" } %>
            </div>
            <div class="col-md-6">
              <%= form.label :business_job, "Business/Job", class: "form-label" %>
              <%= form.select :business_job,
                  options_for_select([
                    ['Private Employee', 'private_employee'],
                    ['Government Employee', 'government_employee'],
                    ['Self Employed', 'self_employed'],
                    ['Business Owner', 'business_owner'],
                    ['Professional', 'professional'],
                    ['Student', 'student'],
                    ['Homemaker', 'homemaker'],
                    ['Retired', 'retired'],
                    ['Unemployed', 'unemployed']
                  ], @customer.business_job),
                  { prompt: 'Select Business/Job' },
                  { class: "form-select" } %>
            </div>
            <div class="col-md-6">
              <%= form.label :business_name, "Name of Business/Job", class: "form-label" %>
              <%= form.text_field :business_name, class: "form-control", placeholder: "Enter business/job name" %>
            </div>
            <div class="col-md-6">
              <%= form.label :occupation, class: "form-label" %>
              <%= form.text_field :occupation, class: "form-control", placeholder: "Enter occupation" %>
            </div>
            <div class="col-md-6">
              <%= form.label :job_name, class: "form-label" %>
              <%= form.text_field :job_name, class: "form-control", placeholder: "Enter job title" %>
            </div>
            <div class="col-md-6">
              <%= form.label :type_of_duty, class: "form-label" %>
              <%= form.text_field :type_of_duty, class: "form-control", placeholder: "Enter type of duty" %>
            </div>
            <div class="col-md-6">
              <%= form.label :annual_income, class: "form-label" %>
              <%= form.number_field :annual_income, class: "form-control", placeholder: "Enter annual income", step: 0.01 %>
            </div>
            <div class="col-md-6">
              <%= form.label :pan_number, "PAN No", class: "form-label" %>
              <%= form.text_field :pan_number, class: "form-control", placeholder: "Enter PAN number", pattern: "[A-Z]{5}[0-9]{4}[A-Z]" %>
            </div>
            <div class="col-md-6">
              <%= form.label :gst_number, class: "form-label" %>
              <%= form.text_field :gst_number, class: "form-control", placeholder: "Enter GST number" %>
            </div>
            <div class="col-12">
              <%= form.label :additional_information, "Additional Information", class: "form-label" %>
              <%= form.text_area :additional_information, class: "form-control", rows: 3, placeholder: "Enter additional notes" %>
            </div>
          </div>
        </div>
      </div>

      <!-- Corporate Customer Details -->
      <div id="corporate_fields" class="card border-0 shadow-sm mb-4" style="display: <%= @customer.corporate? ? 'block' : 'none' %>;">
        <div class="card-header bg-transparent border-0">
          <h5 class="mb-0">Corporate Details</h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <%= form.label :company_name, class: "form-label" do %>
                Company Name <span class="text-danger">*</span>
              <% end %>
              <%= form.text_field :company_name, class: "form-control", placeholder: "Enter company name" %>
              <div class="invalid-feedback">Please provide a company name.</div>
            </div>
            <div class="col-md-6">
              <%= form.label :email, class: "form-label" %>
              <%= form.email_field :email, class: "form-control", placeholder: "Enter email address" %>
            </div>
            <div class="col-md-6">
              <%= form.label :mobile, class: "form-label" do %>
                Mobile Number <span class="text-danger">*</span>
              <% end %>
              <%= form.text_field :mobile, class: "form-control", placeholder: "Enter mobile number", type: "tel" %>
              <div class="invalid-feedback">Please provide a mobile number.</div>
            </div>
            <div class="col-md-6">
              <%= form.label :annual_income, class: "form-label" do %>
                Annual Income <span class="text-danger">*</span>
              <% end %>
              <%= form.number_field :annual_income, class: "form-control", placeholder: "Enter annual income", step: 0.01 %>
              <div class="invalid-feedback">Please provide annual income.</div>
            </div>
            <div class="col-md-6">
              <%= form.label :pan_number, class: "form-label" do %>
                PAN Number <span class="text-danger">*</span>
              <% end %>
              <%= form.text_field :pan_number, class: "form-control", placeholder: "Enter PAN number", pattern: "[A-Z]{5}[0-9]{4}[A-Z]" %>
              <div class="invalid-feedback">Please provide a valid PAN number.</div>
            </div>
            <div class="col-md-6">
              <%= form.label :gst_number, class: "form-label" %>
              <%= form.text_field :gst_number, class: "form-control", placeholder: "Enter GST number" %>
            </div>
          </div>
        </div>
      </div>

      <!-- Common Address Details -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-transparent border-0">
          <h5 class="mb-0">Address Details</h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <%= form.label :address, class: "form-label" do %>
                Address <span class="text-danger">*</span>
              <% end %>
              <%= form.text_area :address, class: "form-control", rows: 3, placeholder: "Enter full address" %>
              <div class="invalid-feedback">Please provide an address.</div>
            </div>
            <div class="col-md-4">
              <%= form.label :state, class: "form-label" do %>
                State <span class="text-danger">*</span>
              <% end %>
              <%= form.text_field :state, class: "form-control", placeholder: "Enter state", id: "customer_state" %>
              <div class="invalid-feedback">Please provide a state.</div>
            </div>
            <div class="col-md-4">
              <%= form.label :city, class: "form-label" do %>
                City <span class="text-danger">*</span>
              <% end %>
              <%= form.text_field :city, class: "form-control", placeholder: "Enter city", id: "customer_city" %>
              <div class="invalid-feedback">Please provide a city.</div>
            </div>
            <div class="col-md-4">
              <%= form.label :pincode, class: "form-label" %>
              <%= form.text_field :pincode, class: "form-control", placeholder: "Enter pincode", id: "customer_pincode" %>
            </div>
          </div>
        </div>
      </div>

      <!-- Nominee Details -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-transparent border-0">
          <h5 class="mb-0">Nominee Details</h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-4">
              <%= form.label :nominee_name, class: "form-label" %>
              <%= form.text_field :nominee_name, class: "form-control", placeholder: "Enter nominee name" %>
            </div>
            <div class="col-md-4">
              <%= form.label :nominee_relation, class: "form-label" %>
              <%= form.text_field :nominee_relation, class: "form-control", placeholder: "Enter relation" %>
            </div>
            <div class="col-md-4">
              <%= form.label :nominee_date_of_birth, class: "form-label" %>
              <%= form.date_field :nominee_date_of_birth, class: "form-control" %>
            </div>
          </div>
        </div>
      </div>

      <!-- Current Files -->
      <% if @customer.profile_image.attached? || @customer.documents.any? || @customer.uploaded_documents.any? %>
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header bg-transparent border-0">
            <h5 class="mb-0">Current Files</h5>
          </div>
          <div class="card-body">
            <% if @customer.profile_image.attached? %>
              <h6>Profile Image</h6>
              <div class="row g-2 mb-3">
                <div class="col-md-3">
                  <%= image_tag @customer.profile_image, class: "img-thumbnail", style: "max-height: 100px;" %>
                  <small class="d-block text-muted"><%= @customer.profile_image.filename %></small>
                </div>
              </div>
            <% end %>

            <% if @customer.documents.any? %>
              <h6>Legacy Documents</h6>
              <div class="list-group mb-3">
                <% @customer.documents.each do |document| %>
                  <div class="list-group-item d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-file-earmark me-2"></i><%= document.filename %></span>
                    <%= link_to url_for(document.file), class: "btn btn-sm btn-outline-primary", target: "_blank" do %>
                      <i class="bi bi-download"></i> Download
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% end %>

            <!-- New Document System -->
            <% if @customer.uploaded_documents.any? %>
              <h6>Documents</h6>
              <div class="row">
                <% @customer.uploaded_documents.each do |document| %>
                  <div class="col-md-6 mb-3">
                    <div class="card border-0 shadow-sm">
                      <div class="card-body">
                        <div class="d-flex align-items-center">
                          <div class="flex-shrink-0">
                            <i class="bi bi-<%= document.file_icon %> text-primary fs-4"></i>
                          </div>
                          <div class="flex-grow-1 ms-3">
                            <h6 class="mb-1"><%= document.title %></h6>
                            <small class="text-muted">
                              <%= document.human_document_type %> •
                              <%= document.human_file_type %>
                              <% if document.file_size %>
                                • <%= number_to_human_size(document.file_size) %>
                              <% end %>
                            </small>
                            <% if document.description.present? %>
                              <p class="text-muted mt-1 mb-0 small"><%= document.description %></p>
                            <% end %>
                          </div>
                          <div class="flex-shrink-0">
                            <div class="btn-group">
                              <%= link_to admin_document_path(document), class: "btn btn-sm btn-outline-info", target: "_blank", title: "View" do %>
                                <i class="bi bi-eye"></i>
                              <% end %>
                              <%= link_to download_admin_document_path(document), class: "btn btn-sm btn-outline-primary", target: "_blank", title: "Download" do %>
                                <i class="bi bi-download"></i>
                              <% end %>
                              <%= link_to admin_document_path(document), method: :delete,
                                  class: "btn btn-sm btn-outline-danger",
                                  title: "Delete",
                                  confirm: "Are you sure you want to delete this document?",
                                  data: { turbo_method: :delete } do %>
                                <i class="bi bi-trash"></i>
                              <% end %>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- File Uploads -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-transparent border-0">
          <h5 class="mb-0">Upload New Files</h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <%= form.label :profile_images, "Profile Images", class: "form-label" %>
              <%= form.file_field :profile_images, class: "form-control", multiple: true, accept: "image/*" %>
              <div class="form-text">Upload additional profile image(s)</div>
            </div>
            <div class="col-md-6">
              <%= form.label :documents, class: "form-label" %>
              <%= form.file_field :documents, class: "form-control", multiple: true %>
              <div class="form-text">Upload additional documents</div>
            </div>
          </div>
        </div>

        <!-- New Document System -->
        <div class="border-top pt-4 mt-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h6 class="mb-0">Document Management System</h6>
            <button type="button" class="btn btn-sm btn-primary" id="add_customer_document">
              <i class="bi bi-plus-lg me-1"></i>
              Add Document
            </button>
          </div>

          <div id="customer_documents_container">
            <!-- New document system will be added here -->
          </div>

          <p class="text-muted mb-0 mt-2">
            <small>Use this system to add organized documents with titles and types</small>
          </p>
        </div>
      </div>

      <!-- Additional Info -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-transparent border-0">
          <h5 class="mb-0">Additional Information</h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <%= form.label :additional_info, class: "form-label" %>
              <%= form.text_area :additional_info, class: "form-control", rows: 4, placeholder: "Enter any additional information" %>
            </div>
            <div class="col-md-6">
              <div class="form-check form-switch">
                <%= form.check_box :status, class: "form-check-input" %>
                <%= form.label :status, "Active Status", class: "form-check-label" %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="d-flex gap-2">
        <%= form.submit "Update Customer", class: "btn btn-primary" %>
        <%= link_to "Cancel", admin_customer_path(@customer), class: "btn btn-outline-secondary" %>
      </div>
    <% end %>
  </div>

  <!-- Customer Summary -->
  <div class="col-lg-4">
    <div class="card border-0 shadow-sm mb-3">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0">Customer Summary</h6>
      </div>
      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <% if @customer.profile_image.attached? %>
            <%= image_tag @customer.profile_image, class: "rounded-circle me-3", style: "width: 50px; height: 50px; object-fit: cover;" %>
          <% else %>
            <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
              <i class="bi bi-person text-primary"></i>
            </div>
          <% end %>
          <div>
            <h6 class="mb-0"><%= @customer.display_name %></h6>
            <span class="badge bg-<%= @customer.customer_type == 'individual' ? 'primary' : 'success' %>">
              <%= @customer.customer_type.humanize %>
            </span>
          </div>
        </div>

        <hr>

        <div class="row g-2 mb-2">
          <div class="col-5"><strong>ID:</strong></div>
          <div class="col-7">#<%= @customer.id %></div>
        </div>

        <div class="row g-2 mb-2">
          <div class="col-5"><strong>Mobile:</strong></div>
          <div class="col-7"><%= @customer.mobile %></div>
        </div>

        <div class="row g-2 mb-2">
          <div class="col-5"><strong>Email:</strong></div>
          <div class="col-7"><%= @customer.email %></div>
        </div>

        <div class="row g-2 mb-2">
          <div class="col-5"><strong>Location:</strong></div>
          <div class="col-7"><%= @customer.city %>, <%= @customer.state %></div>
        </div>

        <% if @customer.policies.any? %>
          <div class="row g-2 mb-2">
            <div class="col-5"><strong>Policies:</strong></div>
            <div class="col-7"><span class="badge bg-info"><%= @customer.policies.count %></span></div>
          </div>
        <% end %>

        <div class="row g-2 mb-2">
          <div class="col-5"><strong>Status:</strong></div>
          <div class="col-7">
            <span class="badge bg-<%= @customer.status ? 'success' : 'secondary' %>">
              <%= @customer.status ? 'Active' : 'Inactive' %>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const customerTypeSelect = document.getElementById('customer_type');
  const individualFields = document.getElementById('individual_fields');
  const corporateFields = document.getElementById('corporate_fields');

  function toggleCustomerType() {
    const selectedType = customerTypeSelect.value;

    if (selectedType === 'individual') {
      individualFields.style.display = 'block';
      corporateFields.style.display = 'none';

      // Update required attributes
      document.querySelectorAll('#individual_fields [required]').forEach(el => el.required = true);
      document.querySelectorAll('#corporate_fields [required]').forEach(el => el.required = false);
    } else if (selectedType === 'corporate') {
      individualFields.style.display = 'none';
      corporateFields.style.display = 'block';

      // Update required attributes
      document.querySelectorAll('#individual_fields [required]').forEach(el => el.required = false);
      document.querySelectorAll('#corporate_fields [required]').forEach(el => el.required = true);
    } else {
      individualFields.style.display = 'none';
      corporateFields.style.display = 'none';

      // Remove required attributes
      document.querySelectorAll('#individual_fields [required], #corporate_fields [required]').forEach(el => el.required = false);
    }
  }

  customerTypeSelect.addEventListener('change', toggleCustomerType);

  // Initialize on page load
  if (customerTypeSelect.value) {
    toggleCustomerType();
  }

  // Pincode lookup functionality
  const pincodeField = document.getElementById('customer_pincode');
  const cityField = document.getElementById('customer_city');
  const stateField = document.getElementById('customer_state');

  if (pincodeField && cityField && stateField) {
    pincodeField.addEventListener('blur', function() {
      const pincode = this.value.trim();
      if (pincode.length === 6 && /^\d{6}$/.test(pincode)) {
        fetchLocationFromPincode(pincode);
      }
    });
  }

  async function fetchLocationFromPincode(pincode) {
    try {
      // Show loading indication
      cityField.value = 'Loading...';
      stateField.value = 'Loading...';

      // Using Indian Postal Code API (free service)
      const response = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
      const data = await response.json();

      if (data && data[0] && data[0].Status === 'Success' && data[0].PostOffice) {
        const postOffice = data[0].PostOffice[0];
        cityField.value = postOffice.District || '';
        stateField.value = postOffice.State || '';
      } else {
        // Clear loading and show not found
        cityField.value = '';
        stateField.value = '';
        // Show a small notification that pincode was not found
        showPincodeNotification('Pincode not found. Please enter city and state manually.', 'warning');
      }
    } catch (error) {
      console.error('Error fetching pincode data:', error);
      cityField.value = '';
      stateField.value = '';
      showPincodeNotification('Unable to fetch location. Please enter city and state manually.', 'error');
    }
  }

  function showPincodeNotification(message, type) {
    // Create a small notification near the pincode field
    const existingNotification = document.querySelector('.pincode-notification');
    if (existingNotification) {
      existingNotification.remove();
    }

    const notification = document.createElement('div');
    notification.className = `pincode-notification small mt-1 text-${type === 'warning' ? 'warning' : 'danger'}`;
    notification.innerHTML = `<i class="bi bi-info-circle me-1"></i>${message}`;

    pincodeField.parentElement.appendChild(notification);

    // Remove notification after 5 seconds
    setTimeout(() => {
      if (notification.parentElement) {
        notification.remove();
      }
    }, 5000);
  }

  // Customer Document Management System
  let customerDocumentIndex = 0;
  const addCustomerDocumentBtn = document.getElementById('add_customer_document');
  const customerDocumentsContainer = document.getElementById('customer_documents_container');

  addCustomerDocumentBtn?.addEventListener('click', function() {
    const documentHtml = `
      <div class="document-entry p-3 mb-3 border rounded position-relative" data-index="${customerDocumentIndex}" style="background: #f8f9fa;">
        <button type="button" class="btn btn-sm btn-outline-danger position-absolute" style="top: 10px; right: 10px;" onclick="this.closest('.document-entry').remove()">
          <i class="bi bi-trash"></i>
        </button>
        <div class="row">
          <div class="col-md-4">
            <label class="form-label">Document Title <span class="text-danger">*</span></label>
            <input type="text" name="customer[uploaded_documents_attributes][${customerDocumentIndex}][title]" class="form-control" placeholder="Enter document title" required>
          </div>
          <div class="col-md-4">
            <label class="form-label">Document Type <span class="text-danger">*</span></label>
            <select name="customer[uploaded_documents_attributes][${customerDocumentIndex}][document_type]" class="form-select" required>
              <option value="">Select Document Type</option>
              <option value="aadhar">Aadhaar Card</option>
              <option value="pan_card">PAN Card</option>
              <option value="driving_license">Driving License</option>
              <option value="passport">Passport</option>
              <option value="voter_id">Voter ID</option>
              <option value="birth_certificate">Birth Certificate</option>
              <option value="income_certificate">Income Certificate</option>
              <option value="salary_slip">Salary Slip</option>
              <option value="bank_statement">Bank Statement</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label">Document File <span class="text-danger">*</span></label>
            <input type="file" name="customer[uploaded_documents_attributes][${customerDocumentIndex}][file]" class="form-control" accept="application/pdf,image/jpeg,image/jpg,image/png,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" required>
          </div>
        </div>
        <div class="row mt-2">
          <div class="col-md-12">
            <label class="form-label">Description (Optional)</label>
            <textarea name="customer[uploaded_documents_attributes][${customerDocumentIndex}][description]" class="form-control" rows="2" placeholder="Optional description"></textarea>
          </div>
        </div>
        <input type="hidden" name="customer[uploaded_documents_attributes][${customerDocumentIndex}][uploaded_by]" value="Admin User">
      </div>
    `;
    customerDocumentsContainer.insertAdjacentHTML('beforeend', documentHtml);
    customerDocumentIndex++;
  });

  // Form validation
  const forms = document.querySelectorAll('.needs-validation');
  Array.prototype.slice.call(forms).forEach(function(form) {
    form.addEventListener('submit', function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });
});
</script>