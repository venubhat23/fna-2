<nav class="top-navbar">
  <!-- Mobile sidebar toggle -->
  <button class="sidebar-toggle d-lg-none" onclick="toggleSidebar()">
    <i class="bi bi-list"></i>
  </button>

  <!-- Page Title -->
  <div class="page-title">
    <h1><%= content_for(:page_title) || "Dashboard" %></h1>
    <p class="page-subtitle"><%= content_for(:page_subtitle) || "Welcome back! Here's what's happening." %></p>
  </div>

  <!-- Right side navigation -->
  <div class="navbar-actions">
    <!-- Search -->
    <div class="search-box d-none d-md-flex">
      <i class="bi bi-search search-icon"></i>
      <input type="search" placeholder="Search customers, policies..." aria-label="Search">
    </div>

    <!-- Notifications -->
    <button class="notification-bell" data-bs-toggle="dropdown">
      <i class="bi bi-bell"></i>
      <span class="badge"></span>
    </button>
    <ul class="dropdown-menu dropdown-menu-end notification-dropdown">
      <li class="dropdown-header">
        <div class="d-flex justify-content-between align-items-center">
          <h6 class="mb-0">Notifications</h6>
          <span class="badge bg-primary">3</span>
        </div>
      </li>
      <li><hr class="dropdown-divider"></li>
      <li class="notification-item">
        <div class="notification-content">
          <div class="notification-icon bg-success">
            <i class="bi bi-check-circle"></i>
          </div>
          <div class="notification-text">
            <p class="mb-1"><strong>New Policy Created</strong></p>
            <small class="text-muted">Life insurance policy for John Doe</small>
            <div class="notification-time">2 minutes ago</div>
          </div>
        </div>
      </li>
      <li class="notification-item">
        <div class="notification-content">
          <div class="notification-icon bg-info">
            <i class="bi bi-person"></i>
          </div>
          <div class="notification-text">
            <p class="mb-1"><strong>Customer Updated Profile</strong></p>
            <small class="text-muted">Sarah Wilson updated contact info</small>
            <div class="notification-time">1 hour ago</div>
          </div>
        </div>
      </li>
      <li class="notification-item">
        <div class="notification-content">
          <div class="notification-icon bg-warning">
            <i class="bi bi-currency-dollar"></i>
          </div>
          <div class="notification-text">
            <p class="mb-1"><strong>Payment Received</strong></p>
            <small class="text-muted">â‚¹25,000 premium payment</small>
            <div class="notification-time">3 hours ago</div>
          </div>
        </div>
      </li>
      <li><hr class="dropdown-divider"></li>
      <li class="text-center">
        <a href="#" class="dropdown-item">View all notifications</a>
      </li>
    </ul>

    <!-- User Profile -->
    <div class="user-dropdown" data-bs-toggle="dropdown">
      <%= image_tag "https://via.placeholder.com/36x36/667eea/ffffff?text=#{current_user.email[0].upcase}", class: "user-avatar" %>
      <span class="user-name d-none d-md-inline"><%= current_user.email.split("@").first.titleize %></span>
      <i class="bi bi-chevron-down dropdown-icon"></i>
    </div>
    <ul class="dropdown-menu dropdown-menu-end user-menu">
      <li class="user-info-header">
        <div class="d-flex align-items-center p-3">
          <%= image_tag "https://via.placeholder.com/40x40/667eea/ffffff?text=#{current_user.email[0].upcase}", class: "rounded-circle me-3" %>
          <div>
            <h6 class="mb-0"><%= current_user.email.split("@").first.titleize %></h6>
            <small class="text-muted"><%= current_user.email %></small>
          </div>
        </div>
      </li>
      <li><hr class="dropdown-divider"></li>
      <li>
        <%= link_to edit_user_registration_path, class: "dropdown-item" do %>
          <i class="bi bi-person me-2"></i>
          Profile Settings
        <% end %>
      </li>
      <li>
        <a class="dropdown-item" href="#">
          <i class="bi bi-gear me-2"></i>
          Account Settings
        </a>
      </li>
      <li>
        <a class="dropdown-item" href="#">
          <i class="bi bi-question-circle me-2"></i>
          Help & Support
        </a>
      </li>
      <li><hr class="dropdown-divider"></li>
      <li>
        <%= link_to destroy_user_session_path, method: :delete, class: "dropdown-item text-danger" do %>
          <i class="bi bi-box-arrow-right me-2"></i>
          Logout
        <% end %>
      </li>
    </ul>
  </div>
</nav>

<script>
  // Sidebar toggle for mobile
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const backdrop = document.createElement('div');

    if (sidebar.classList.contains('show')) {
      sidebar.classList.remove('show');
      const existingBackdrop = document.querySelector('.sidebar-backdrop');
      if (existingBackdrop) {
        existingBackdrop.remove();
      }
    } else {
      sidebar.classList.add('show');
      backdrop.className = 'sidebar-backdrop';
      backdrop.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        backdrop-filter: blur(4px);
      `;
      backdrop.onclick = () => toggleSidebar();
      document.body.appendChild(backdrop);
    }
  }

  // Auto-hide sidebar backdrop on window resize
  window.addEventListener('resize', () => {
    if (window.innerWidth >= 992) {
      const sidebar = document.getElementById('sidebar');
      const backdrop = document.querySelector('.sidebar-backdrop');
      if (sidebar) sidebar.classList.remove('show');
      if (backdrop) backdrop.remove();
    }
  });

  // Initialize tooltips
  document.addEventListener('DOMContentLoaded', () => {
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(tooltipTriggerEl => {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });
  });
</script>