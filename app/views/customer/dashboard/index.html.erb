<% content_for :title, 'Dashboard' %>

<% if current_customer %>
<!-- Welcome Banner Section -->
<div class="welcome-banner mb-4">
  <div class="welcome-content">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1 class="welcome-title">Welcome back, <%= current_customer.first_name %>! ðŸ‘‹</h1>
        <p class="welcome-subtitle">Browse products, add to cart, and manage your bookings all in one place!</p>
      </div>
      <div class="col-md-4 text-end">
        <div class="weather-widget">
          <i class="fas fa-sun weather-icon"></i>
          <span class="weather-text">Perfect day for fresh deliveries!</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Action Cards -->
<div class="row mb-4">
  <div class="col-md-4 mb-3">
    <div class="stat-card stat-cart">
      <div class="stat-icon">
        <i class="fas fa-shopping-cart"></i>
      </div>
      <div class="stat-info">
        <h3><%= cart_count %></h3>
        <p>Items in Cart</p>
      </div>
      <div class="stat-trend">
        <%= link_to customer_cart_path, class: "btn btn-sm btn-primary" do %>
          View Cart <i class="fas fa-arrow-right"></i>
        <% end %>
      </div>
    </div>
  </div>

  <div class="col-md-4 mb-3">
    <div class="stat-card stat-orders">
      <div class="stat-icon">
        <i class="fas fa-shopping-bag"></i>
      </div>
      <div class="stat-info">
        <h3><%= @recent_orders.count %></h3>
        <p>Recent Bookings</p>
      </div>
      <div class="stat-trend">
        <%= link_to customer_orders_path, class: "btn btn-sm btn-primary" do %>
          View Bookings <i class="fas fa-arrow-right"></i>
        <% end %>
      </div>
    </div>
  </div>

  <div class="col-md-4 mb-3">
    <div class="stat-card stat-subscriptions">
      <div class="stat-icon">
        <i class="fas fa-box"></i>
      </div>
      <div class="stat-info">
        <h3>Shop</h3>
        <p>Browse Products</p>
      </div>
      <div class="stat-trend">
        <%= link_to customer_products_path, class: "btn btn-sm btn-primary" do %>
          Explore <i class="fas fa-arrow-right"></i>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Hero Banner Section -->
<% if @banners&.any? %>
<div class="hero-carousel-section mb-5">
  <div class="container">
    <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-indicators">
        <% @banners.each_with_index do |banner, index| %>
          <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="<%= index %>"
                  class="<%= 'active' if index == 0 %>" aria-current="true"></button>
        <% end %>
      </div>
      <div class="carousel-inner">
        <% @banners.each_with_index do |banner, index| %>
          <div class="carousel-item <%= 'active' if index == 0 %>">
            <div class="row align-items-center">
              <div class="col-md-6">
                <h1 class="display-4 fw-bold mb-4"><%= banner.title %></h1>
                <p class="lead mb-4"><%= banner.description %></p>
                <% if banner.redirect_link.present? %>
                  <%= link_to "Shop Now", banner.redirect_link, class: "btn btn-light btn-lg me-3" %>
                <% else %>
                  <%= link_to "Shop Now", customer_products_path, class: "btn btn-light btn-lg me-3" %>
                <% end %>
                <%= link_to "Learn More", "#features", class: "btn btn-outline-light btn-lg" %>
              </div>
              <div class="col-md-6">
                <% if banner.has_image? %>
                  <%= image_tag banner.main_image_url, class: "img-fluid rounded", alt: banner.title %>
                <% else %>
                  <div class="bg-light rounded d-flex align-items-center justify-content-center" style="height: 300px;">
                    <i class="bi bi-image display-1 text-muted"></i>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <% if @banners.count > 1 %>
        <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon"></span>
        </button>
      <% end %>
    </div>
  </div>
</div>
<% else %>
<!-- Default hero section -->
<div class="hero-carousel-section mb-5">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-6">
        <h1 class="display-4 fw-bold mb-4">Welcome to Dhanvantri Naturals</h1>
        <p class="lead mb-4">Fresh milk, organic groceries, and natural products delivered right to your doorstep. Experience the convenience of healthy living with our premium quality products.</p>
        <%= link_to "Shop Now", customer_products_path, class: "btn btn-light btn-lg me-3" %>
        <%= link_to "Learn More", "#features", class: "btn btn-outline-light btn-lg" %>
      </div>
      <div class="col-md-6 text-center">
        <i class="bi bi-basket display-1 text-white"></i>
      </div>
    </div>
  </div>
</div>
<% end %>

<div class="container">
  <!-- Features Section -->
  <section id="features" class="mb-5">
    <h2 class="text-center mb-5">Why Choose Dhanvantri Naturals?</h2>
    <div class="row">
      <div class="col-md-4 text-center mb-4">
        <div class="bg-success bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
          <i class="bi bi-truck display-6 text-success"></i>
        </div>
        <h4>Free Delivery</h4>
        <p class="text-muted">Free delivery on orders above â‚¹500. Fast and reliable service to your doorstep.</p>
      </div>
      <div class="col-md-4 text-center mb-4">
        <div class="bg-success bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
          <i class="bi bi-shield-check display-6 text-success"></i>
        </div>
        <h4>Quality Assured</h4>
        <p class="text-muted">100% fresh and organic products. Quality guaranteed or money back.</p>
      </div>
      <div class="col-md-4 text-center mb-4">
        <div class="bg-success bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
          <i class="bi bi-arrow-repeat display-6 text-success"></i>
        </div>
        <h4>Subscription Plans</h4>
        <p class="text-muted">Daily, weekly, or monthly subscriptions for your regular needs.</p>
      </div>
    </div>
  </section>

  <!-- Product Categories Section -->
  <% if @categories.any? %>
    <section class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Shop by Category</h2>
        <%= link_to "View All Categories", customer_categories_path, class: "btn btn-outline-primary" %>
      </div>
      <div class="row">
        <% @categories.each do |category| %>
          <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-4">
            <%= link_to customer_category_path(category), class: "text-decoration-none" do %>
              <div class="category-card bg-white rounded-lg shadow-sm p-4 text-center h-100">
                <div class="mb-3">
                  <% if category.has_image? %>
                    <%= image_tag category.display_image_url, class: "img-fluid rounded", style: "width: 60px; height: 60px; object-fit: cover;", alt: category.name %>
                  <% else %>
                    <div class="bg-light rounded d-flex align-items-center justify-content-center" style="width: 60px; height: 60px; margin: 0 auto;">
                      <i class="bi bi-grid display-6 text-muted"></i>
                    </div>
                  <% end %>
                </div>
                <h6 class="fw-semibold text-dark mb-2"><%= category.name %></h6>
                <p class="text-muted small mb-0"><%= pluralize(category.products_count, 'Product') %></p>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </section>
  <% end %>

  <!-- Featured Products Section -->
  <% if @featured_products.any? %>
    <section class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Featured Products</h2>
        <%= link_to "View All Products", customer_products_path, class: "btn btn-outline-primary" %>
      </div>
      <div class="row">
        <% @featured_products.each do |product| %>
          <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <div class="product-card bg-white rounded-lg shadow-sm h-100">
              <div class="position-relative">
                <% if product.main_image_url %>
                  <%= image_tag product.main_image_url, class: "card-img-top", style: "height: 200px; object-fit: cover;", alt: product.name %>
                <% else %>
                  <div class="bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                    <i class="bi bi-image display-4 text-muted"></i>
                  </div>
                <% end %>

                <% if product.discounted? %>
                  <span class="position-absolute top-0 start-0 badge bg-danger m-2">
                    <%= product.discount_percentage.round %>% OFF
                  </span>
                <% end %>

                <% unless product.in_stock? %>
                  <span class="position-absolute top-0 end-0 badge bg-secondary m-2">
                    Out of Stock
                  </span>
                <% end %>
              </div>

              <div class="card-body d-flex flex-column">
                <h6 class="card-title fw-semibold"><%= link_to product.name, customer_product_path(product), class: "text-decoration-none text-dark" %></h6>

                <div class="mb-2">
                  <span class="fw-bold text-success fs-5">â‚¹<%= product.selling_price %></span>
                  <% if product.discounted? %>
                    <span class="text-muted text-decoration-line-through ms-2">â‚¹<%= product.price %></span>
                  <% end %>
                </div>

                <% if product.has_reviews? %>
                  <div class="mb-2">
                    <span class="text-warning">
                      <% product.average_rating.floor.times do %>
                        <i class="bi bi-star-fill"></i>
                      <% end %>
                      <% (5 - product.average_rating.floor).times do %>
                        <i class="bi bi-star"></i>
                      <% end %>
                    </span>
                    <small class="text-muted ms-1">(<%= product.total_reviews %>)</small>
                  </div>
                <% end %>

                <div class="mt-auto">
                  <% if product.in_stock? %>
                    <%= form_with url: add_item_customer_cart_path, method: :post, local: true, class: "d-flex align-items-center gap-2" do |f| %>
                      <%= f.hidden_field :product_id, value: product.id %>
                      <%= f.number_field :quantity, value: 1, min: 1, max: [product.available_quantity, 10].min, class: "form-control form-control-sm", style: "width: 70px;" %>
                      <%= f.submit "Add to Cart", class: "btn btn-primary btn-sm flex-grow-1" %>
                    <% end %>
                  <% else %>
                    <button class="btn btn-secondary btn-sm w-100" disabled>Out of Stock</button>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </section>
  <% end %>

  <!-- Recent Bookings Section -->
  <% if @recent_orders.any? %>
    <section class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Your Recent Bookings</h2>
        <%= link_to "View All Bookings", customer_orders_path, class: "btn btn-outline-primary" %>
      </div>
      <div class="row">
        <% @recent_orders.each do |order| %>
          <div class="col-md-4 mb-3">
            <div class="bg-white rounded-lg shadow-sm p-3">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="fw-semibold mb-0">#<%= order.order_number %></h6>
                <span class="badge bg-<%= order.status == 'delivered' ? 'success' : order.status == 'cancelled' ? 'danger' : 'primary' %>">
                  <%= order.status.humanize %>
                </span>
              </div>
              <p class="text-muted small mb-2">
                <i class="bi bi-calendar3 me-1"></i>
                <%= order.order_date.strftime('%B %d, %Y') %>
              </p>
              <p class="fw-bold mb-2">â‚¹<%= order.total_amount %></p>
              <%= link_to "View Booking", customer_order_path(order), class: "btn btn-outline-primary btn-sm" %>
            </div>
          </div>
        <% end %>
      </div>
    </section>
  <% end %>

  <!-- Active Subscriptions Section -->
  <% if @active_subscriptions.any? %>
    <section class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Active Subscriptions</h2>
        <%= link_to "Manage Subscriptions", customer_subscriptions_path, class: "btn btn-outline-primary" %>
      </div>
      <div class="row">
        <% @active_subscriptions.each do |subscription| %>
          <div class="col-md-4 mb-3">
            <div class="bg-white rounded-lg shadow-sm p-3">
              <h6 class="fw-semibold mb-2"><%= subscription.product.name %></h6>
              <p class="text-muted small mb-2">
                <i class="bi bi-arrow-repeat me-1"></i>
                <%= subscription.quantity %> <%= subscription.unit %> - Daily
              </p>
              <p class="text-muted small mb-2">
                <i class="bi bi-calendar3 me-1"></i>
                Started: <%= subscription.start_date.strftime('%B %d, %Y') %>
              </p>
              <div class="d-flex gap-2">
                <%= link_to "View Details", customer_subscription_path(subscription), class: "btn btn-outline-primary btn-sm" %>
                <%= link_to "Pause", customer_subscription_pause_path(subscription), method: :patch, class: "btn btn-outline-warning btn-sm" %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </section>
  <% end %>

  <!-- Quick Order Section -->
  <section class="bg-light rounded-lg p-4 mb-5">
    <h3 class="text-center mb-4">Quick Order</h3>
    <p class="text-center text-muted mb-4">Quickly reorder your frequently purchased items</p>

    <!-- This would typically show frequently bought products by the customer -->
    <div class="text-center">
      <%= link_to "Browse All Products", customer_products_path, class: "btn btn-primary btn-lg" %>
    </div>
  </section>
</div>

<% else %>
<!-- Not Logged In Section -->
<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-8 text-center">
      <div class="hero-section py-5 mb-5">
        <h1 class="display-4 fw-bold mb-4">Welcome to Dhanvantri Naturals</h1>
        <p class="lead mb-4">Fresh milk, organic groceries, and natural products delivered right to your doorstep. Experience the convenience of healthy living with our premium quality products.</p>
        <%= link_to "Login", customer_login_path, class: "btn btn-light btn-lg me-3" %>
        <%= link_to "Register", customer_register_path, class: "btn btn-outline-light btn-lg" %>
      </div>
    </div>
  </div>

  <!-- Features Section -->
  <section id="features" class="mb-5">
    <h2 class="text-center mb-5">Why Choose Dhanvantri Naturals?</h2>
    <div class="row">
      <div class="col-md-4 text-center mb-4">
        <div class="bg-success bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
          <i class="bi bi-truck display-6 text-success"></i>
        </div>
        <h4>Free Delivery</h4>
        <p class="text-muted">Free delivery on orders above â‚¹500. Fast and reliable service to your doorstep.</p>
      </div>
      <div class="col-md-4 text-center mb-4">
        <div class="bg-success bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
          <i class="bi bi-shield-check display-6 text-success"></i>
        </div>
        <h4>Quality Assured</h4>
        <p class="text-muted">100% fresh and organic products. Quality guaranteed or money back.</p>
      </div>
      <div class="col-md-4 text-center mb-4">
        <div class="bg-success bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
          <i class="bi bi-arrow-repeat display-6 text-success"></i>
        </div>
        <h4>Subscription Plans</h4>
        <p class="text-muted">Daily, weekly, or monthly subscriptions for your regular needs.</p>
      </div>
    </div>
  </section>
</div>
<% end %>